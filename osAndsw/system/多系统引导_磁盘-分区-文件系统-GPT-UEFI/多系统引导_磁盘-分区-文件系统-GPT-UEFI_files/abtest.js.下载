(function($){"use strict";var ABTEST={appId:"",clientId:"",style:"",hiddenElementMap:{}};ABTEST.cloudCookieDomain=".huaweicloud.com";ABTEST.getCookieDomain=function(){var host=location.hostname;var ip=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;try{if(ip.test(host)===true||host==="localhost"){return host}var regex=/([^]*).*/;var match=host.match(regex);if(typeof match!=="undefined"&&null!==match){host=match[1]}if(typeof host!=="undefined"&&null!==host){var strAry=host.split(".");if(strAry.length>1){host=strAry[strAry.length-2]+"."+strAry[strAry.length-1]}}}catch(err){}return"."+host};try{ABTEST.cloudCookieDomain=ABTEST.getCookieDomain()}catch(err){}ABTEST.guidGenerator=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};ABTEST.getCookie=function(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");if(arr=document.cookie.match(reg))return unescape(arr[2]);else return""};ABTEST.getClientId=function(){var clientId=ABTEST.getCookie("vk");if(!clientId){clientId=ABTEST.guidGenerator();var exdate=new Date;exdate.setDate(exdate.getDate()+365*10);document.cookie="vk="+clientId+";path=/;domain="+ABTEST.cloudCookieDomain+";expires="+exdate.toGMTString()+";"}return clientId};ABTEST.isNull=function(e){return null!=e&&void 0!=e};ABTEST.createStyle=function(){var n=document.createElement("style");n.setAttribute("type","text/css"),!ABTEST.isNull(n.styleSheet)&&n.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(n);ABTEST.style=n;ABTEST.hiddenElementMap={}};ABTEST.update=function(){var e=[];for(var t in ABTEST.hiddenElementMap){e.push(t)}var i=0==e.length?"":e.join(",")+"{opacity:0 !important; filter:alpha(opacity=0) !important; background:none !important;visibility:hidden !important;}";ABTEST.style.styleSheet?ABTEST.style.styleSheet.cssText=i:ABTEST.style.innerHTML=i};ABTEST.hide=function(){for(var t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];ABTEST.each(i,function(t){ABTEST.hiddenElementMap[t]=!0});ABTEST.update()};ABTEST.each=function(e,t){var i=e&&e.hasOwnProperty("length")?e.length:0;if(i){for(var n=0;n<i&&t(e[n],n)!==!1;n++);}};ABTEST.show=function(){try{for(var t=arguments.length,i=Array(t),n=0;n<t;n++){i[n]=arguments[n]}0==i.length?this.hiddenElementMap={}:ABTEST.each(i,function(t){delete ABTEST.hiddenElementMap[t]}),ABTEST.update()}catch(o){console&&console.warn(o)}};ABTEST.getQueryParam=function(query,name){var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==name){return pair[1]}}return false};ABTEST.defaultCallBack=function(data){function codeCallBack(data){var bypassArg="abv=";var search=window.location.search;if(search.indexOf(bypassArg)!=-1){window.ab_version=ABTEST.getQueryParam(search.substring(1),"abv");return}if(data.strategyList[0].configObj&&data.strategyList[0].configObj.upstream=="gray"){if(data.strategyList[0].configObj.url){window.location.href=data.strategyList[0].configObj.url}else{var abParam=bypassArg+data.strategyList[0].id;window.location.search=search+(search?"&":"?")+abParam}}}function editCallBack(data){var changeList=data.strategyList[0].changeList||[];for(var i=0;i<changeList.length;i++){var node=document.evaluate(changeList[i].key,document).iterateNext();var value=changeList[i].value;switch(changeList[i].type){case"text":$(node).text(value);break;case"style":$(node).attr("style",value);break;case"href":$(node).attr("href",value);break;default:break}if(changeList[i].type=="text"){$(node).text(changeList[i].value)}}}if(data&&data.strategyList&&data.strategyList[0]){window.ab_test=data.strategyList[0].experimentId;window.ab_version=data.strategyList[0].id;if(data.strategyList[0].experimentType==2){$(function(){editCallBack(data)})}else{codeCallBack(data)}}};ABTEST.goto=function(){try{var param={appId:ABTEST.appId,clientId:ABTEST.clientId};if(ABTEST.code){param.experimentCode=ABTEST.code}else{var url=window.location.protocol+"//"+window.location.port+window.location.host+window.location.pathname+window.location.hash;param.url=url}$.ajax({type:"POST",dataType:"json",async:true,timeout:2e3,contentType:"application/json",url:"https://portal.huaweicloud.com/rest/cbc/portaldecisionservice/v1/strategydecision",data:JSON.stringify(param),xhrFields:{withCredentials:true},success:function(data){ABTEST.show();if(typeof ABTEST.callback=="function"){ABTEST.callback(data)}else{ABTEST.defaultCallBack(data)}},error:function(){ABTEST.show();if(typeof ABTEST.callback=="function"){ABTEST.callback({})}}})}catch(error){ABTEST.show();if(typeof ABTEST.callback=="function"){ABTEST.callback({})}}};ABTEST.checkEdite=function(){var referrer=document.referrer;if(referrer.indexOf("appId=")==-1||referrer.indexOf("strategyId=")==-1||referrer.indexOf("experimentId=")==-1){return false}var query="";var index=referrer.indexOf("?");if(index!=-1){query=referrer.substring(index+1)}var appId=ABTEST.getQueryParam(query,"appId");if(appId!=ABTEST.appId){alert("appId is error!");return false}ABTEST.initEdite();return true};ABTEST.initEdite=function(){var style=document.createElement("link");style.href="https://res-static1.huaweicloud.com/content/dam/cloudbu-site/archive/china/commons/ssrv/index.css?v="+(new Date).getTime();style.rel="stylesheet";style.type="text/css";var script=document.createElement("script");script.setAttribute("charset","utf-8"),script.src="https://res-static1.huaweicloud.com/content/dam/cloudbu-site/archive/china/commons/ssrv/PepRuyiAbtest.umd.js?v="+(new Date).getTime();document.getElementsByTagName("head")[0].appendChild(style).appendChild(script)};ABTEST.init=function(appId,callback,clientId,code,notHide){ABTEST.createStyle();ABTEST.appId=appId;ABTEST.callback=callback||"";ABTEST.clientId=clientId||ABTEST.getClientId();ABTEST.code=code||"";if(!notHide){ABTEST.hide("*","body")}ABTEST.checkEdite()?ABTEST.show():ABTEST.goto()};$.abtest=function(appId,callback,clientId,code,notHide){ABTEST.init(appId,callback,clientId,code,notHide)}})(window.$);