<!DOCTYPE html>
<!-- saved from url=(0046)https://www.cnblogs.com/jokezl/p/10180406.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="origin">
    <meta property="og:description" content="Python的WEB框架有Django、Tornado、Flask 等多种，Django相较与其他WEB框架其优势为：大而全，框架本身集成了ORM、模型绑定、模板引擎、缓存、Session等诸多功能。">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Django框架全面讲解 - 漫天飞雪世情难却 - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="https://common.cnblogs.com/favicon.ico?v=20200522" type="image/x-icon">
    
    <link rel="stylesheet" href="./Django框架全面讲解_files/blog-common.min.css">
    <link id="MainCss" rel="stylesheet" href="./Django框架全面讲解_files/bundle-blacksun.min.css">
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./Django框架全面讲解_files/bundle-blacksun-mobile.min.css">
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/jokezl/rss">
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/jokezl/rsd.xml">
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/jokezl/wlwmanifest.xml">
    <script async="" src="./Django框架全面讲解_files/analytics.js.下载"></script><script type="text/javascript" src="./Django框架全面讲解_files/encoder.js.下载"></script><script src="./Django框架全面讲解_files/jquery-2.2.0.min.js.下载"></script>
    <script src="./Django框架全面讲解_files/blog-common.min.js.下载"></script>
    <script>
        var currentBlogId = 447764;
        var currentBlogApp = 'jokezl';
        var cb_enable_mathjax = true;
        var isLogined = false;
        var skinName = 'BlackSun';
    </script>
    <script type="text/x-mathjax-config;executed=true">
        MathJax.Hub.Config({
        tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], processClass: 'math', processEscapes: true },
        TeX: {
        equationNumbers: { autoNumber: ['AMS'], useLabelIds: true },
        extensions: ['extpfeil.js', 'mediawiki-texvc.js'],
        Macros: {bm: "\\boldsymbol"}
        },
        'HTML-CSS': { linebreaks: { automatic: true } },
        SVG: { linebreaks: { automatic: true } }
        });
    </script>
    <script src="./Django框架全面讲解_files/MathJax.js.下载"></script>
    
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><link rel="preload" href="./Django框架全面讲解_files/f.txt" as="script"><script type="text/javascript" src="./Django框架全面讲解_files/f.txt"></script><script src="./Django框架全面讲解_files/pubads_impl_2020061611.js.下载" async=""></script><link rel="prefetch" href="https://293fe11257ea3e7edea6683d01aed817.safeframe.googlesyndication.com/safeframe/1-0-37/html/container.html"><link rel="prefetch" href="https://tpc.googlesyndication.com/safeframe/1-0-37/html/container.html"></head>
<body><div id="MathJax_Message" style="display: none;"></div>
    <a name="top"></a>
    
    <div id="top">
	<div>
    <table class="HeaderTitles">
        <tbody><tr>
            <td>
                <h1 class="HeaderTitle"><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/jokezl/">漫天飞雪</a>
</h1>
                <p id="tagline">

</p>
            </td>
        </tr>
    </tbody></table>
</div>
<div>
    <table id="HeaderBar" class="HeaderBar">
        <tbody><tr>
            <td class="HeaderBarTab" nowrap="">
                
&nbsp;
<a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
&nbsp;::

<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/jokezl/">
首页</a>
&nbsp;::


<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
&nbsp;::

<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/%E6%BC%AB%E5%A4%A9%E9%A3%9E%E9%9B%AA%E4%B8%96%E6%83%85%E9%9A%BE%E5%8D%B4">
联系</a>&nbsp;::

<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/jokezl/rss/">
订阅</a>

<a id="blog_nav_rss_image" href="https://www.cnblogs.com/jokezl/rss/">
    <img src="./Django框架全面讲解_files/xml.gif" alt="订阅">
</a>&nbsp;::

<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>



            </td>
			
            <td class="HeaderBarTabBack" nowrap="" width="100%">
                
	<table class="BlogStatsBar">
		<tbody><tr>
			<td width="100%">
			</td>
			<td class="BlogStatsBar" nowrap="">
				&nbsp;
				
45 
				Posts&nbsp;::
				
115 Stories
				::
				
0 Comments
				::
				
0 Trackbacks
			</td>
		</tr>
	</tbody></table>


            </td>
        </tr>
    </tbody></table>
</div>
</div>
<table id="maintable">
	<tbody><tr><td id="leftmenu">
	
		
<div id="sidebar_news" class="newsItem"><h3>公告</h3>
<div class="News">
	
<div id="blog-news">
    
    <div id="profile_block">
        昵称：
        <a href="https://home.cnblogs.com/u/jokezl/">
            漫天飞雪世情难却
        </a>
        <br>
        园龄：
        <a href="https://home.cnblogs.com/u/jokezl/" title="入园时间：2018-07-28">
            1年10个月
        </a>
        <br>
        粉丝：
        <a href="https://home.cnblogs.com/u/jokezl/followers/">
            3
        </a>
        <br>
        关注：
        <a href="https://home.cnblogs.com/u/jokezl/followees/">
            4
        </a>
        <div id="p_b_follow">
<a href="javascript:void(0)" onclick="follow(&#39;a9b414f8-15da-4d5b-4487-08d5f422f4b6&#39;)">+加关注</a></div>
        <script>getFollowStatus('a9b414f8-15da-4d5b-4487-08d5f422f4b6');</script>
    </div>
</div>
</div>

</div>

<div id="sidebar_ad"></div>
		<div id="blog-sidecolumn">
<!-- 搜索 -->
<div id="sidebar_search" class="sidebar-block">
    <div id="sidebar_search" class="mySearch">
        <h3 class="catListTitle">搜索</h3>
        <div id="sidebar_search_box">
            <div id="widget_my_zzk" class="div_my_zzk">
                <input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk">
            </div>
            <div id="widget_my_google" class="div_my_zzk">
                <input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk">
            </div>
        </div>
    </div>
</div>

<!-- 常用链接 -->
<div id="sidebar_shortcut" class="sidebar-block">
    
<h3 class="catListTitle">
常用链接
</h3>
<ul>
        <li>

<a href="https://www.cnblogs.com/jokezl/p/" title="我的博客的随笔列表">我的随笔</a>
</li>
        <li>

<a href="https://www.cnblogs.com/jokezl/MyComments.html" title="我的发表过的评论列表">我的评论</a>
</li>
        <li>

<a href="https://www.cnblogs.com/jokezl/OtherPosts.html" title="我评论过的随笔列表">我的参与</a>
</li>
        <li>

<a href="https://www.cnblogs.com/jokezl/RecentComments.html" title="我的博客的评论列表">最新评论</a>
</li>
        <li>

<a href="https://www.cnblogs.com/jokezl/tag/" title="我的博客的标签列表">我的标签</a>
</li>
</ul>

<!-- TODO: 检查是否有使用这一部分的控件，如果没有则应该删除。 -->
<div id="itemListLin_con" style="display:none">
    <ul>

    </ul>
</div>

</div>

<!-- 最新随笔 -->
<div id="sidebar_recentposts" class="sidebar-block">
    
<h3 class="catListTitle">最新随笔</h3>
<div class="RecentComment" id="RecentPosts">
    <ul style="word-break:break-all">
                <li>
                    

<a href="https://www.cnblogs.com/jokezl/articles/11706748.html">1.shell脚本？</a>

                </li>
                <li>
                    

<a href="https://www.cnblogs.com/jokezl/p/10472171.html">2.CMDB资产管理系统</a>

                </li>
                <li>
                    

<a href="https://www.cnblogs.com/jokezl/p/10471951.html">3.python开发面试问题</a>

                </li>
                <li>
                    

<a href="https://www.cnblogs.com/jokezl/p/10469503.html">4.线程与进程的区别以及对多线程并发的理解</a>

                </li>
                <li>
                    

<a href="https://www.cnblogs.com/jokezl/p/10469354.html">5.什么是“备份、容灾、集群、负载均衡”?</a>

                </li>
                <li>
                    

<a href="https://www.cnblogs.com/jokezl/p/10469339.html">6.5分钟轻松应对 MySQL DBA 面试</a>

                </li>
                <li>
                    

<a href="https://www.cnblogs.com/jokezl/articles/10296533.html">7.CDN-内容推送网络</a>

                </li>
                <li>
                    

<a href="https://www.cnblogs.com/jokezl/articles/10296401.html">8.浏览器缓存机制</a>

                </li>
                <li>
                    

<a href="https://www.cnblogs.com/jokezl/articles/10294750.html">9.XSS跨站脚本攻击</a>

                </li>
                <li>
                    

<a href="https://www.cnblogs.com/jokezl/articles/10282944.html">10.SQL总结（三）SQL基本操作</a>

                </li>
    </ul>
</div>
</div>


<!-- 我的标签 -->
<div id="sidebar_toptags" class="sidebar-block">
    
<h3>我的标签</h3>
<div id="MyTag">
    <ul>
        
        <li>
            <a href="https://www.cnblogs.com/jokezl/tag/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/">数据库优化</a>(3)
        </li>
        <li>
            <a href="https://www.cnblogs.com/jokezl/tag/shell/">shell</a>(1)
        </li>
        <li>
            <a href="https://www.cnblogs.com/jokezl/tag/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a>(1)
        </li>
        <li>
            <a href="https://www.cnblogs.com/jokezl/tag/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>(1)
        </li>
    

    </ul>
</div>

</div>

<!-- 积分与排名 -->
<div id="sidebar_scorerank" class="sidebar-block">
    <h3>积分与排名</h3>
<ul>
    <li>
        积分 - 
13595
    </li>
    <li>
        排名 - 
57353
    </li>
</ul>
</div>

<!-- 随笔分类、随笔档案、文章分类、新闻分类、相册、链接 -->
<div id="sidebar_categories">
    
<div class="mainMenuBackground">
		<h3>

随笔分类
<span style="font-size:11px;font-weight:normal">(33)</span>

</h3>
				<ul>
			
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1372184.html" rel="" target="">
    linux(2)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1370908.html" rel="" target="">
    python(2)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1410263.html" rel="" target="">
    框架(1)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1377386.html" rel="" target="">
    设计模式及规范(24)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1372183.html" rel="" target="">
    数据库(3)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1410233.html" rel="" target="">
    网络(1)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
			
				</ul>
		<h3>

随笔档案
<span style="font-size:11px;font-weight:normal">(45)</span>

</h3>
				<ul>
			
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/archive/2019/03.html" rel="" target="">
    2019年3月(5)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/archive/2019/01.html" rel="" target="">
    2019年1月(26)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/archive/2018/12.html" rel="" target="">
    2018年12月(11)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/archive/2018/08.html" rel="" target="">
    2018年8月(3)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
			
				</ul>
		<h3>

文章分类
<span style="font-size:11px;font-weight:normal">(141)</span>

</h3>
				<ul>
			
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1375310.html" rel="" target="">
    django(21)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1264319.html" rel="" target="">
    linux(1)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1264318.html" rel="" target="">
    python基础(64)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1572042.html" rel="" target="">
    shell(1)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1369571.html" rel="" target="">
    socket\网络编程(3)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1375311.html" rel="" target="">
    面向对象(7)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1369570.html" rel="" target="">
    前端(27)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1377327.html" rel="" target="">
    设计模式及规范(1)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/category/1371136.html" rel="" target="">
    数据库(16)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
			
				</ul>
		<h3>

文章档案
<span style="font-size:11px;font-weight:normal">(115)</span>

</h3>
				<ul>
			
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/archives/2019/10.html" rel="nofollow noopener noreferrer" target="">
    2019年10月(1)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/archives/2019/01.html" rel="nofollow noopener noreferrer" target="">
    2019年1月(39)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/archives/2018/12.html" rel="nofollow noopener noreferrer" target="">
    2018年12月(67)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
				<li class="menuItemList">
					
<a href="https://www.cnblogs.com/jokezl/archives/2018/07.html" rel="nofollow noopener noreferrer" target="">
    2018年7月(8)
</a>

					<span style="width:10px">
						

					</span> 
				</li>
			
				</ul>
</div>


</div>

<!-- 最新评论 -->
<div id="sidebar_recentcomments" class="sidebar-block">
    
</div>



<!-- 阅读排行榜 -->
<div id="sidebar_topviewedposts" class="sidebar-block">
    
<div id="topview_posts_wrap">
    <h3 class="catListTitle">阅读排行榜</h3>
    <div id="TopViewPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/jokezl/p/10180406.html">
                            1. Django框架全面讲解(2691)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/jokezl/p/10469354.html">
                            2. 什么是“备份、容灾、集群、负载均衡”?(751)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/jokezl/p/10469503.html">
                            3. 线程与进程的区别以及对多线程并发的理解(675)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/jokezl/p/10469339.html">
                            4. 5分钟轻松应对 MySQL DBA 面试(339)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/jokezl/p/10471951.html">
                            5. python开发面试问题(213)
                        </a>
                    </li>
        </ul>
    </div>
</div>
</div>

<!-- 评论排行榜 -->
<div id="sidebar_topcommentedposts" class="sidebar-block">
    
</div>

<!-- 推荐排行榜 -->
<div id="sidebar_topdiggedposts" class="sidebar-block">
    
</div></div>
                    <script>loadBlogSideColumn();</script>
	
</td><td id="main">
	<div id="post_detail">
    <div class="post">
        <div class="postTitle">
            
<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/jokezl/p/10180406.html">
    <span>Django框架全面讲解</span>
    


</a>

        </div>
	
        <div class="postText">
            
<div id="cnblogs_post_body" class="blogpost-body ">
    <p>Python的WEB框架有Django、Tornado、Flask 等多种，Django相较与其他WEB框架其优势为：大而全，框架本身集成了ORM、模型绑定、模板引擎、缓存、Session等诸多功能。</p>
<p>本文将以下方面带大家全面了解Django框架，笔者使用的版本为1.10.</p>
<ol>
<li>
<p style="text-align: left;">django流程介绍</p>
</li>
<li style="text-align: left;">基本配置</li>
<li style="text-align: left;">路由系统</li>
<li style="text-align: left;">视图view</li>
<li style="text-align: left;">模板</li>
<li style="text-align: left;">Model</li>
<li style="text-align: left;">中间件</li>
<li style="text-align: left;">Form</li>
<li style="text-align: left;">认证系统</li>
<li style="text-align: left;">CSRF</li>
<li style="text-align: left;">分页</li>
<li style="text-align: left;">Cookie</li>
<li style="text-align: left;">Seesion</li>
<li style="text-align: left;">缓存</li>
<li style="text-align: left;">序列化</li>
<li style="text-align: left;">信号</li>
<li style="text-align: left;">admin</li>
</ol>
<h2>一、 Django流程介绍</h2>
<h3><img src="./Django框架全面讲解_files/1014746-20170602161933211-5417733.png" alt="" width="669" height="290"></h3>
<p>MVC是众所周知的模式，即：将应用程序分解成三个组成部分:model(模型),view(视图),和 controller(控制 器)。其中：<br>&nbsp; &nbsp; &nbsp; M——管理应用程序的状态（通常存储到数据库中），并约束改变状态的行为（或者叫做“业务规则”）。<br>&nbsp; &nbsp; &nbsp; C——接受外部用户的操作，根据操作访问模型获取数据，并调用“视图”显示这些数据。控制器是将“模型”和“视图”隔离，并成为二者之间的联系纽带。<br>&nbsp; &nbsp; &nbsp; V——负责把数据格式化后呈现给用户。</p>
<p>Django也是一个MVC框架。但是在Django中，控制器接受用户输入的部分由框架自行处理，所以 Django 里更关注的是模型（Model）、模板(Template)和视图（Views），称为 MTV模式：<br><br>&nbsp;&nbsp;&nbsp; M 代表模型（Model），即数据存取层。 该层处理与数据相关的所有事务： 如何存取、如何验证有效性、包含哪些行为以及数据之间的关系等。<br><br>&nbsp;&nbsp;&nbsp; T 代表模板(Template)，即表现层。 该层处理与表现相关的决定： 如何在页面或其他类型文档中进行显示。<br><br>&nbsp;&nbsp;&nbsp; V 代表视图（View），即业务逻辑层。 该层包含存取模型及调取恰当模板的相关逻辑。 你可以把它看作模型与模板之间的桥梁。</p>
<p>&nbsp;</p>
<h2>二、 Django 基本配置</h2>
<h4><strong>1. 创建django程序</strong></h4>
<ul>
<li>终端命令：django-admin startproject sitename &nbsp;(在当前目录下创建一个Django程序)</li>
<li>IDE创建Django程序时，本质上都是自动执行上述命令</li>









</ul>
<p>其他常用命令：</p>
<p>　　python manage.py runserver ip:port &nbsp;(启动服务器，默认ip和端口为http://127.0.0.1:8000/)</p>
<p>　　python manage.py startapp appname &nbsp;(新建 app)</p>
<p>　　python manage.py syncdb &nbsp;(同步数据库命令，Django 1.7及以上版本需要用以下的命令）</p>
<p>　　python manage.py makemigrations &nbsp;(显示并记录所有数据的改动)</p>
<p>　　python manage.py migrate &nbsp;(将改动更新到数据库)</p>
<p>　　python manage.py createsuperuser &nbsp;(创建超级管理员)</p>
<p>　　python manage.py dbshell &nbsp;(数据库命令行)</p>
<p>　　python manage.py &nbsp;(查看命令列表)</p>
<p>&nbsp;</p>
<h4><strong>2. 程序目录</strong></h4>
<p><img src="./Django框架全面讲解_files/425762-20160306052708955-2108919642.png" alt="" width="363" height="187"></p>
<p>&nbsp;</p>
<h4><strong>3. 配置文件</strong></h4>
<h4><strong>a、数据库</strong></h4>
<p>支持SQLite 3（默认）、PostgreSQL 、MySQL、Oracle数据库的操作</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;285af3a2-23d8-4b5a-bd35-ec7538bc1ff4&#39;)"><img id="code_img_closed_285af3a2-23d8-4b5a-bd35-ec7538bc1ff4" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_285af3a2-23d8-4b5a-bd35-ec7538bc1ff4" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;285af3a2-23d8-4b5a-bd35-ec7538bc1ff4&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_285af3a2-23d8-4b5a-bd35-ec7538bc1ff4" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 默认是SQLit 3 的配置</span>
<span style="color: #000000;">
DATABASES </span>=<span style="color: #000000;"> {
    </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">ENGINE</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.db.backends.sqlite3</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">NAME</span><span style="color: #800000;">'</span>: os.path.join(BASE_DIR, <span style="color: #800000;">'</span><span style="color: #800000;">db.sqlite3</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    }
}


</span><span style="color: #008000;">#</span><span style="color: #008000;"> MySQL的配置</span>
<span style="color: #000000;">
DATABASES </span>=<span style="color: #000000;"> {
    </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
    </span><span style="color: #800000;">'</span><span style="color: #800000;">ENGINE</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.db.backends.mysql</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">NAME</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">dbname</span><span style="color: #800000;">'</span>,   <span style="color: #008000;">#</span><span style="color: #008000;">注意这里的数据库应该以utf-8编码</span>
    <span style="color: #800000;">'</span><span style="color: #800000;">USER</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">xxx</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">PASSWORD</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">xxx</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">HOST</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span><span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">PORT</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span><span style="color: #000000;">,
    }
}

</span><span style="color: #008000;">#</span><span style="color: #008000;"> 对于python3的使用者们还需要再加一步操作</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 由于Django内部连接MySQL时使用的是MySQLdb模块，而python3中还无此模块，所以需要使用pymysql来代替</span>
  
<span style="color: #008000;">#</span><span style="color: #008000;"> 如下设置放置的与project同名的配置的 __init__.py文件中</span>
  
<span style="color: #0000ff;">import</span><span style="color: #000000;"> pymysql
pymysql.install_as_MySQLdb()


</span><span style="color: #008000;">#</span><span style="color: #008000;"> PostgreSQL配置</span>
DATABASES =<span style="color: #000000;"> {
    </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">NAME</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">app_data</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">ENGINE</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.db.backends.postgresql_psycopg2</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">USER</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">XXX</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">PASSWORD</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">XXX</span><span style="color: #800000;">'</span><span style="color: #000000;">
    }


</span><span style="color: #008000;">#</span><span style="color: #008000;"> Oracle配置</span>
DATABASES =<span style="color: #000000;"> {
    </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">ENGINE</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.db.backends.oracle</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">NAME</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">xe</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">USER</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">a_user</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">PASSWORD</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">a_password</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">HOST</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span><span style="color: #000000;">,
        </span><span style="color: #800000;">'</span><span style="color: #800000;">PORT</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span><span style="color: #000000;">,
    }
}</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>Django框架对于开发者而言高度透明化，对于不同数据库的具体使用方法是一致的，改变数据库类型只需要变动上述配置即可。</p>
<p>想要了解更多<a href="https://docs.djangoproject.com/en/1.11/ref/databases/#using-a-3rd-party-database-backend" target="_blank">请戳这里</a></p>
<p>&nbsp;</p>
<p><strong>b、静态文件添加</strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;a774f3e8-43a2-4934-8674-f2c0183c065f&#39;)"><img id="code_img_closed_a774f3e8-43a2-4934-8674-f2c0183c065f" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_a774f3e8-43a2-4934-8674-f2c0183c065f" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;a774f3e8-43a2-4934-8674-f2c0183c065f&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_a774f3e8-43a2-4934-8674-f2c0183c065f" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 首先在项目根目录下创建static目录</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> 接着在settings.py 文件下添加</span>
<span style="color: #000000;">
STATIC_URL </span>= <span style="color: #800000;">'</span><span style="color: #800000;">/static/</span><span style="color: #800000;">'</span>  <span style="color: #008000;">#</span><span style="color: #008000;"> 默认已添加，使用静态文件时的前缀</span>
STATICFILES_DIRS =<span style="color: #000000;"> (
        os.path.join(BASE_DIR,</span><span style="color: #800000;">'</span><span style="color: #800000;">static</span><span style="color: #800000;">'</span>), <span style="color: #008000;">#</span><span style="color: #008000;">行末的逗号不能漏</span>
<span style="color: #000000;">    )

</span><span style="color: #008000;">#</span><span style="color: #008000;"> 这样在template中就可以导入static目录下的静态文件啦</span>

<span style="color: #008000;">#</span><span style="color: #008000;"> 例：</span>
&lt;script src=<span style="color: #800000;">"</span><span style="color: #800000;">/static/jquery-1.12.4.js</span><span style="color: #800000;">"</span>&gt;&lt;/script&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>&nbsp;</p>
<h2>三、 Django 路由系统</h2>
<p>URL配置(URLconf)就像Django 所支撑网站的目录。它的本质是URL模式以及要为该URL模式调用的视图函数之间的映射表；你就是以这种方式告诉Django，对于这个URL调用这段代码，对于那个URL调用那段代码。URL的加载是从配置文件中开始。</p>
<p><img src="./Django框架全面讲解_files/1014746-20170530161144305-343974890.png" alt="" width="508" height="276"></p>
<p>参数说明：</p>
<ul>
<li>一个正则表达式字符串</li>
<li>一个可调用对象，通常为一个视图函数或一个指定视图函数路径的字符串</li>
<li>可选的要传递给视图函数的默认参数（字典形式）</li>
<li>一个可选的name参数</li>
</ul>
<p>&nbsp;</p>
<h4><strong>1. 示例</strong></h4>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_858793" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">django.conf.urls&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">url</code></div>
<div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;</code>&nbsp;</div>
<div class="line number3 index2 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">.&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">views</code></div>
<div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;</code>&nbsp;</div>
<div class="line number5 index4 alt2"><code class="python plain">urlpatterns&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">[</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^articles/2003/$'</code><code class="python plain">, views.special_case_2003),</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^articles/([0-9]{4})/$'</code><code class="python plain">, views.year_archive),</code></div>
<div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^articles/([0-9]{4})/([0-9]{2})/$'</code><code class="python plain">, views.month_archive),</code></div>
<div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^articles/([0-9]{4})/([0-9]{2})/([0-9]+)/$'</code><code class="python plain">, views.article_detail),</code></div>
<div class="line number10 index9 alt1"><code class="python plain">]</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>说明:</p>
<ul class="simple">
<li>要捕获从URL中的值，用括号括起来，会当参数传入 views 视图。</li>
<li>没有必要添加一个斜线，因为每个URL都有。例如，它<code class="docutils literal">^articles</code>不是<code class="docutils literal">^/articles</code>。</li>
<li>在<code class="docutils literal">'r'</code>前面的每个正则表达式字符串中是可选的，但建议。它告诉Python字符串是“原始” -没有什么字符串中应该进行转义。</li>
</ul>
<p>请求示例:</p>
<ul class="simple">
<li>一个请求&nbsp;<code class="docutils literal">/articles/2005/03/</code>&nbsp;会匹配上面列表中的第三条. Django 会调用函数&nbsp;<code class="docutils literal"><span class="pre">views.month_archive(request,&nbsp;<span class="pre">'2005',&nbsp;<span class="pre">'03')</span></span></span></code>.</li>
<li><code class="docutils literal">/articles/2005/3/</code>&nbsp;不会匹配上面列表中的任何条目, 因为第三条的月份需要二位数字.</li>
<li><code class="docutils literal">/articles/2003/</code>&nbsp;会匹配上第一条而不是第二条，因为匹配是按照从上到下顺序而进行的， Django 会调用函数&nbsp;<code class="docutils literal">views.special_case_2003(request)</code></li>
<li><code class="docutils literal">/articles/2003</code>&nbsp;不会匹配上面列表中的任何条目, 因为每个URL应该以 / 结尾.</li>
<li><code class="docutils literal">/articles/2003/03/03/</code>&nbsp;会匹配上最后一条. Django 会调用函数&nbsp;<code class="docutils literal"><span class="pre">views.article_detail(request,&nbsp;<span class="pre">'2003',&nbsp;<span class="pre">'03',&nbsp;<span class="pre">'03')</span></span></span></span></code>.</li>
</ul>
<h4>&nbsp;</h4>
<h4><strong>2. 命名组（Named groups）</strong></h4>
<p>在上面的简单例子中，并没有使用正则表达式分组，在更高级的用法中，很有可能使用正则分组来匹配URL并且将分组值通过参数传递给view函数。</p>
<p>在Python的正则表达式中，分组的语法是&nbsp;<code class="docutils literal">(?P&lt;name&gt;pattern)</code>, name表示分组名，pattern表示一些匹配正则.</p>
<p>这里是一个简单的小例子：</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_661106" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python comments"># 正则知识</code></div>
<div class="line number2 index1 alt1"><code class="python keyword">import</code>&nbsp;<code class="python plain">re</code></div>
<div class="line number3 index2 alt2">&nbsp;</div>
<div class="line number4 index3 alt1"><code class="python plain">ret</code><code class="python keyword">=</code><code class="python plain">re.search(</code><code class="python string">'(?P&lt;id&gt;\d{3})/(?P&lt;name&gt;\w{3})'</code><code class="python plain">,</code><code class="python string">'weeew34ttt123/ooo'</code><code class="python plain">)</code></div>
<div class="line number5 index4 alt2">&nbsp;</div>
<div class="line number6 index5 alt1"><code class="python functions">print</code><code class="python plain">(ret.group())</code></div>
<div class="line number7 index6 alt2"><code class="python functions">print</code><code class="python plain">(ret.group(</code><code class="python string">'id'</code><code class="python plain">))</code></div>
<div class="line number8 index7 alt1"><code class="python functions">print</code><code class="python plain">(ret.group(</code><code class="python string">'name'</code><code class="python plain">))</code></div>
<div class="line number9 index8 alt2"><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code><code class="python keyword">-</code></div>
<div class="line number10 index9 alt1"><code class="python value">123</code><code class="python keyword">/</code><code class="python plain">ooo</code></div>
<div class="line number11 index10 alt2"><code class="python value">123</code></div>
<div class="line number12 index11 alt1"><code class="python plain">ooo</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>　　</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_233795" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">django.conf.urls&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">url</code></div>
<div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;</code>&nbsp;</div>
<div class="line number3 index2 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">.&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">views</code></div>
<div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;</code>&nbsp;</div>
<div class="line number5 index4 alt2"><code class="python plain">urlpatterns&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">[</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^articles/2003/$'</code><code class="python plain">, views.special_case_2003),</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^articles/(?P&lt;year&gt;[0-9]{4})/$'</code><code class="python plain">, views.year_archive),</code></div>
<div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^articles/(?P&lt;year&gt;[0-9]{4})/(?P&lt;month&gt;[0-9]{2})/$'</code><code class="python plain">, views.month_archive),</code></div>
<div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^articles/(?P&lt;year&gt;[0-9]{4})/(?P&lt;month&gt;[0-9]{2})/(?P&lt;day&gt;[0-9]{2})/$'</code><code class="python plain">, views.article_detail),</code></div>
<div class="line number10 index9 alt1"><code class="python plain">]</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>For example:</p>
<ul class="simple">
<li>A request to&nbsp;<code class="docutils literal">/articles/2005/03/</code>&nbsp;会调用函数&nbsp;<code class="docutils literal"><span class="pre">views.month_archive(request,&nbsp;<span class="pre">year='2005',<span class="pre">month='03')</span></span></span></code>, 而不是&nbsp;<code class="docutils literal"><span class="pre">views.month_archive(request,&nbsp;<span class="pre">'2005',&nbsp;<span class="pre">'03')</span></span></span></code>.</li>
<li>A request to&nbsp;<code class="docutils literal">/articles/2003/03/03/</code>&nbsp;会调用函数&nbsp;<code class="docutils literal"><span class="pre">views.article_detail(request,&nbsp;<span class="pre">year='2003',<span class="pre">month='03',&nbsp;<span class="pre">day='03')</span></span></span></span></code>.</li>
</ul>
<p>常见写法实例：</p>
<p><img src="./Django框架全面讲解_files/877318-20160725100643325-920458012.png" alt="" width="438" height="308"></p>
<h4>&nbsp;</h4>
<h4><strong>3. 二级路由（Including）</strong></h4>
<p>那如果映射 url 太多怎么办，全写一个在 &nbsp;urlpatterns 显得繁琐，so 二级路由应用而生</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_416254" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">django.conf.urls&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">include, url</code></div>
<div class="line number2 index1 alt1">&nbsp;</div>
<div class="line number3 index2 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">apps.main&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">views as main_views</code></div>
<div class="line number4 index3 alt1"><code class="python keyword">from</code>&nbsp;<code class="python plain">credit&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">views as credit_views</code></div>
<div class="line number5 index4 alt2">&nbsp;</div>
<div class="line number6 index5 alt1"><code class="python plain">extra_patterns&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">[</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^reports/$'</code><code class="python plain">, credit_views.report),</code></div>
<div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^reports/(?P&lt;id&gt;[0-9]+)/$'</code><code class="python plain">, credit_views.report),</code></div>
<div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^charge/$'</code><code class="python plain">, credit_views.charge),</code></div>
<div class="line number10 index9 alt1"><code class="python plain">]</code></div>
<div class="line number11 index10 alt2">&nbsp;</div>
<div class="line number12 index11 alt1"><code class="python plain">urlpatterns&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">[</code></div>
<div class="line number13 index12 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^$'</code><code class="python plain">, main_views.homepage),</code></div>
<div class="line number14 index13 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^help/'</code><code class="python plain">, include(</code><code class="python string">'apps.help.urls'</code><code class="python plain">)),</code></div>
<div class="line number15 index14 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^credit/'</code><code class="python plain">, include(extra_patterns)),</code></div>
<div class="line number16 index15 alt1"><code class="python plain">]</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>在上面这个例子中，如果请求url为&nbsp;<code class="docutils literal">/credit/reports/</code>&nbsp;则会调用函数&nbsp;<code class="docutils literal">credit_views.report()</code>.</p>
<p>&nbsp;</p>
<p>使用二级路由也可以减少代码冗余，使代码更加简洁易懂</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_378931" class="syntaxhighlighter   python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python comments"># 原始版本</code></div>
<div class="line number2 index1 alt1"><code class="python keyword">from</code>&nbsp;<code class="python plain">django.conf.urls&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">url</code></div>
<div class="line number3 index2 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">.&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">views</code></div>
<div class="line number4 index3 alt1">&nbsp;</div>
<div class="line number5 index4 alt2"><code class="python plain">urlpatterns&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">[</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^(?P&lt;page_slug&gt;[\w-]+)-(?P&lt;page_id&gt;\w+)/history/$'</code><code class="python plain">, views.history),</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^(?P&lt;page_slug&gt;[\w-]+)-(?P&lt;page_id&gt;\w+)/edit/$'</code><code class="python plain">, views.edit),</code></div>
<div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^(?P&lt;page_slug&gt;[\w-]+)-(?P&lt;page_id&gt;\w+)/discuss/$'</code><code class="python plain">, views.discuss),</code></div>
<div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^(?P&lt;page_slug&gt;[\w-]+)-(?P&lt;page_id&gt;\w+)/permissions/$'</code><code class="python plain">, views.permissions),</code></div>
<div class="line number10 index9 alt1"><code class="python plain">]</code></div>
<div class="line number11 index10 alt2">&nbsp;</div>
<div class="line number12 index11 alt1">&nbsp;</div>
<div class="line number13 index12 alt2"><code class="python comments"># 改进版本</code></div>
<div class="line number14 index13 alt1"><code class="python keyword">from</code>&nbsp;<code class="python plain">django.conf.urls&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">include, url</code></div>
<div class="line number15 index14 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">.&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">views</code></div>
<div class="line number16 index15 alt1">&nbsp;</div>
<div class="line number17 index16 alt2"><code class="python plain">urlpatterns&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">[</code></div>
<div class="line number18 index17 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^(?P&lt;page_slug&gt;[\w-]+)-(?P&lt;page_id&gt;\w+)/'</code><code class="python plain">, include([</code></div>
<div class="line number19 index18 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^history/$'</code><code class="python plain">, views.history),</code></div>
<div class="line number20 index19 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^edit/$'</code><code class="python plain">, views.edit),</code></div>
<div class="line number21 index20 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^discuss/$'</code><code class="python plain">, views.discuss),</code></div>
<div class="line number22 index21 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^permissions/$'</code><code class="python plain">, views.permissions),</code></div>
<div class="line number23 index22 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">])),</code></div>
<div class="line number24 index23 alt1"><code class="python plain">]</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>　　</p>
<h4><strong>4. 添加额外的参数</strong></h4>
<p>URLconfs 有一个钩子可以让你加入一些额外的参数到view函数中.</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_29544" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">django.conf.urls&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">url</code></div>
<div class="line number2 index1 alt1"><code class="python keyword">from</code>&nbsp;<code class="python plain">.&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">views</code></div>
<div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;</code>&nbsp;</div>
<div class="line number4 index3 alt1"><code class="python plain">urlpatterns&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">[</code></div>
<div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^blog/(?P&lt;year&gt;[0-9]{4})/$'</code><code class="python plain">, views.year_archive, {</code><code class="python string">'foo'</code><code class="python plain">:&nbsp;</code><code class="python string">'bar'</code><code class="python plain">}),</code></div>
<div class="line number6 index5 alt1"><code class="python plain">]</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>在上面的例子中，如果一个请求为&nbsp;<code class="docutils literal">/blog/2005/</code>, Django 将会调用函数l&nbsp;<code class="docutils literal"><span class="pre">views.year_archive(request,&nbsp;<span class="pre">year='2005',<span class="pre">foo='bar')</span></span></span></code>.</p>
<p><em>需要注意的是，当你加上参数时，对应函数views.year_archive必须加上一个参数，参数名也必须命名为 foo，如下：</em></p>
<p>&nbsp;</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_314604" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">def</code>&nbsp;<code class="python plain">year_archive(request, foo):</code></div>
<div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">(foo)</code></div>
<div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code>&nbsp;<code class="python plain">render(request,&nbsp;</code><code class="python string">'index.html'</code><code class="python plain">)</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>　　</p>
<h4><strong>5. 别名的使用</strong></h4>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_296980" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python plain">url(r</code><code class="python string">'^index'</code><code class="python plain">,views.index,name</code><code class="python keyword">=</code><code class="python string">'bieming'</code><code class="python plain">)</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>url中还支持name参数的配置，如果配置了name属性，在模板的文件中就可以使用name值来代替相应的url值.</p>
<p>我们来看一个例子：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;ba6acfee-c6c6-4f80-8059-6236ba3b0b09&#39;)"><img id="code_img_closed_ba6acfee-c6c6-4f80-8059-6236ba3b0b09" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_ba6acfee-c6c6-4f80-8059-6236ba3b0b09" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;ba6acfee-c6c6-4f80-8059-6236ba3b0b09&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_ba6acfee-c6c6-4f80-8059-6236ba3b0b09" class="cnblogs_code_hide">
<pre>urlpatterns =<span style="color: #000000;"> [
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^index</span><span style="color: #800000;">'</span>,views.index,name=<span style="color: #800000;">'</span><span style="color: #800000;">bieming</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^admin/</span><span style="color: #800000;">'</span><span style="color: #000000;">, admin.site.urls),
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> url(r'^articles/2003/$', views.special_case_2003),</span>
    url(r<span style="color: #800000;">'</span><span style="color: #800000;">^articles/([0-9]{4})/$</span><span style="color: #800000;">'</span><span style="color: #000000;">, views.year_archive),
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> url(r'^articles/([0-9]{4})/([0-9]{2})/$', views.month_archive),</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> url(r'^articles/([0-9]{4})/([0-9]{2})/([0-9]+)/$', views.article_detail),</span>
<span style="color: #000000;">
]
</span><span style="color: #008000;">#</span><span style="color: #008000;">##################</span>

<span style="color: #0000ff;">def</span><span style="color: #000000;"> index(req):
    </span><span style="color: #0000ff;">if</span> req.method==<span style="color: #800000;">'</span><span style="color: #800000;">POST</span><span style="color: #800000;">'</span><span style="color: #000000;">:
        username</span>=req.POST.get(<span style="color: #800000;">'</span><span style="color: #800000;">username</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        password</span>=req.POST.get(<span style="color: #800000;">'</span><span style="color: #800000;">password</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> username==<span style="color: #800000;">'</span><span style="color: #800000;">alex</span><span style="color: #800000;">'</span> <span style="color: #0000ff;">and</span> password==<span style="color: #800000;">'</span><span style="color: #800000;">123</span><span style="color: #800000;">'</span><span style="color: #000000;">:
            </span><span style="color: #0000ff;">return</span> HttpResponse(<span style="color: #800000;">"</span><span style="color: #800000;">登陆成功</span><span style="color: #800000;">"</span><span style="color: #000000;">)



    </span><span style="color: #0000ff;">return</span> render(req,<span style="color: #800000;">'</span><span style="color: #800000;">index.html</span><span style="color: #800000;">'</span><span style="color: #000000;">)

</span><span style="color: #008000;">#</span><span style="color: #008000;">####################</span>

&lt;!DOCTYPE html&gt;
&lt;html lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
&lt;head&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;<span style="color: #000000;">
{</span><span style="color: #008000;">#</span><span style="color: #008000;">     &lt;form action="/index/" method="post"&gt;#}</span>
{<span style="color: #008000;">#</span><span style="color: #008000;">     这里只要使用bieming即可代替/index #}</span>
     &lt;form action=<span style="color: #800000;">"</span><span style="color: #800000;">{% url 'bieming' %}</span><span style="color: #800000;">"</span> method=<span style="color: #800000;">"</span><span style="color: #800000;">post</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
         用户名:</span>&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">text</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">username</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
         密码:</span>&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">password</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">password</span><span style="color: #800000;">"</span>&gt;
         &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span>&gt;
     &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4><strong>6. 指定view的默认配置</strong></h4>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_713799" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python comments"># URLconf</code></div>
<div class="line number2 index1 alt1"><code class="python keyword">from</code>&nbsp;<code class="python plain">django.conf.urls&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">url</code></div>
<div class="line number3 index2 alt2">&nbsp;</div>
<div class="line number4 index3 alt1"><code class="python keyword">from</code>&nbsp;<code class="python plain">.&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">views</code></div>
<div class="line number5 index4 alt2">&nbsp;</div>
<div class="line number6 index5 alt1"><code class="python plain">urlpatterns&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">[</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^blog/$'</code><code class="python plain">, views.page),</code></div>
<div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">url(r</code><code class="python string">'^blog/page(?P&lt;num&gt;[0-9]+)/$'</code><code class="python plain">, views.page),</code></div>
<div class="line number9 index8 alt2"><code class="python plain">]</code></div>
<div class="line number10 index9 alt1">&nbsp;</div>
<div class="line number11 index10 alt2"><code class="python comments"># View (in blog/views.py)</code></div>
<div class="line number12 index11 alt1"><code class="python keyword">def</code>&nbsp;<code class="python plain">page(request, num</code><code class="python keyword">=</code><code class="python string">"1"</code><code class="python plain">):</code></div>
<div class="line number13 index12 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># Output the appropriate page of blog entries, according to num.</code></div>
<div class="line number14 index13 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">...</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>在上述的例子中，两个 URL 模式指向同一个视图&nbsp;<code class="docutils literal">views.page&nbsp;</code>但第一图案不捕获从 URL 任何东西。如果第一个模式匹配，该&nbsp;<code class="docutils literal">page()&nbsp;</code>函数将使用它的默认参数&nbsp;<code class="docutils literal">num</code>，<code class="docutils literal">"1"</code>。如果第二图案相匹配时，&nbsp;<code class="docutils literal">page()</code>将使用任何&nbsp;<code class="docutils literal">num&nbsp;</code>值由正则表达式捕获。</p>
<p>&nbsp;</p>
<h2>四、 Django Views（视图函数）</h2>
<p>http请求中产生两个核心对象：</p>
<p>　　http请求：HttpRequest对象</p>
<p>　　http响应：HttpResponse对象</p>
<p>&nbsp;</p>
<h4>1. HttpRequest对象</h4>
<p>当请求一个页面时，Django 创建一个&nbsp;<code class="xref py py-class docutils literal">HttpRequest</code>对象包含原数据的请求。然后 Django 加载适当的视图，通过&nbsp;<code class="xref py py-class docutils literal">HttpRequest</code>作为视图函数的第一个参数。每个视图负责返回一个<code class="xref py py-class docutils literal">HttpResponse</code>目标。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;c9485c20-bc7d-423a-b29e-327e42d4428f&#39;)"><img id="code_img_closed_c9485c20-bc7d-423a-b29e-327e42d4428f" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt="">HttpRequest对象属性<span style="background-color: #ffffff;"><br></span></div>
<h4>2. HttpResponse对象</h4>
<p>对于HttpRequest对象来说，是由django自动创建的，但是，HttpResponse对象就必须我们自己创建。每个view请求处理方法必须返回一个HttpResponse对象。</p>
<p>在HttpResponse对象上扩展的常用方法：</p>
<ul>
<li><strong>页面渲染：render（推荐），render_to_response,</strong></li>
<li><strong>页面跳转：redirect</strong></li>
<li><strong>locals： &nbsp; 可以直接将对应视图函数中所有的变量传给模板 &nbsp; &nbsp;</strong></li>





</ul>
<p><img src="./Django框架全面讲解_files/1014746-20170531152042227-429182463.png" alt="" width="566" height="194"></p>
<p>值得注意的是对于页面渲染的方法中，render和render_to_response使用方法和功能类似，但是render功能更为强大，推荐使用</p>
<h3>&nbsp;</h3>
<h4 id="autoid-4-1-0">3. render()</h4>
<dl class="function"><dt id="django.shortcuts.render">render(<em>request</em>,&nbsp;<em>template_name</em>,&nbsp;<em>context=None</em>,&nbsp;<em>content_type=None</em>,&nbsp;<em>status=None</em>,&nbsp;<em>using=None</em>)<span class="viewcode-link">[source]<a class="headerlink" title="Permalink to this definition" href="https://docs.djangoproject.com/en/1.10/topics/http/shortcuts/#django.shortcuts.render"><br></a></span></dt><dt><span class="viewcode-link">结合给定的模板与一个给定的上下文，返回一个字典<span class="pre">HttpResponse在渲染文本对象</span></span></dt></dl>
<h4 id="autoid-4-1-0">所需的参数</h4>
<p>&nbsp;template_name&nbsp;一个模板的使用或模板序列名称全称。如果序列是给定的，存在于第一个模板将被使用。</p>
<h4 id="autoid-4-1-0">可选参数<a class="headerlink" title="Permalink to this headline" href="https://docs.djangoproject.com/en/1.10/topics/http/shortcuts/#optional-arguments"><br></a></h4>
<p>context &nbsp; &nbsp;一组字典的值添加到模板中。默认情况下，这是一个空的字典。</p>
<p>content_type &nbsp; &nbsp;MIME类型用于生成文档。</p>
<p>status &nbsp; &nbsp;为响应状态代码。默认值为<code class="docutils literal">200</code></p>
<p>using &nbsp; &nbsp;这个名字一个模板引擎的使用将模板。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;1f05262a-778c-4d25-819a-79b824c72cf0&#39;)"><img id="code_img_closed_1f05262a-778c-4d25-819a-79b824c72cf0" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_1f05262a-778c-4d25-819a-79b824c72cf0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;1f05262a-778c-4d25-819a-79b824c72cf0&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_1f05262a-778c-4d25-819a-79b824c72cf0" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.shortcuts <span style="color: #0000ff;">import</span><span style="color: #000000;"> render

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> my_view(request):
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> View code here...</span>
    <span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">myapp/index.html</span><span style="color: #800000;">'</span><span style="color: #000000;">, {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">foo</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">bar</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    }, content_type</span>=<span style="color: #800000;">'</span><span style="color: #800000;">application/xhtml+xml</span><span style="color: #800000;">'</span>)</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h2>五、 模板</h2>
<h4>1. 模板的执行</h4>
<p>模版的创建过程，对于模版，其实就是读取模版（其中嵌套着模版标签），然后将 Model 中获取的数据插入到模版中，最后将信息返回给用户。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;42f5c255-8a0e-4ecc-b91a-0c939f1b31fa&#39;)"><img id="code_img_closed_42f5c255-8a0e-4ecc-b91a-0c939f1b31fa" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_42f5c255-8a0e-4ecc-b91a-0c939f1b31fa" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;42f5c255-8a0e-4ecc-b91a-0c939f1b31fa&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_42f5c255-8a0e-4ecc-b91a-0c939f1b31fa" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> view.py</span>

<span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">index.html</span><span style="color: #800000;">'</span>, {<span style="color: #800000;">'</span><span style="color: #800000;">title</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">welcome</span><span style="color: #800000;">'</span><span style="color: #000000;">})


</span><span style="color: #008000;">#</span><span style="color: #008000;"> index.html</span>

&lt;!DOCTYPE html&gt;
&lt;html lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
&lt;head&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt;
        &lt;h1&gt;{{ title }}&lt;/h1&gt;
    &lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>2. &nbsp;模板语言</h4>
<p>模板中也有自己的语言，该语言可以实现数据展示</p>
<ul>
<ul>
<li>{{ item }}</li>
<li>{% for item in item_list %} &nbsp;&lt;a&gt;{{ item }}&lt;/a&gt; &nbsp;{% endfor %}<br>　　forloop.counter<br>　　forloop.first<br>　　forloop.last&nbsp;</li>
<li>{% if ordered_warranty %} &nbsp;{% else %} {% endif %}</li>
<li>母板：{% block title %}{% endblock %}<br>子板：{% extends "base.html" %}<br>　　　{% block title %}{% endblock %}</li>
<li>帮助方法：<br>{{ item.event_start|date:"Y-m-d H:i:s"}}<br>{{ bio|truncatewords:"30" }}<br>{{ my_list|first|upper }}<br>{{ name|lower }}</li>









</ul>









</ul>
<p>&nbsp;小知识点：在模板语言中字典数据类型的取值是通过dict.xxx而不是dict[xxx]</p>
<h4>&nbsp;</h4>
<h4 id="autoid-5-2-0"><strong>3. 自定义标签</strong></h4>
<p>因为在模板语言中不能够做运算等一些稍显复杂的操作，所以在Django中提供了两种自定制标签，一种是simple_tag，一种是filter。</p>
<p>simple_tag: 任意传递参数，但是不能用作布尔判断</p>
<p>filter: 最多只能传递二个参数，可以用作布尔判断</p>
<p>在这里着重介绍simple_tag类型，filter的实现类似</p>
<p>a、在app中创建templatetags模块</p>
<p>b、创建任意 .py 文件，如：xx.py</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;dd3879a1-c01e-4403-9c75-f517db161bfd&#39;)"><img id="code_img_closed_dd3879a1-c01e-4403-9c75-f517db161bfd" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_dd3879a1-c01e-4403-9c75-f517db161bfd" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;dd3879a1-c01e-4403-9c75-f517db161bfd&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_dd3879a1-c01e-4403-9c75-f517db161bfd" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;">coding:utf-8</span>
<span style="color: #0000ff;">from</span> django <span style="color: #0000ff;">import</span><span style="color: #000000;"> template
</span><span style="color: #0000ff;">from</span> django.utils.safestring <span style="color: #0000ff;">import</span><span style="color: #000000;"> mark_safe
</span><span style="color: #0000ff;">from</span> django.template.base <span style="color: #0000ff;">import</span><span style="color: #000000;"> resolve_variable, Node, TemplateSyntaxError
  
register </span>=<span style="color: #000000;"> template.Library()
  
@register.simple_tag
</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> my_simple_time(v1,v2,v3):
    </span><span style="color: #0000ff;">return</span>  v1 + v2 +<span style="color: #000000;"> v3
  
@register.simple_tag
</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> my_input(id,arg):
    result </span>= <span style="color: #800000;">"</span><span style="color: #800000;">&lt;input type='text' id='%s' class='%s' /&gt;</span><span style="color: #800000;">"</span> %<span style="color: #000000;">(id,arg,)
    </span><span style="color: #0000ff;">return</span> mark_safe(result)</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>c、在使用自定义simple_tag的html文件中导入之前创建的 xx.py 文件名</p>
<div class="cnblogs_code">
<pre>{% load xx %}</pre>
</div>
<p>d、使用simple_tag</p>
<div class="cnblogs_code">
<pre>{% my_simple_time 1 2 3%}
{% my_input 'id_username' 'hide'%}</pre>
</div>
<p>e、在settings中配置当前app，不然django无法找到自定义的simple_tag</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;25c40ff4-d5c2-4cd4-8fa9-1050dbeaba59&#39;)"><img id="code_img_closed_25c40ff4-d5c2-4cd4-8fa9-1050dbeaba59" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_25c40ff4-d5c2-4cd4-8fa9-1050dbeaba59" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;25c40ff4-d5c2-4cd4-8fa9-1050dbeaba59&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_25c40ff4-d5c2-4cd4-8fa9-1050dbeaba59" class="cnblogs_code_hide">
<pre>INSTALLED_APPS =<span style="color: #000000;"> (
    </span><span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.admin</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.auth</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.contenttypes</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.sessions</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.messages</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.staticfiles</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    </span><span style="color: #800000;">'</span><span style="color: #800000;">app01</span><span style="color: #800000;">'</span><span style="color: #000000;">,
)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><em>更多见文档：<a href="https://docs.djangoproject.com/en/1.10/ref/templates/language/" target="_blank">https://docs.djangoproject.com/en/1.10/ref/templates/language/</a></em></p>
<p>&nbsp;</p>
<h2>六、 Model</h2>
<p>Django提供了一个抽象层（“Model”）来构建和管理Web应用程序的数据。</p>
<p>django中遵循&nbsp;Code Frist&nbsp;的原则，即：根据代码中定义的类来自动生成数据库表。</p>
<p>关系对象映射（Object Relational Mapping，简称ORM）。</p>
<p>&nbsp;</p>
<h4>1. 创建表</h4>
<p>a、基本结构</p>
<p><code class="python keyword">from</code>&nbsp;<code class="python plain">django.db&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">models</code></p>
<div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div>
<div class="line number3 index2 alt2"><code class="python plain">　</code><code class="python keyword">class</code>&nbsp;<code class="python plain">userinfo(models.Model):</code></div>
<div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">name&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">models.CharField(max_length</code><code class="python keyword">=</code><code class="python value">30</code><code class="python plain">)</code></div>
<div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">email&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">models.EmailField()</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">memo&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">models.TextField()</code></div>
<div class="line number6 index5 alt1">
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;b47065ba-a80e-493c-8de7-248034ef7558&#39;)"><img id="code_img_closed_b47065ba-a80e-493c-8de7-248034ef7558" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_b47065ba-a80e-493c-8de7-248034ef7558" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;b47065ba-a80e-493c-8de7-248034ef7558&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_b47065ba-a80e-493c-8de7-248034ef7558" class="cnblogs_code_hide">
<pre>1、null=<span style="color: #000000;">True
　　数据库中字段是否可以为空
</span>2、blank=<span style="color: #000000;">True
　　django的 Admin 中添加数据时是否可允许空值
</span>3、primary_key =<span style="color: #000000;"> False
　　主键，对AutoField设置主键后，就会代替原来的自增 id 列
</span>4<span style="color: #000000;">、auto_now 和 auto_now_add
　　auto_now   自动创建</span>---<span style="color: #000000;">无论添加或修改，都是当前操作的时间
　　auto_now_add  自动创建</span>---<span style="color: #000000;">永远是创建时的时间
</span>5<span style="color: #000000;">、choices
GENDER_CHOICE </span>=<span style="color: #000000;"> (
        (u</span><span style="color: #800000;">'</span><span style="color: #800000;">M</span><span style="color: #800000;">'</span>, u<span style="color: #800000;">'</span><span style="color: #800000;">Male</span><span style="color: #800000;">'</span><span style="color: #000000;">),
        (u</span><span style="color: #800000;">'</span><span style="color: #800000;">F</span><span style="color: #800000;">'</span>, u<span style="color: #800000;">'</span><span style="color: #800000;">Female</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    )
gender </span>= models.CharField(max_length=2,choices =<span style="color: #000000;"> GENDER_CHOICE)
</span>6<span style="color: #000000;">、max_length
</span>7<span style="color: #000000;">、default　　默认值
</span>8<span style="color: #000000;">、verbose_name　　Admin中字段的显示名称
</span>9、name|<span style="color: #000000;">db_column　　数据库中的字段名称
</span>10、unique=<span style="color: #000000;">True　　不允许重复
</span>11、db_index =<span style="color: #000000;"> True　　数据库索引
</span>12、editable=<span style="color: #000000;">True　　在Admin里是否可编辑
</span>13、error_messages=<span style="color: #000000;">None　　错误提示
</span>14、auto_created=<span style="color: #000000;">False　　自动创建
</span>15<span style="color: #000000;">、help_text　　在Admin中提示帮助信息
</span>16、validators=<span style="color: #000000;">[]
</span>17、upload-to</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;52cb6ba2-35f9-43c6-b2ae-8ac4f1cf405c&#39;)"><img id="code_img_closed_52cb6ba2-35f9-43c6-b2ae-8ac4f1cf405c" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_52cb6ba2-35f9-43c6-b2ae-8ac4f1cf405c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;52cb6ba2-35f9-43c6-b2ae-8ac4f1cf405c&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_52cb6ba2-35f9-43c6-b2ae-8ac4f1cf405c" class="cnblogs_code_hide">
<pre>1、models.AutoField　　自增列 = int(11<span style="color: #000000;">)
　　如果没有的话，默认会生成一个名称为 id 的列，如果要显示的自定义一个自增列，必须将给列设置为主键 primary_key</span>=<span style="color: #000000;">True。
</span>2<span style="color: #000000;">、models.CharField　　字符串字段
　　必须 max_length 参数
</span>3、models.BooleanField　　布尔类型=tinyint(1<span style="color: #000000;">)
　　不能为空，Blank</span>=<span style="color: #000000;">True
</span>4、models.ComaSeparatedIntegerField　　用逗号分割的数字=<span style="color: #000000;">varchar
　　继承CharField，所以必须 max_lenght 参数
</span>5<span style="color: #000000;">、models.DateField　　日期类型 date
　　对于参数，auto_now </span>=<span style="color: #000000;"> True 则每次更新都会更新这个时间；auto_now_add 则只是第一次创建添加，之后的更新不再改变。
</span>6<span style="color: #000000;">、models.DateTimeField　　日期类型 datetime
　　同DateField的参数
</span>7、models.Decimal　　十进制小数类型 =<span style="color: #000000;"> decimal
　　必须指定整数位max_digits和小数位decimal_places
</span>8、models.EmailField　　字符串类型（正则表达式邮箱） =<span style="color: #000000;">varchar
　　对字符串进行正则表达式
</span>9、models.FloatField　　浮点类型 =<span style="color: #000000;"> double
</span>10<span style="color: #000000;">、models.IntegerField　　整形
</span>11<span style="color: #000000;">、models.BigIntegerField　　长整形
　　integer_field_ranges </span>=<span style="color: #000000;"> {
　　　　</span><span style="color: #800000;">'</span><span style="color: #800000;">SmallIntegerField</span><span style="color: #800000;">'</span>: (-32768, 32767<span style="color: #000000;">),
　　　　</span><span style="color: #800000;">'</span><span style="color: #800000;">IntegerField</span><span style="color: #800000;">'</span>: (-2147483648, 2147483647<span style="color: #000000;">),
　　　　</span><span style="color: #800000;">'</span><span style="color: #800000;">BigIntegerField</span><span style="color: #800000;">'</span>: (-9223372036854775808, 9223372036854775807<span style="color: #000000;">),
　　　　</span><span style="color: #800000;">'</span><span style="color: #800000;">PositiveSmallIntegerField</span><span style="color: #800000;">'</span>: (0, 32767<span style="color: #000000;">),
　　　　</span><span style="color: #800000;">'</span><span style="color: #800000;">PositiveIntegerField</span><span style="color: #800000;">'</span>: (0, 2147483647<span style="color: #000000;">),
　　}
</span>12<span style="color: #000000;">、models.IPAddressField　　字符串类型（ip4正则表达式）
</span>13<span style="color: #000000;">、models.GenericIPAddressField　　字符串类型（ip4和ip6是可选的）
　　参数protocol可以是：both、ipv4、ipv6
　　验证时，会根据设置报错
</span>14<span style="color: #000000;">、models.NullBooleanField　　允许为空的布尔类型
</span>15<span style="color: #000000;">、models.PositiveIntegerFiel　　正Integer
</span>16<span style="color: #000000;">、models.PositiveSmallIntegerField　　正smallInteger
</span>17<span style="color: #000000;">、models.SlugField　　减号、下划线、字母、数字
</span>18<span style="color: #000000;">、models.SmallIntegerField　　数字
　　数据库中的字段有：tinyint、smallint、int、bigint
</span>19、models.TextField　　字符串=<span style="color: #000000;">longtext
</span>20<span style="color: #000000;">、models.TimeField　　时间 HH:MM[:ss[.uuuuuu]]
</span>21<span style="color: #000000;">、models.URLField　　字符串，地址正则表达式
</span>22<span style="color: #000000;">、models.BinaryField　　二进制
</span>23<span style="color: #000000;">、models.ImageField   图片
</span>24、models.FilePathField 文件</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;3ca4edd8-a85f-4489-ae2b-ae3d42e5292c&#39;)"><img id="code_img_closed_3ca4edd8-a85f-4489-ae2b-ae3d42e5292c" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_3ca4edd8-a85f-4489-ae2b-ae3d42e5292c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;3ca4edd8-a85f-4489-ae2b-ae3d42e5292c&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_3ca4edd8-a85f-4489-ae2b-ae3d42e5292c" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfo(models.Model):
        nid </span>= models.AutoField(primary_key=<span style="color: #000000;">True)
        username </span>= models.CharField(max_length=32<span style="color: #000000;">)
        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> 数据库中生成的表名称 默认 app名称 + 下划线 + 类名</span>
            db_table = <span style="color: #800000;">"</span><span style="color: #800000;">table_name</span><span style="color: #800000;">"</span>

            <span style="color: #008000;">#</span><span style="color: #008000;"> 联合索引</span>
            index_together =<span style="color: #000000;"> [
                (</span><span style="color: #800000;">"</span><span style="color: #800000;">pub_date</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">deadline</span><span style="color: #800000;">"</span><span style="color: #000000;">),
            ]

            </span><span style="color: #008000;">#</span><span style="color: #008000;"> 联合唯一索引</span>
            unique_together = ((<span style="color: #800000;">"</span><span style="color: #800000;">driver</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">restaurant</span><span style="color: #800000;">"</span><span style="color: #000000;">),)

            </span><span style="color: #008000;">#</span><span style="color: #008000;"> admin中显示的表名称</span>
<span style="color: #000000;">            verbose_name

            </span><span style="color: #008000;">#</span><span style="color: #008000;"> verbose_name加s</span>
<span style="color: #000000;">            verbose_name_plural
        
    更多：https:</span>//docs.djangoproject.com/en/1.10/ref/models/options/</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;8ec0c5b1-efcd-49b4-84d4-41c3229e46cc&#39;)"><img id="code_img_closed_8ec0c5b1-efcd-49b4-84d4-41c3229e46cc" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_8ec0c5b1-efcd-49b4-84d4-41c3229e46cc" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;8ec0c5b1-efcd-49b4-84d4-41c3229e46cc&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_8ec0c5b1-efcd-49b4-84d4-41c3229e46cc" class="cnblogs_code_hide">
<pre>1<span style="color: #000000;">.触发Model中的验证和错误提示有两种方式：
        a. Django Admin中的错误信息会优先根据Admiin内部的ModelForm错误信息提示，如果都成功，才来检查Model的字段并显示指定错误信息
        b. 调用Model对象的 clean_fields 方法，如：
            </span><span style="color: #008000;">#</span><span style="color: #008000;"> models.py</span>
            <span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfo(models.Model):
                nid </span>= models.AutoField(primary_key=<span style="color: #000000;">True)
                username </span>= models.CharField(max_length=32<span style="color: #000000;">)

                email </span>= models.EmailField(error_messages={<span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">格式错了.</span><span style="color: #800000;">'</span><span style="color: #000000;">})

            </span><span style="color: #008000;">#</span><span style="color: #008000;"> views.py</span>
            <span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
                obj </span>= models.UserInfo(username=<span style="color: #800000;">'</span><span style="color: #800000;">11234</span><span style="color: #800000;">'</span>, email=<span style="color: #800000;">'</span><span style="color: #800000;">uu</span><span style="color: #800000;">'</span><span style="color: #000000;">)
                </span><span style="color: #0000ff;">try</span><span style="color: #000000;">:
                    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(obj.clean_fields())
                </span><span style="color: #0000ff;">except</span><span style="color: #000000;"> Exception as e:
                    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(e)
                </span><span style="color: #0000ff;">return</span> HttpResponse(<span style="color: #800000;">'</span><span style="color: #800000;">ok</span><span style="color: #800000;">'</span><span style="color: #000000;">)

           </span><span style="color: #008000;">#</span><span style="color: #008000;"> Model的clean方法是一个钩子，可用于定制操作，如：上述的异常处理。</span>

    2<span style="color: #000000;">.Admin中修改错误提示
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> admin.py</span>
        <span style="color: #0000ff;">from</span> django.contrib <span style="color: #0000ff;">import</span><span style="color: #000000;"> admin
        </span><span style="color: #0000ff;">from</span> model_club <span style="color: #0000ff;">import</span><span style="color: #000000;"> models
        </span><span style="color: #0000ff;">from</span> django <span style="color: #0000ff;">import</span><span style="color: #000000;"> forms


        </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfoForm(forms.ModelForm):
            username </span>= forms.CharField(error_messages={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">用户名不能为空.</span><span style="color: #800000;">'</span><span style="color: #000000;">})
            email </span>= forms.EmailField(error_messages={<span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">邮箱格式错误.</span><span style="color: #800000;">'</span><span style="color: #000000;">})
            age </span>= forms.IntegerField(initial=1, error_messages={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">请输入数值.</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">年龄必须为数值.</span><span style="color: #800000;">'</span><span style="color: #000000;">})

            </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
                model </span>=<span style="color: #000000;"> models.UserInfo
                </span><span style="color: #008000;">#</span><span style="color: #008000;"> fields = ('username',)</span>
                fields = <span style="color: #800000;">"</span><span style="color: #800000;">__all__</span><span style="color: #800000;">"</span>


        <span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfoAdmin(admin.ModelAdmin):
            form </span>=<span style="color: #000000;"> UserInfoForm


        admin.site.register(models.UserInfo, UserInfoAdmin)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>b、连表结构</p>
<ul>
<li>一对多：models.ForeignKey(其他表)</li>
<li>多对多：models.ManyToManyField(其他表)</li>
<li>一对一：models.OneToOneField(其他表)</li>
</ul>
<blockquote>
<p>应用场景：</p>
<ul>
<li>一对多：当一张表中创建一行数据时，有一个单选的下拉框（可以被重复选择）<br><em>例如：创建用户信息时候，需要选择一个用户类型【普通用户】【金牌用户】【铂金用户】等。</em></li>
<li>多对多：在某表中创建一行数据是，有一个可以多选的下拉框<br><em>例如：创建用户信息，需要为用户指定多个爱好</em></li>
<li>一对一：在某表中创建一行数据时，有一个单选的下拉框（下拉框中的内容被用过一次就消失了<br><em>例如：原有含<em>10列数据的</em>一张表保存相关信息，经过一段时间之后，10列无法满足需求，需要为原来的表再添加5列数据</em></li>









</ul>









</blockquote>








</div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;bc2f17ca-477f-47b3-b9b1-6fd497da7d04&#39;)"><img id="code_img_closed_bc2f17ca-477f-47b3-b9b1-6fd497da7d04" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_bc2f17ca-477f-47b3-b9b1-6fd497da7d04" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;bc2f17ca-477f-47b3-b9b1-6fd497da7d04&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_bc2f17ca-477f-47b3-b9b1-6fd497da7d04" class="cnblogs_code_hide">
<pre>ForeignKey(ForeignObject) <span style="color: #008000;">#</span><span style="color: #008000;"> ForeignObject(RelatedField)</span>
to,                         <span style="color: #008000;">#</span><span style="color: #008000;"> 要进行关联的表名</span>
to_field=None,              <span style="color: #008000;">#</span><span style="color: #008000;"> 要关联的表中的字段名称</span>
on_delete=None,             <span style="color: #008000;">#</span><span style="color: #008000;"> 当删除关联表中的数据时，当前表与其关联的行的行为</span>
-<span style="color: #000000;"> models.CASCADE，删除关联数据，与之关联也删除
</span>-<span style="color: #000000;"> models.DO_NOTHING，删除关联数据，引发错误IntegrityError
</span>-<span style="color: #000000;"> models.PROTECT，删除关联数据，引发错误ProtectedError
</span>-<span style="color: #000000;"> models.SET_NULL，删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）
</span>-<span style="color: #000000;"> models.SET_DEFAULT，删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）
</span>-<span style="color: #000000;"> models.SET，删除关联数据，
a. 与之关联的值设置为指定值，设置：models.SET(值)
b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> func():
    </span><span style="color: #0000ff;">return</span> 10

<span style="color: #0000ff;">class</span><span style="color: #000000;"> MyModel(models.Model):
    user </span>=<span style="color: #000000;"> models.ForeignKey(
        to</span>=<span style="color: #800000;">"</span><span style="color: #800000;">User</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        to_field</span>=<span style="color: #800000;">"</span><span style="color: #800000;">id</span><span style="color: #800000;">"</span><span style="color: #000000;">
    on_delete</span>=<span style="color: #000000;">models.SET(func),)
related_name</span>=None,          <span style="color: #008000;">#</span><span style="color: #008000;"> 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span>
related_query_name=None,    <span style="color: #008000;">#</span><span style="color: #008000;"> 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values('表名__字段名')</span>
limit_choices_to=None,      <span style="color: #008000;">#</span><span style="color: #008000;"> 在Admin或ModelForm中显示关联数据时，提供的条件：</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 如：</span>
- limit_choices_to={<span style="color: #800000;">'</span><span style="color: #800000;">nid__gt</span><span style="color: #800000;">'</span>: 5<span style="color: #000000;">}
</span>- limit_choices_to=<span style="color: #0000ff;">lambda</span> : {<span style="color: #800000;">'</span><span style="color: #800000;">nid__gt</span><span style="color: #800000;">'</span>: 5<span style="color: #000000;">}

</span><span style="color: #0000ff;">from</span> django.db.models <span style="color: #0000ff;">import</span><span style="color: #000000;"> Q
</span>- limit_choices_to=Q(nid__gt=10<span style="color: #000000;">)
</span>- limit_choices_to=Q(nid=8) | Q(nid__gt=10<span style="color: #000000;">)
</span>- limit_choices_to=<span style="color: #0000ff;">lambda</span> : Q(Q(nid=8) | Q(nid__gt=10)) &amp; Q(caption=<span style="color: #800000;">'</span><span style="color: #800000;">root</span><span style="color: #800000;">'</span><span style="color: #000000;">)
db_constraint</span>=True          <span style="color: #008000;">#</span><span style="color: #008000;"> 是否在数据库中创建外键约束</span>
parent_link=False           <span style="color: #008000;">#</span><span style="color: #008000;"> 在Admin中是否显示关联数据</span>
<span style="color: #000000;">

OneToOneField(ForeignKey)
to,                         </span><span style="color: #008000;">#</span><span style="color: #008000;"> 要进行关联的表名</span>
to_field=None               <span style="color: #008000;">#</span><span style="color: #008000;"> 要关联的表中的字段名称</span>
on_delete=None,             <span style="color: #008000;">#</span><span style="color: #008000;"> 当删除关联表中的数据时，当前表与其关联的行的行为</span>

<span style="color: #008000;">#</span><span style="color: #008000;">##### 对于一对一 ######</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 1. 一对一其实就是 一对多 + 唯一索引</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 2.当两个类之间有继承关系时，默认会创建一个一对一字段</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 如下会在A表中额外增加一个c_ptr_id列且唯一：</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> C(models.Model):
    nid </span>= models.AutoField(primary_key=<span style="color: #000000;">True)
    part </span>= models.CharField(max_length=12<span style="color: #000000;">)

</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> A(C):
    id </span>= models.AutoField(primary_key=<span style="color: #000000;">True)
    code </span>= models.CharField(max_length=1<span style="color: #000000;">)

ManyToManyField(RelatedField)
to,                         </span><span style="color: #008000;">#</span><span style="color: #008000;"> 要进行关联的表名</span>
related_name=None,          <span style="color: #008000;">#</span><span style="color: #008000;"> 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span>
related_query_name=None,    <span style="color: #008000;">#</span><span style="color: #008000;"> 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values('表名__字段名')</span>
limit_choices_to=None,      <span style="color: #008000;">#</span><span style="color: #008000;"> 在Admin或ModelForm中显示关联数据时，提供的条件：</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 如：</span>
- limit_choices_to={<span style="color: #800000;">'</span><span style="color: #800000;">nid__gt</span><span style="color: #800000;">'</span>: 5<span style="color: #000000;">}
</span>- limit_choices_to=<span style="color: #0000ff;">lambda</span> : {<span style="color: #800000;">'</span><span style="color: #800000;">nid__gt</span><span style="color: #800000;">'</span>: 5<span style="color: #000000;">}

</span><span style="color: #0000ff;">from</span> django.db.models <span style="color: #0000ff;">import</span><span style="color: #000000;"> Q
</span>- limit_choices_to=Q(nid__gt=10<span style="color: #000000;">)
</span>- limit_choices_to=Q(nid=8) | Q(nid__gt=10<span style="color: #000000;">)
</span>- limit_choices_to=<span style="color: #0000ff;">lambda</span> : Q(Q(nid=8) | Q(nid__gt=10)) &amp; Q(caption=<span style="color: #800000;">'</span><span style="color: #800000;">root</span><span style="color: #800000;">'</span><span style="color: #000000;">)
symmetrical</span>=None,           <span style="color: #008000;">#</span><span style="color: #008000;"> 仅用于多对多自关联时，symmetrical用于指定内部是否创建反向操作的字段</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 做如下操作时，不同的symmetrical会有不同的可选字段</span>
<span style="color: #000000;">models.BB.objects.filter(...)

</span><span style="color: #008000;">#</span><span style="color: #008000;"> 可选字段有：code, id, m1</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> BB(models.Model):

code </span>= models.CharField(max_length=12<span style="color: #000000;">)
m1 </span>= models.ManyToManyField(<span style="color: #800000;">'</span><span style="color: #800000;">self</span><span style="color: #800000;">'</span>,symmetrical=<span style="color: #000000;">True)

</span><span style="color: #008000;">#</span><span style="color: #008000;"> 可选字段有: bb, code, id, m1</span>
<span style="color: #0000ff;">class</span><span style="color: #000000;"> BB(models.Model):

code </span>= models.CharField(max_length=12<span style="color: #000000;">)
m1 </span>= models.ManyToManyField(<span style="color: #800000;">'</span><span style="color: #800000;">self</span><span style="color: #800000;">'</span>,symmetrical=<span style="color: #000000;">False)

through</span>=None,               <span style="color: #008000;">#</span><span style="color: #008000;"> 自定义第三张表时，使用字段用于指定关系表</span>
through_fields=None,        <span style="color: #008000;">#</span><span style="color: #008000;"> 自定义第三张表时，使用字段用于指定关系表中那些字段做多对多关系表</span>
<span style="color: #0000ff;">from</span> django.db <span style="color: #0000ff;">import</span><span style="color: #000000;"> models

</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Person(models.Model):
    name </span>= models.CharField(max_length=50<span style="color: #000000;">)

</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Group(models.Model):
    name </span>= models.CharField(max_length=128<span style="color: #000000;">)
    members </span>=<span style="color: #000000;"> models.ManyToManyField(
        Person,
        through</span>=<span style="color: #800000;">'</span><span style="color: #800000;">Membership</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        through_fields</span>=(<span style="color: #800000;">'</span><span style="color: #800000;">group</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">person</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    )

</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Membership(models.Model):
    group </span>= models.ForeignKey(Group, on_delete=<span style="color: #000000;">models.CASCADE)
    person </span>= models.ForeignKey(Person, on_delete=<span style="color: #000000;">models.CASCADE)
    inviter </span>=<span style="color: #000000;"> models.ForeignKey(
        Person,
        on_delete</span>=<span style="color: #000000;">models.CASCADE,
        related_name</span>=<span style="color: #800000;">"</span><span style="color: #800000;">membership_invites</span><span style="color: #800000;">"</span><span style="color: #000000;">,
    )
    invite_reason </span>= models.CharField(max_length=64<span style="color: #000000;">)
db_constraint</span>=True,         <span style="color: #008000;">#</span><span style="color: #008000;"> 是否在数据库中创建外键约束</span>
db_table=None,              <span style="color: #008000;">#</span><span style="color: #008000;"> 默认创建第三张表时，数据库中表的名称</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>2. 操作表</h4>
<p>a、基本操作</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;7b4888b7-e524-4c0f-8254-0b83e93cf8cd&#39;)"><img id="code_img_closed_7b4888b7-e524-4c0f-8254-0b83e93cf8cd" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_7b4888b7-e524-4c0f-8254-0b83e93cf8cd" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;7b4888b7-e524-4c0f-8254-0b83e93cf8cd&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_7b4888b7-e524-4c0f-8254-0b83e93cf8cd" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 增</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.create(c1='xx', c2='oo')  增加一条数据，可以接受字典类型数据 **kwargs</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> obj = models.Tb1(c1='xx', c2='oo')</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> obj.save()</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 查</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.get(id=123)         # 获取单条数据，不存在则报错（不建议）</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.all()               # 获取全部</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven') # 获取指定条件的数据</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 删</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven').delete() # 删除指定条件的数据</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 改</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven').update(gender='0')  # 将指定条件的数据更新，均支持 **kwargs</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> obj = models.Tb1.objects.get(id=1)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> obj.c1 = '111'</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> obj.save()                                                 # 修改单条数据</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>b、进阶操作（了不起的双下划线）</p>
<p>利用双下划线将字段和对应的操作连接起来</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;d913487f-3477-4ace-ba65-6363df0628e8&#39;)"><img id="code_img_closed_d913487f-3477-4ace-ba65-6363df0628e8" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_d913487f-3477-4ace-ba65-6363df0628e8" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;d913487f-3477-4ace-ba65-6363df0628e8&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_d913487f-3477-4ace-ba65-6363df0628e8" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 获取个数</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven').count()</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> 大于，小于</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__gt=1)              # 获取id大于1的值</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__gte=1)              # 获取id大于等于1的值</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__lt=10)             # 获取id小于10的值</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__lte=10)             # 获取id小于10的值</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__lt=10, id__gt=1)   # 获取id大于1 且 小于10的值</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> in</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__in=[11, 22, 33])   # 获取id等于11、22、33的数据</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.exclude(id__in=[11, 22, 33])  # not in</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> isnull</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__isnull=True)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> contains</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name__contains="ven")</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name__icontains="ven") # icontains大小写不敏感</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.exclude(name__icontains="ven")</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> range</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(id__range=[1, 2])   # 范围bettwen and</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> 其他类似</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> startswith，istartswith, endswith, iendswith,</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> order by</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven').order_by('id')    # asc</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(name='seven').order_by('-id')   # desc</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> group by</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> from django.db.models import Count, Min, Max, Sum</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(c1=1).values('id').annotate(c=Count('num'))</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> SELECT "app01_tb1"."id", COUNT("app01_tb1"."num") AS "c" FROM "app01_tb1" WHERE "app01_tb1"."c1" = 1 GROUP BY "app01_tb1"."id"</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> limit 、offset</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.all()[10:20]</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> regex正则匹配，iregex 不区分大小写</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.get(title__regex=r'^(An?|The) +')</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.get(title__iregex=r'^(an?|the) +')</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> date</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__date=datetime.date(2005, 1, 1))</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__date__gt=datetime.date(2005, 1, 1))</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> year</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__year=2005)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__year__gte=2005)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> month</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__month=12)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__month__gte=6)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> day</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__day=3)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__day__gte=3)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> week_day</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__week_day=2)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Entry.objects.filter(pub_date__week_day__gte=2)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> hour</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__hour=23)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(time__hour=5)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__hour__gte=12)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> minute</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__minute=29)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(time__minute=46)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__minute__gte=29)</span>

        <span style="color: #008000;">#</span><span style="color: #008000;"> second</span>
        <span style="color: #008000;">#
</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__second=31)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(time__second=2)</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> Event.objects.filter(timestamp__second__gte=31)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>c、其他操作</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;63ff2e34-055d-4c3a-bf88-2352ab6499d1&#39;)"><img id="code_img_closed_63ff2e34-055d-4c3a-bf88-2352ab6499d1" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_63ff2e34-055d-4c3a-bf88-2352ab6499d1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;63ff2e34-055d-4c3a-bf88-2352ab6499d1&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_63ff2e34-055d-4c3a-bf88-2352ab6499d1" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> extra</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> extra(self, select=None, where=None, params=None, tables=None, order_by=None, select_params=None)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">    Entry.objects.extra(select={'new_id': "select col from sometable where othercol &gt; %s"}, select_params=(1,))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">    Entry.objects.extra(where=['headline=%s'], params=['Lennon'])</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">    Entry.objects.extra(where=["foo='a' OR bar = 'a'", "baz = 'a'"])</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">    Entry.objects.extra(select={'new_id': "select id from tb where id &gt; %s"}, select_params=(1,), order_by=['-nid'])</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> F</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> from django.db.models import F</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.update(num=F('num')+1)</span>


    <span style="color: #008000;">#</span><span style="color: #008000;"> Q</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> 方式一：</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> Q(nid__gt=10)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> Q(nid=8) | Q(nid__gt=10)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> Q(Q(nid=8) | Q(nid__gt=10)) &amp; Q(caption='root')</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 方式二：</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> con = Q()</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q1 = Q()</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q1.connector = 'OR'</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q1.children.append(('id', 1))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q1.children.append(('id', 10))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q1.children.append(('id', 9))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q2 = Q()</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q2.connector = 'OR'</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q2.children.append(('c1', 1))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q2.children.append(('c1', 10))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> q2.children.append(('c1', 9))</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> con.add(q1, 'AND')</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> con.add(q2, 'AND')</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> models.Tb1.objects.filter(con)</span>


    <span style="color: #008000;">#</span><span style="color: #008000;"> 执行原生SQL</span>
    <span style="color: #008000;">#
</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> from django.db import connection, connections</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> cursor = connection.cursor()  # cursor = connections['default'].cursor()</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> cursor.execute("""SELECT * from auth_user where id = %s""", [1])</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> row = cursor.fetchone()</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>d、连表操作（了不起的双下划线）</p>
<p>利用双下划线和 _set 将表之间的操作连接起来</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;b868d4a9-76b5-46a5-b3da-2431f61b6c1b&#39;)"><img id="code_img_closed_b868d4a9-76b5-46a5-b3da-2431f61b6c1b" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_b868d4a9-76b5-46a5-b3da-2431f61b6c1b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;b868d4a9-76b5-46a5-b3da-2431f61b6c1b&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_b868d4a9-76b5-46a5-b3da-2431f61b6c1b" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserProfile(models.Model):
    user_info </span>= models.OneToOneField(<span style="color: #800000;">'</span><span style="color: #800000;">UserInfo</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    username </span>= models.CharField(max_length=64<span style="color: #000000;">)
    password </span>= models.CharField(max_length=64<span style="color: #000000;">)

    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__unicode__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self.username


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfo(models.Model):
    user_type_choice </span>=<span style="color: #000000;"> (
        (0, u</span><span style="color: #800000;">'</span><span style="color: #800000;">普通用户</span><span style="color: #800000;">'</span><span style="color: #000000;">),
        (</span>1, u<span style="color: #800000;">'</span><span style="color: #800000;">高级用户</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    )
    user_type </span>= models.IntegerField(choices=<span style="color: #000000;">user_type_choice)
    name </span>= models.CharField(max_length=32<span style="color: #000000;">)
    email </span>= models.CharField(max_length=32<span style="color: #000000;">)
    address </span>= models.CharField(max_length=128<span style="color: #000000;">)

    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__unicode__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self.name


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserGroup(models.Model):

    caption </span>= models.CharField(max_length=64<span style="color: #000000;">)

    user_info </span>= models.ManyToManyField(<span style="color: #800000;">'</span><span style="color: #800000;">UserInfo</span><span style="color: #800000;">'</span><span style="color: #000000;">)

    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__unicode__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> self.caption


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Host(models.Model):
    hostname </span>= models.CharField(max_length=64<span style="color: #000000;">)
    ip </span>=<span style="color: #000000;"> models.GenericIPAddressField()
    user_group </span>= models.ForeignKey(<span style="color: #800000;">'</span><span style="color: #800000;">UserGroup</span><span style="color: #800000;">'</span><span style="color: #000000;">)

    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__unicode__</span><span style="color: #000000;">(self):
        </span><span style="color: #0000ff;">return</span> self.hostname</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;6514cf21-0d92-4df0-b261-d369a6ae7709&#39;)"><img id="code_img_closed_6514cf21-0d92-4df0-b261-d369a6ae7709" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_6514cf21-0d92-4df0-b261-d369a6ae7709" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;6514cf21-0d92-4df0-b261-d369a6ae7709&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_6514cf21-0d92-4df0-b261-d369a6ae7709" class="cnblogs_code_hide">
<pre>user_info_obj = models.UserInfo.objects.filter(id=1<span style="color: #000000;">).first()
</span><span style="color: #0000ff;">print</span><span style="color: #000000;"> user_info_obj.user_type
</span><span style="color: #0000ff;">print</span><span style="color: #000000;"> user_info_obj.get_user_type_display()
</span><span style="color: #0000ff;">print</span><span style="color: #000000;"> user_info_obj.userprofile.password
 
user_info_obj </span>= models.UserInfo.objects.filter(id=1).values(<span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">userprofile__username</span><span style="color: #800000;">'</span><span style="color: #000000;">).first()
</span><span style="color: #0000ff;">print</span><span style="color: #000000;"> user_info_obj.keys()
</span><span style="color: #0000ff;">print</span> user_info_obj.values()</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;a89ff802-fda5-4acf-8103-07e75ac96ee2&#39;)"><img id="code_img_closed_a89ff802-fda5-4acf-8103-07e75ac96ee2" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_a89ff802-fda5-4acf-8103-07e75ac96ee2" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;a89ff802-fda5-4acf-8103-07e75ac96ee2&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_a89ff802-fda5-4acf-8103-07e75ac96ee2" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 添加一对多</span>
    dic =<span style="color: #000000;"> {
        </span><span style="color: #800000;">"</span><span style="color: #800000;">hostname</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">名字1</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">ip</span><span style="color: #800000;">"</span>: <span style="color: #800000;">"</span><span style="color: #800000;">192.168.1.1</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">user_group_id</span><span style="color: #800000;">"</span>: 1,   <span style="color: #008000;">#</span><span style="color: #008000;"> 加对象则为"user_group"</span>
<span style="color: #000000;">    }
    models.Host.objects.create(</span>**<span style="color: #000000;">dic)

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 正向查一对多</span>
    host_obj =<span style="color: #000000;"> models.Host.objects.all()
    </span><span style="color: #0000ff;">print</span>(type(host_obj),     <span style="color: #008000;">#</span><span style="color: #008000;"> &lt;class 'django.db.models.query.QuerySet'&gt;</span>
          host_obj)           <span style="color: #008000;">#</span><span style="color: #008000;"> &lt;QuerySet [&lt;Host: 名字1&gt;]&gt;</span>
    <span style="color: #0000ff;">for</span> item <span style="color: #0000ff;">in</span><span style="color: #000000;"> host_obj:
        </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(item.hostname)
        </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(item.user_group.caption)
        </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(item.user_group.user_info.values())
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> &lt;QuerySet [{'name': 'nick', 'user_type': 1, 'id': 1, 'email': '630571017@qq.com', 'address': '128号'}]&gt;</span>
<span style="color: #000000;">    
    usergroup_obj </span>= models.Host.objects.filter(user_group__caption=<span style="color: #800000;">'</span><span style="color: #800000;">标题1</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(usergroup_obj)


    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 反向查一对多</span>
    usergroup_obj = models.UserGroup.objects.get(id=1<span style="color: #000000;">)
    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(usergroup_obj.caption)
    ret </span>= usergroup_obj.host_set.all()  <span style="color: #008000;">#</span><span style="color: #008000;"> 所有关于id=1的host</span>
    <span style="color: #0000ff;">print</span><span style="color: #000000;">(ret)
    
    obj </span>= models.UserGroup.objects.filter(host__ip=<span style="color: #800000;">'</span><span style="color: #800000;">192.168.1.1</span><span style="color: #800000;">'</span><span style="color: #000000;">).\
        values(</span><span style="color: #800000;">'</span><span style="color: #800000;">host__id</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">host__hostname</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">print</span>(obj)      <span style="color: #008000;">#</span><span style="color: #008000;"> &lt;QuerySet [{'host__id': 1, 'host__hostname': '名字1'}]&gt;</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;0f32bd6a-8f1b-4c24-b965-0801cea1349e&#39;)"><img id="code_img_closed_0f32bd6a-8f1b-4c24-b965-0801cea1349e" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_0f32bd6a-8f1b-4c24-b965-0801cea1349e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;0f32bd6a-8f1b-4c24-b965-0801cea1349e&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_0f32bd6a-8f1b-4c24-b965-0801cea1349e" class="cnblogs_code_hide">
<pre>user_info_obj = models.UserInfo.objects.get(name=<span style="color: #800000;">'</span><span style="color: #800000;">nick</span><span style="color: #800000;">'</span><span style="color: #000000;">)
user_info_objs </span>=<span style="color: #000000;"> models.UserInfo.objects.all()
 
group_obj </span>= models.UserGroup.objects.get(caption=<span style="color: #800000;">'</span><span style="color: #800000;">CTO</span><span style="color: #800000;">'</span><span style="color: #000000;">)
group_objs </span>=<span style="color: #000000;"> models.UserGroup.objects.all()
 
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 添加数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">group_obj.user_info.add(user_info_obj)</span><span style="color: #008000;">
#</span><span style="color: #008000;">group_obj.user_info.add(*user_info_objs)</span>
 
<span style="color: #008000;">#</span><span style="color: #008000;"> 删除数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">group_obj.user_info.remove(user_info_obj)</span><span style="color: #008000;">
#</span><span style="color: #008000;">group_obj.user_info.remove(*user_info_objs)</span>
 
<span style="color: #008000;">#</span><span style="color: #008000;"> 添加数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">user_info_obj.usergroup_set.add(group_obj)</span><span style="color: #008000;">
#</span><span style="color: #008000;">user_info_obj.usergroup_set.add(*group_objs)</span>
 
<span style="color: #008000;">#</span><span style="color: #008000;"> 删除数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">user_info_obj.usergroup_set.remove(group_obj)</span><span style="color: #008000;">
#</span><span style="color: #008000;">user_info_obj.usergroup_set.remove(*group_objs)</span>
 
<span style="color: #008000;">#</span><span style="color: #008000;"> 获取数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">print group_obj.user_info.all()</span><span style="color: #008000;">
#</span><span style="color: #008000;">print group_obj.user_info.all().filter(id=1)</span>
 
<span style="color: #008000;">#</span><span style="color: #008000;"> 获取数据</span><span style="color: #008000;">
#</span><span style="color: #008000;">print user_info_obj.usergroup_set.all()</span><span style="color: #008000;">
#</span><span style="color: #008000;">print user_info_obj.usergroup_set.all().filter(caption='CTO')</span><span style="color: #008000;">
#</span><span style="color: #008000;">print user_info_obj.usergroup_set.all().filter(caption='DBA')</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 添加多对多</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> userinfo_id_1 = models.UserInfo.objects.filter(id=1)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> usergroup_id_1 = models.UserGroup.objects.filter(id=1).first()</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> usergroup_id_1.user_info.add(*userinfo_id_1)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h3 id="autoid-6-4-0">扩展：</h3>
<h4 id="autoid-6-4-0">a、自定义上传</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;36eeabec-d93a-4a50-8e0f-8f24a8813a83&#39;)"><img id="code_img_closed_36eeabec-d93a-4a50-8e0f-8f24a8813a83" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_36eeabec-d93a-4a50-8e0f-8f24a8813a83" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;36eeabec-d93a-4a50-8e0f-8f24a8813a83&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_36eeabec-d93a-4a50-8e0f-8f24a8813a83" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> upload_file(request):
    </span><span style="color: #0000ff;">if</span> request.method == <span style="color: #800000;">"</span><span style="color: #800000;">POST</span><span style="color: #800000;">"</span><span style="color: #000000;">:
        obj </span>= request.FILES.get(<span style="color: #800000;">'</span><span style="color: #800000;">fafafa</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        f </span>= open(obj.name, <span style="color: #800000;">'</span><span style="color: #800000;">wb</span><span style="color: #800000;">'</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">for</span> chunk <span style="color: #0000ff;">in</span><span style="color: #000000;"> obj.chunks():
            f.write(chunk)
        f.close()
    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">file.html</span><span style="color: #800000;">'</span>)</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4 id="autoid-6-4-0">b、Form上传文件实例</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;7823a0f3-6b6c-4bc2-ada9-6ec13d4a38d6&#39;)"><img id="code_img_closed_7823a0f3-6b6c-4bc2-ada9-6ec13d4a38d6" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_7823a0f3-6b6c-4bc2-ada9-6ec13d4a38d6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;7823a0f3-6b6c-4bc2-ada9-6ec13d4a38d6&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_7823a0f3-6b6c-4bc2-ada9-6ec13d4a38d6" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> HTML</span>

       &lt;form method=<span style="color: #800000;">"</span><span style="color: #800000;">post</span><span style="color: #800000;">"</span> action=<span style="color: #800000;">"</span><span style="color: #800000;">/view1/</span><span style="color: #800000;">"</span> enctype=<span style="color: #800000;">"</span><span style="color: #800000;">multipart/form-data</span><span style="color: #800000;">"</span>&gt;
           &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">file</span><span style="color: #800000;">"</span> name=<span style="color: #800000;">"</span><span style="color: #800000;">ExcelFile</span><span style="color: #800000;">"</span> id=<span style="color: #800000;">"</span><span style="color: #800000;">id_ExcelFile</span><span style="color: #800000;">"</span> /&gt;
           &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">提交</span><span style="color: #800000;">"</span> /&gt;
       &lt;/form&gt;



<span style="color: #008000;">#</span><span style="color: #008000;"> Form</span>

<span style="color: #0000ff;">class</span><span style="color: #000000;"> FileForm(forms.Form):
    ExcelFile </span>=<span style="color: #000000;"> forms.FileField()

</span><span style="color: #008000;">#</span><span style="color: #008000;"> Models</span>

<span style="color: #0000ff;">from</span> django.db <span style="color: #0000ff;">import</span><span style="color: #000000;"> models

</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UploadFile(models.Model):
    userid </span>= models.CharField(max_length = 30<span style="color: #000000;">)
    file </span>= models.FileField(upload_to = <span style="color: #800000;">'</span><span style="color: #800000;">./upload/</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    date </span>= models.DateTimeField(auto_now_add=<span style="color: #000000;">True)

</span><span style="color: #008000;">#</span><span style="color: #008000;"> Views</span>

<span style="color: #0000ff;">def</span><span style="color: #000000;"> UploadFile(request):
    uf </span>=<span style="color: #000000;"> AssetForm.FileForm(request.POST,request.FILES)
    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> uf.is_valid():
            upload </span>=<span style="color: #000000;"> models.UploadFile()
            upload.userid </span>= 1<span style="color: #000000;">
            upload.file </span>= uf.cleaned_data[<span style="color: #800000;">'</span><span style="color: #800000;">ExcelFile</span><span style="color: #800000;">'</span><span style="color: #000000;">]
            upload.save()
            
            </span><span style="color: #0000ff;">print</span> upload.file</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4 id="autoid-6-4-0">c、ajax上传文件实例</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;477ed667-f774-47cb-98dd-df4dc41b1f34&#39;)"><img id="code_img_closed_477ed667-f774-47cb-98dd-df4dc41b1f34" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_477ed667-f774-47cb-98dd-df4dc41b1f34" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;477ed667-f774-47cb-98dd-df4dc41b1f34&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_477ed667-f774-47cb-98dd-df4dc41b1f34" class="cnblogs_code_hide">
<pre>&lt;div&gt;<span style="color: #000000;">
       {{ up.ExcelFile }}
       </span>&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">button</span><span style="color: #800000;">"</span> id=<span style="color: #800000;">"</span><span style="color: #800000;">submitj</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">提交</span><span style="color: #800000;">"</span> /&gt;
   &lt;/div&gt;


&lt;script src=<span style="color: #800000;">"</span><span style="color: #800000;">/static/js/jquery-2.1.4.min.js</span><span style="color: #800000;">"</span>&gt;&lt;/script&gt;
&lt;script&gt;<span style="color: #000000;">
    $(</span><span style="color: #800000;">'</span><span style="color: #800000;">#submitj</span><span style="color: #800000;">'</span>).bind(<span style="color: #800000;">"</span><span style="color: #800000;">click</span><span style="color: #800000;">"</span><span style="color: #000000;">,function () {
        var file </span>= $(<span style="color: #800000;">'</span><span style="color: #800000;">#id_ExcelFile</span><span style="color: #800000;">'</span><span style="color: #000000;">)[0].files[0];
        var form </span>=<span style="color: #000000;"> new FormData();
        form.append(</span><span style="color: #800000;">'</span><span style="color: #800000;">ExcelFile</span><span style="color: #800000;">'</span><span style="color: #000000;">, file);
         $.ajax({
                type:</span><span style="color: #800000;">'</span><span style="color: #800000;">POST</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                url: </span><span style="color: #800000;">'</span><span style="color: #800000;">/view1/</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                data: form,
                processData: false,  </span>// tell jQuery <span style="color: #0000ff;">not</span><span style="color: #000000;"> to process the data
                contentType: false,  </span>// tell jQuery <span style="color: #0000ff;">not</span><span style="color: #000000;"> to set contentType
                success: function(arg){
                    console.log(arg);
                }
            })
    })
</span>&lt;/script&gt;</pre>
</div>
<span class="cnblogs_code_collapse">html</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;a854a903-acda-406f-b862-5b492f47baf8&#39;)"><img id="code_img_closed_a854a903-acda-406f-b862-5b492f47baf8" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_a854a903-acda-406f-b862-5b492f47baf8" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;a854a903-acda-406f-b862-5b492f47baf8&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_a854a903-acda-406f-b862-5b492f47baf8" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> FileForm(forms.Form):
    ExcelFile </span>= forms.FileField()</pre>
</div>
<span class="cnblogs_code_collapse">form</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;fef0a751-ed57-4174-9506-133893a9145b&#39;)"><img id="code_img_closed_fef0a751-ed57-4174-9506-133893a9145b" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_fef0a751-ed57-4174-9506-133893a9145b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;fef0a751-ed57-4174-9506-133893a9145b&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_fef0a751-ed57-4174-9506-133893a9145b" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.db <span style="color: #0000ff;">import</span><span style="color: #000000;"> models

</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UploadFile(models.Model):
    userid </span>= models.CharField(max_length = 30<span style="color: #000000;">)
    file </span>= models.FileField(upload_to = <span style="color: #800000;">'</span><span style="color: #800000;">./upload/</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    date </span>= models.DateTimeField(auto_now_add=True)</pre>
</div>
<span class="cnblogs_code_collapse">models</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;3c4b3acd-f9a5-46af-aec2-9a572618be11&#39;)"><img id="code_img_closed_3c4b3acd-f9a5-46af-aec2-9a572618be11" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_3c4b3acd-f9a5-46af-aec2-9a572618be11" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;3c4b3acd-f9a5-46af-aec2-9a572618be11&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_3c4b3acd-f9a5-46af-aec2-9a572618be11" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> study1 <span style="color: #0000ff;">import</span><span style="color: #000000;"> forms

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> UploadFile(request):
    uf </span>=<span style="color: #000000;"> AssetForm.FileForm(request.POST,request.FILES)
    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> uf.is_valid():
            upload </span>=<span style="color: #000000;"> models.UploadFile()
            upload.userid </span>= 1<span style="color: #000000;">
            upload.file </span>= uf.cleaned_data[<span style="color: #800000;">'</span><span style="color: #800000;">ExcelFile</span><span style="color: #800000;">'</span><span style="color: #000000;">]
            upload.save()
            
            </span><span style="color: #0000ff;">print</span><span style="color: #000000;"> upload.file

</span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">file.html</span><span style="color: #800000;">'</span>, locals())</pre>
</div>
<span class="cnblogs_code_collapse">views</span></div>
<h2>七、中间件（MiddleWare）</h2>
<p>django 中的中间件（middleware），在django中，中间件其实就是一个类，在请求到来和结束后，django会根据自己的规则在合适的时机执行中间件中相应的方法。</p>
<p>在django项目的settings模块中，有一个 MIDDLEWARE_CLASSES&nbsp;变量，其中每一个元素就是一个中间件，如下图。</p>
<p><img src="./Django框架全面讲解_files/102231043354970.png" alt=""></p>
<p><em>与mange.py在同一目录下的文件夹 wupeiqi/middleware下的auth.py文件中的Authentication类</em></p>
<p>中间件中可以定义五个方法，分别是：</p>
<ul>
<li>process_request(self,request)</li>
<li>process_view(self, request, callback, callback_args, callback_kwargs)</li>
<li>process_template_response(self,request,response)</li>
<li>process_exception(self, request, exception)</li>
<li>process_response(self, request, response)</li>
</ul>
<p>分析源码得知前二个方法是从前往后执行的，后三个方法是从后往前执行的</p>
<p><img src="./Django框架全面讲解_files/1014746-20170531170714430-1667579450.png" alt="" width="638" height="220"></p>
<p>&nbsp;所以前两个方法是请求进来时要穿越的，而后三个方法是请求出去时要穿越的</p>
<p><strong>一张图告诉你中间件的运行流程</strong></p>
<p><img src="./Django框架全面讲解_files/1014746-20170531171732539-2035710503.png" alt="" width="650" height="277"></p>
<p>&nbsp;</p>
<h4>自定义中间件</h4>
<p>1、创建中间件类</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_144527" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">class</code>&nbsp;<code class="python plain">Middle_Test(</code><code class="python functions">object</code><code class="python plain">):</code></div>
<div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div>
<div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code>&nbsp;<code class="python plain">process_request(</code><code class="python color1">self</code><code class="python plain">,request):</code></div>
<div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">pass</code></div>
<div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code>&nbsp;<code class="python plain">process_view(</code><code class="python color1">self</code><code class="python plain">, request, callback, callback_args, callback_kwargs):</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">i&nbsp;</code><code class="python keyword">=</code><code class="python value">1</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">pass</code></div>
<div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code>&nbsp;<code class="python plain">process_exception(</code><code class="python color1">self</code><code class="python plain">, request, exception):</code></div>
<div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">pass</code></div>
<div class="line number10 index9 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div>
<div class="line number11 index10 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code>&nbsp;<code class="python plain">process_response(</code><code class="python color1">self</code><code class="python plain">, request, response):</code></div>
<div class="line number12 index11 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code>&nbsp;<code class="python plain">response</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>　　</p>
<p>2、注册中间件</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_665430" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python plain">MIDDLEWARE_CLASSES&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">(</code></div>
<div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'django.contrib.sessions.middleware.SessionMiddleware'</code><code class="python plain">,</code></div>
<div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'django.middleware.common.CommonMiddleware'</code><code class="python plain">,</code></div>
<div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'django.middleware.csrf.CsrfViewMiddleware'</code><code class="python plain">,</code></div>
<div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'django.contrib.auth.middleware.AuthenticationMiddleware'</code><code class="python plain">,</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'django.contrib.auth.middleware.SessionAuthenticationMiddleware'</code><code class="python plain">,</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'django.contrib.messages.middleware.MessageMiddleware'</code><code class="python plain">,</code></div>
<div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</code><code class="python plain">,</code></div>
<div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">'sparks.middleware.auth.Middle_Test'</code><code class="python plain">,</code></div>
<div class="line number10 index9 alt1"><code class="python plain">)</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>　　</p>
<h2>八、 Form</h2>
<p>django中的Form一般有两种功能：</p>
<ul>
<li>输入html</li>
<li>验证用户输入</li>
</ul>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;bf41a012-6aa3-4ef2-8458-ed07cd6d8a68&#39;)"><img id="code_img_closed_bf41a012-6aa3-4ef2-8458-ed07cd6d8a68" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_bf41a012-6aa3-4ef2-8458-ed07cd6d8a68" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;bf41a012-6aa3-4ef2-8458-ed07cd6d8a68&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_bf41a012-6aa3-4ef2-8458-ed07cd6d8a68" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> -*- coding:utf-8 -*-</span>
<span style="color: #0000ff;">import</span><span style="color: #000000;"> re
</span><span style="color: #0000ff;">from</span> django <span style="color: #0000ff;">import</span><span style="color: #000000;"> forms
</span><span style="color: #0000ff;">from</span> django.core.exceptions <span style="color: #0000ff;">import</span><span style="color: #000000;"> ValidationError


</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> mobile_validate(value):
    mobile_re </span>= re.compile(r<span style="color: #800000;">'</span><span style="color: #800000;">^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">if</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> mobile_re.match(value):
        </span><span style="color: #0000ff;">raise</span> ValidationError(<span style="color: #800000;">'</span><span style="color: #800000;">手机号码格式错误</span><span style="color: #800000;">'</span><span style="color: #000000;">)


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> PublishForm(forms.Form):

    user_type_choice </span>=<span style="color: #000000;"> (
        (0, u</span><span style="color: #800000;">'</span><span style="color: #800000;">普通用户</span><span style="color: #800000;">'</span><span style="color: #000000;">),
        (</span>1, u<span style="color: #800000;">'</span><span style="color: #800000;">高级用户</span><span style="color: #800000;">'</span><span style="color: #000000;">),
    )

    user_type </span>= forms.IntegerField(widget=forms.widgets.Select(choices=<span style="color: #000000;">user_type_choice,
                                                                  attrs</span>={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span><span style="color: #000000;">}))

    title </span>= forms.CharField(max_length=20<span style="color: #000000;">,
                            min_length</span>=5<span style="color: #000000;">,
                            error_messages</span>={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题不能为空</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                                            </span><span style="color: #800000;">'</span><span style="color: #800000;">min_length</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题最少为5个字符</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                                            </span><span style="color: #800000;">'</span><span style="color: #800000;">max_length</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题最多为20个字符</span><span style="color: #800000;">'</span><span style="color: #000000;">},
                            widget</span>=forms.TextInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                                                          </span><span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">标题5-20个字符</span><span style="color: #800000;">'</span><span style="color: #000000;">}))

    memo </span>= forms.CharField(required=<span style="color: #000000;">False,
                           max_length</span>=256<span style="color: #000000;">,
                           widget</span>=forms.widgets.Textarea(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control no-radius</span><span style="color: #800000;">"</span>, <span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">详细描述</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">rows</span><span style="color: #800000;">'</span>: 3<span style="color: #000000;">}))

    phone </span>= forms.CharField(validators=<span style="color: #000000;">[mobile_validate, ],
                            error_messages</span>={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">手机不能为空</span><span style="color: #800000;">'</span><span style="color: #000000;">},
                            widget</span>=forms.TextInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                                                          </span><span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">手机号码</span><span style="color: #800000;">'</span><span style="color: #000000;">}))

    email </span>= forms.EmailField(required=<span style="color: #000000;">False,
                            error_messages</span>={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">邮箱不能为空</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">邮箱格式错误</span><span style="color: #800000;">'</span><span style="color: #000000;">},
                            widget</span>=forms.TextInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>: <span style="color: #800000;">"</span><span style="color: #800000;">form-control</span><span style="color: #800000;">"</span>, <span style="color: #800000;">'</span><span style="color: #800000;">placeholder</span><span style="color: #800000;">'</span>: u<span style="color: #800000;">'</span><span style="color: #800000;">邮箱</span><span style="color: #800000;">'</span>}))</pre>
</div>
<span class="cnblogs_code_collapse">form</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;d70aae0a-d731-4df9-896a-d0547a77b02b&#39;)"><img id="code_img_closed_d70aae0a-d731-4df9-896a-d0547a77b02b" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_d70aae0a-d731-4df9-896a-d0547a77b02b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;d70aae0a-d731-4df9-896a-d0547a77b02b&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_d70aae0a-d731-4df9-896a-d0547a77b02b" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> publish(request):
    ret </span>= {<span style="color: #800000;">'</span><span style="color: #800000;">status</span><span style="color: #800000;">'</span>: False, <span style="color: #800000;">'</span><span style="color: #800000;">data</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span>, <span style="color: #800000;">'</span><span style="color: #800000;">error</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span>, <span style="color: #800000;">'</span><span style="color: #800000;">summary</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span><span style="color: #000000;">}
    </span><span style="color: #0000ff;">if</span> request.method == <span style="color: #800000;">'</span><span style="color: #800000;">POST</span><span style="color: #800000;">'</span><span style="color: #000000;">:
        request_form </span>=<span style="color: #000000;"> PublishForm(request.POST)
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> request_form.is_valid():
            request_dict </span>=<span style="color: #000000;"> request_form.clean()
            </span><span style="color: #0000ff;">print</span><span style="color: #000000;"> request_dict
            ret[</span><span style="color: #800000;">'</span><span style="color: #800000;">status</span><span style="color: #800000;">'</span>] =<span style="color: #000000;"> True
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            error_msg </span>=<span style="color: #000000;"> request_form.errors.as_json()
            ret[</span><span style="color: #800000;">'</span><span style="color: #800000;">error</span><span style="color: #800000;">'</span>] =<span style="color: #000000;"> json.loads(error_msg)
    </span><span style="color: #0000ff;">return</span> HttpResponse(json.dumps(ret))</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>利用Form还可以自动生成前端的input标签：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;05eb35fa-312f-422c-9839-43ce2e790601&#39;)"><img id="code_img_closed_05eb35fa-312f-422c-9839-43ce2e790601" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_05eb35fa-312f-422c-9839-43ce2e790601" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;05eb35fa-312f-422c-9839-43ce2e790601&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_05eb35fa-312f-422c-9839-43ce2e790601" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> app01 <span style="color: #0000ff;">import</span><span style="color: #000000;"> models
</span><span style="color: #0000ff;">from</span> django <span style="color: #0000ff;">import</span><span style="color: #000000;"> forms

</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Form1(forms.Form):
    user </span>=<span style="color: #000000;"> forms.CharField(
        widget</span>=forms.TextInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">c1</span><span style="color: #800000;">'</span>}), <span style="color: #008000;">#</span><span style="color: #008000;"> 给标签添加属性</span>
        error_messages={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">用户名不能为空</span><span style="color: #800000;">'</span>}, <span style="color: #008000;">#</span><span style="color: #008000;"> 自定义错误输出</span>
<span style="color: #000000;">    )
    pwd </span>= forms.CharField(max_length=4, min_length=2<span style="color: #000000;">)
    email </span>= forms.EmailField(error_messages={<span style="color: #800000;">'</span><span style="color: #800000;">required</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">邮箱不能为空</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">invalid</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">邮箱格式错误</span><span style="color: #800000;">'</span><span style="color: #000000;">})

    memo </span>=<span style="color: #000000;"> forms.CharField(
        widget</span>=<span style="color: #000000;">forms.Textarea()
    )
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> user_type_choice = (</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">     (0, '普通用户'),</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">     (1, '高级用户'),</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> )</span>
    user_type_choice = models.BookType.objects.values_list(<span style="color: #800000;">"</span><span style="color: #800000;">id</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">caption</span><span style="color: #800000;">"</span><span style="color: #000000;">)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 这样并不能跟数据库实时同步，因为静态字段不更新</span>
    book_type =<span style="color: #000000;"> forms.CharField(
        widget</span>=forms.widgets.Select(choices=<span style="color: #000000;">user_type_choice)
    )
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span>(self, *args, **<span style="color: #000000;">kwargs):
        super(Form1, self).</span><span style="color: #800080;">__init__</span>(*args, **<span style="color: #000000;">kwargs)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 让选项框跟数据库进行实时联动，解决上一行注释的问题</span>
        self.fields[<span style="color: #800000;">'</span><span style="color: #800000;">book_type</span><span style="color: #800000;">'</span>] =<span style="color: #000000;"> forms.CharField(
            widget</span>=forms.widgets.Select(choices=models.BookType.objects.values_list(<span style="color: #800000;">"</span><span style="color: #800000;">id</span><span style="color: #800000;">"</span>, <span style="color: #800000;">"</span><span style="color: #800000;">caption</span><span style="color: #800000;">"</span><span style="color: #000000;">))
        )</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;c2c3fa1e-305b-4013-9870-49ec801fd275&#39;)"><img id="code_img_closed_c2c3fa1e-305b-4013-9870-49ec801fd275" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_c2c3fa1e-305b-4013-9870-49ec801fd275" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;c2c3fa1e-305b-4013-9870-49ec801fd275&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_c2c3fa1e-305b-4013-9870-49ec801fd275" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">def</span><span style="color: #000000;"> form1(request):

    </span><span style="color: #0000ff;">if</span> request.method == <span style="color: #800000;">"</span><span style="color: #800000;">POST</span><span style="color: #800000;">"</span><span style="color: #000000;">:
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 获取请求做验证</span>
        f =<span style="color: #000000;"> Form1(request.POST)
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> f.is_valid():
            </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(f.cleaned_data)
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            </span><span style="color: #0000ff;">pass</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> print(f.errors['user'][0])</span>
            <span style="color: #008000;">#</span><span style="color: #008000;"> print(f.errors['pwd'][0])</span>
        <span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">"</span><span style="color: #800000;">form1.html</span><span style="color: #800000;">"</span>, {<span style="color: #800000;">'</span><span style="color: #800000;">error</span><span style="color: #800000;">'</span>: f.errors, <span style="color: #800000;">'</span><span style="color: #800000;">form</span><span style="color: #800000;">'</span><span style="color: #000000;">:f})
    </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
        f </span>=<span style="color: #000000;"> Form1()
        </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">form1.html</span><span style="color: #800000;">'</span>,{<span style="color: #800000;">'</span><span style="color: #800000;">form</span><span style="color: #800000;">'</span>:f})</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;fd321788-a1a9-4915-b592-bb3d70572974&#39;)"><img id="code_img_closed_fd321788-a1a9-4915-b592-bb3d70572974" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_fd321788-a1a9-4915-b592-bb3d70572974" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;fd321788-a1a9-4915-b592-bb3d70572974&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_fd321788-a1a9-4915-b592-bb3d70572974" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE html&gt;
&lt;html lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
&lt;head&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;Title&lt;/title&gt;
    &lt;style&gt;<span style="color: #000000;">
        .input</span>-<span style="color: #000000;">group{
            position: relative;
            padding: 23px;

        }
        .input</span>-<span style="color: #000000;">group input{
            width: 200px;
            display: inline</span>-<span style="color: #000000;">block;
        }
        .input</span>-<span style="color: #000000;">group span{
            display: inline</span>-<span style="color: #000000;">block;
            position: absolute;
            height: 20px;
            background</span>-<span style="color: #000000;">color:coral;
            color: white;
            bottom: 1px;
            left: 22px;
            width: 204px;


        }
    </span>&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div&gt;
        &lt;form action=<span style="color: #800000;">"</span><span style="color: #800000;">/form/</span><span style="color: #800000;">"</span> method=<span style="color: #800000;">"</span><span style="color: #800000;">post</span><span style="color: #800000;">"</span>&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">input-group</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
{</span><span style="color: #008000;">#</span><span style="color: #008000;">                &lt;input type="text" name="user"/&gt;#}</span>
<span style="color: #000000;">                {{ form.user }}
                {</span>% <span style="color: #0000ff;">if</span> error.user.0 %<span style="color: #000000;">}
                </span>&lt;span&gt;{{ error.user.0 }}&lt;/span&gt;<span style="color: #000000;">
                {</span>% endif %<span style="color: #000000;">}
            </span>&lt;/div&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">input-group</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
{</span><span style="color: #008000;">#</span><span style="color: #008000;">                &lt;input type="text" name="pwd"/&gt;#}</span>
<span style="color: #000000;">                {{ form.pwd }}
                {</span>% <span style="color: #0000ff;">if</span> error.pwd.0 %<span style="color: #000000;">}
                </span>&lt;span&gt;{{ error.pwd.0 }}&lt;/span&gt;<span style="color: #000000;">
                {</span>% endif %<span style="color: #000000;">}
            </span>&lt;/div&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">input-group</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
                {{ form.email }}
                {</span>% <span style="color: #0000ff;">if</span> error.email.0 %<span style="color: #000000;">}
                </span>&lt;span&gt;{{ error.email.0 }}&lt;/span&gt;<span style="color: #000000;">
                {</span>% endif %<span style="color: #000000;">}
            </span>&lt;/div&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">input-group</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
                {{ form.memo }}
                {</span>% <span style="color: #0000ff;">if</span> error.memo.0 %<span style="color: #000000;">}
                </span>&lt;span&gt;{{ error.memo.0 }}&lt;/span&gt;<span style="color: #000000;">
                {</span>% endif %<span style="color: #000000;">}
            </span>&lt;/div&gt;
            &lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">input-group</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
                {{ form.book_type }}
                {</span>% <span style="color: #0000ff;">if</span> error.book_type.0 %<span style="color: #000000;">}
                </span>&lt;span&gt;{{ error.book_type.0 }}&lt;/span&gt;<span style="color: #000000;">
                {</span>% endif %<span style="color: #000000;">}
            </span>&lt;/div&gt;
            &lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">submit</span><span style="color: #800000;">"</span> value=<span style="color: #800000;">"</span><span style="color: #800000;">提交</span><span style="color: #800000;">"</span>/&gt;
        &lt;/form&gt;
    &lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>扩展：ModelForm</p>
<p>在使用Model和Form时，都需要对字段进行定义并指定类型，通过ModelForm则可以省去From中字段的定义</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;d56ecdf5-776f-4cc6-ac95-950dfe1d5c65&#39;)"><img id="code_img_closed_d56ecdf5-776f-4cc6-ac95-950dfe1d5c65" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_d56ecdf5-776f-4cc6-ac95-950dfe1d5c65" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;d56ecdf5-776f-4cc6-ac95-950dfe1d5c65&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_d56ecdf5-776f-4cc6-ac95-950dfe1d5c65" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> AdminModelForm(forms.ModelForm):
      
    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
        model </span>=<span style="color: #000000;"> models.Admin
        </span><span style="color: #008000;">#</span><span style="color: #008000;">fields = '__all__'</span>
        fields = (<span style="color: #800000;">'</span><span style="color: #800000;">username</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span><span style="color: #000000;">)
          
        widgets </span>=<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span> : forms.PasswordInput(attrs={<span style="color: #800000;">'</span><span style="color: #800000;">class</span><span style="color: #800000;">'</span>:<span style="color: #800000;">"</span><span style="color: #800000;">alex</span><span style="color: #800000;">"</span><span style="color: #000000;">}),
        }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h2>九、 认证系统（auth）</h2>
<p>auth模块是Django提供的标准权限管理系统,可以提供用户身份认证, 用户组管理,并且可以和admin模块配合使用.</p>
<p>在INSTALLED_APPS中添加'django.contrib.auth'使用该APP, auth模块默认启用.</p>
<h3 id="autoid-8-0-0">model</h3>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_32802" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">django.contrib.auth.models&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">User</code></div>
<div class="line number2 index1 alt1">&nbsp;</div>
<div class="line number3 index2 alt2"><code class="python comments"># 数据库中该表名为auth_user.</code></div>
<div class="line number4 index3 alt1"><code class="python plain">CREATE TABLE&nbsp;</code><code class="python string">"auth_user"</code>&nbsp;<code class="python plain">(</code></div>
<div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">"id"</code>&nbsp;<code class="python plain">integer NOT NULL PRIMARY KEY AUTOINCREMENT,</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">"password"</code>&nbsp;<code class="python plain">varchar(</code><code class="python value">128</code><code class="python plain">) NOT NULL,&nbsp;</code><code class="python string">"last_login"</code>&nbsp;<code class="python plain">datetime NULL,</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">"is_superuser"</code>&nbsp;<code class="python functions">bool</code>&nbsp;<code class="python plain">NOT NULL,</code></div>
<div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">"first_name"</code>&nbsp;<code class="python plain">varchar(</code><code class="python value">30</code><code class="python plain">) NOT NULL,</code></div>
<div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">"last_name"</code>&nbsp;<code class="python plain">varchar(</code><code class="python value">30</code><code class="python plain">) NOT NULL,</code></div>
<div class="line number10 index9 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">"email"</code>&nbsp;<code class="python plain">varchar(</code><code class="python value">254</code><code class="python plain">) NOT NULL,</code></div>
<div class="line number11 index10 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">"is_staff"</code>&nbsp;<code class="python functions">bool</code>&nbsp;<code class="python plain">NOT NULL,</code></div>
<div class="line number12 index11 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">"is_active"</code>&nbsp;<code class="python functions">bool</code>&nbsp;<code class="python plain">NOT NULL,</code></div>
<div class="line number13 index12 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">"date_joined"</code>&nbsp;<code class="python plain">datetime NOT NULL,</code></div>
<div class="line number14 index13 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python string">"username"</code>&nbsp;<code class="python plain">varchar(</code><code class="python value">30</code><code class="python plain">) NOT NULL UNIQUE</code></div>
<div class="line number15 index14 alt2"><code class="python plain">)</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h3 id="autoid-8-0-0">新建用户</h3>
<div class="cnblogs_code">
<pre>user = User.objects.create_user(username, email, password)
user.save()

# 不存储用户密码明文而是存储一个Hash值</pre>
</div>
<h3 id="autoid-8-0-0">认证用户</h3>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>from django.contrib.auth import authenticate

user = authenticate(username=username, password=password)

# 认证用户的密码是否有效, 若有效则返回代表该用户的user对象, 若无效则返回None.
# 该方法不检查is_active标志位.</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div></div>
<h3 id="autoid-8-0-0">修改密码</h3>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>user.set_password(new_password)

# 以下实例为先认证通过后才可以修改密码
user = auth.authenticate(username=username, password=old_password)
if user is not None:
    user.set_password(new_password)
    user.save()</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div></div>
<h3 id="autoid-8-0-0">登录</h3>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>from django.contrib.auth import login

# login向session中添加SESSION_KEY, 便于对用户进行跟踪:
'login(request, user)'

# login不进行认证,也不检查is_active标志位
# 实例
user = authenticate(username=username, password=password)
if user is not None:
    if user.is_active:
        login(request, user)</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div></div>
<h3 id="autoid-8-0-0">退出登录</h3>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># logout会移除request中的user信息, 并刷新session

from django.contrib.auth import logout

def logout_view(request):
    logout(request)</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div></div>
<h3 id="autoid-8-0-0">只允许登录的用户访问</h3>
<p><code>@login_required</code>修饰器修饰的view函数会先通过session key检查是否登录, 已登录用户可以正常的执行操作, 未登录用户将被重定向到<code>login_url</code>指定的位置.</p>
<p>若未指定login_url参数, 则重定向到<code>settings.LOGIN_URL</code></p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>from django.contrib.auth.decorators import login_required

@login_required(login_url='/accounts/login/')
def userinfo(request):
    ...

# settings 配置
LOGIN_URL = '/index/'
# views
@login_required
def userinfo(request):
    ...</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./Django框架全面讲解_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>十、 跨站请求伪造（csrf）</h2>
<p>django为用户实现防止跨站请求伪造的功能，通过中间件&nbsp;django.middleware.csrf.CsrfViewMiddleware 来完成。而对于django中设置防跨站请求伪造功能有分为全局和局部。</p>
<p>全局：</p>
<p>　　中间件&nbsp;django.middleware.csrf.CsrfViewMiddleware</p>
<p>局部：</p>
<ul>
<li>@csrf_protect，为当前函数强制设置防跨站请求伪造功能，即便settings中没有设置全局中间件。</li>
<li>@csrf_exempt，取消当前函数防跨站请求伪造功能，即便settings中设置了全局中间件。</li>
</ul>
<p>注：from django.views.decorators.csrf import csrf_exempt,csrf_protect</p>
<p>　　在Django1.10中，为了防止BREACH攻击，对cookie-form类型的csrf做了一点改进，即在cookie和form中的token值是不相同的</p>
<p>&nbsp;</p>
<h2 id="autoid-9-1-0">应用</h2>
<h4 id="autoid-9-2-0">1、普通表单</h4>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_219726" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python plain">veiw中设置返回值：</code></div>
<div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code>&nbsp;<code class="python plain">render(request,&nbsp;</code><code class="python string">'xxx.html'</code><code class="python plain">, data)</code></div>
<div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;</code>&nbsp;</div>
<div class="line number4 index3 alt1"><code class="python plain">html中设置Token:</code></div>
<div class="line number5 index4 alt2"><code class="python plain">　　{</code><code class="python keyword">%</code>&nbsp;<code class="python plain">csrf_token&nbsp;</code><code class="python keyword">%</code><code class="python plain">}</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>　　</p>
<h4 id="autoid-9-2-0">2、Ajax</h4>
<p>对于传统的form，可以通过表单的方式将token再次发送到服务端，而对于ajax的话，使用如下方式。</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;77d7fed9-43d9-446a-a39b-b455def92881&#39;)"><img id="code_img_closed_77d7fed9-43d9-446a-a39b-b455def92881" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_77d7fed9-43d9-446a-a39b-b455def92881" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;77d7fed9-43d9-446a-a39b-b455def92881&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_77d7fed9-43d9-446a-a39b-b455def92881" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> view.py</span>

<span style="color: #0000ff;">from</span> django.template.context <span style="color: #0000ff;">import</span><span style="color: #000000;"> RequestContext
</span><span style="color: #008000;">#</span><span style="color: #008000;"> Create your views here.</span>
  
  
<span style="color: #0000ff;">def</span><span style="color: #000000;"> test(request):
  
    </span><span style="color: #0000ff;">if</span> request.method == <span style="color: #800000;">'</span><span style="color: #800000;">POST</span><span style="color: #800000;">'</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">print</span><span style="color: #000000;"> request.POST
        </span><span style="color: #0000ff;">return</span> HttpResponse(<span style="color: #800000;">'</span><span style="color: #800000;">ok</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    </span><span style="color: #0000ff;">return</span>  render_to_response(<span style="color: #800000;">'</span><span style="color: #800000;">app01/test.html</span><span style="color: #800000;">'</span>,context_instance=RequestContext(request))</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;41e9061c-338d-4eeb-a9d5-ffd1f094e569&#39;)"><img id="code_img_closed_41e9061c-338d-4eeb-a9d5-ffd1f094e569" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_41e9061c-338d-4eeb-a9d5-ffd1f094e569" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;41e9061c-338d-4eeb-a9d5-ffd1f094e569&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_41e9061c-338d-4eeb-a9d5-ffd1f094e569" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> text.html</span>

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;<span style="color: #000000;">
    {</span>% csrf_token %<span style="color: #000000;">}
  
    </span>&lt;input type=<span style="color: #800000;">"</span><span style="color: #800000;">button</span><span style="color: #800000;">"</span> onclick=<span style="color: #800000;">"</span><span style="color: #800000;">Do();</span><span style="color: #800000;">"</span>  value=<span style="color: #800000;">"</span><span style="color: #800000;">Do it</span><span style="color: #800000;">"</span>/&gt;
  
    &lt;script src=<span style="color: #800000;">"</span><span style="color: #800000;">/static/plugin/jquery/jquery-1.8.0.js</span><span style="color: #800000;">"</span>&gt;&lt;/script&gt;
    &lt;script src=<span style="color: #800000;">"</span><span style="color: #800000;">/static/plugin/jquery/jquery.cookie.js</span><span style="color: #800000;">"</span>&gt;&lt;/script&gt;
    &lt;script type=<span style="color: #800000;">"</span><span style="color: #800000;">text/javascript</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
        var csrftoken </span>= $.cookie(<span style="color: #800000;">'</span><span style="color: #800000;">csrftoken</span><span style="color: #800000;">'</span><span style="color: #000000;">);
  
        function csrfSafeMethod(method) {
            </span>// these HTTP methods do <span style="color: #0000ff;">not</span><span style="color: #000000;"> require CSRF protection
            </span><span style="color: #0000ff;">return</span> (/^(GET|HEAD|OPTIONS|TRACE)$/<span style="color: #000000;">.test(method));
        }
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                </span><span style="color: #0000ff;">if</span> (!csrfSafeMethod(settings.type) &amp;&amp;<span style="color: #000000;"> !this.crossDomain) {
                    xhr.setRequestHeader(</span><span style="color: #800000;">"</span><span style="color: #800000;">X-CSRFToken</span><span style="color: #800000;">"</span><span style="color: #000000;">, csrftoken);
                }
            }
        });
        function Do(){
  
            $.ajax({
                url:</span><span style="color: #800000;">"</span><span style="color: #800000;">/app01/test/</span><span style="color: #800000;">"</span><span style="color: #000000;">,
                data:{id:</span>1<span style="color: #000000;">},
                type:</span><span style="color: #800000;">'</span><span style="color: #800000;">POST</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                success:function(data){
                    console.log(data);
                }
            });
  
        }
    </span>&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h2>十一、 分页</h2>
<h4>1. Django内置分页</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;257e60ea-d9fc-4a42-8e33-ee252a442076&#39;)"><img id="code_img_closed_257e60ea-d9fc-4a42-8e33-ee252a442076" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_257e60ea-d9fc-4a42-8e33-ee252a442076" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;257e60ea-d9fc-4a42-8e33-ee252a442076&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_257e60ea-d9fc-4a42-8e33-ee252a442076" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.shortcuts <span style="color: #0000ff;">import</span><span style="color: #000000;"> render
</span><span style="color: #0000ff;">from</span> django.core.paginator <span style="color: #0000ff;">import</span><span style="color: #000000;"> Paginator, EmptyPage, PageNotAnInteger

L </span>=<span style="color: #000000;"> []
</span><span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(999<span style="color: #000000;">):
    L.append(i)

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
    current_page </span>= request.GET.get(<span style="color: #800000;">'</span><span style="color: #800000;">p</span><span style="color: #800000;">'</span><span style="color: #000000;">)

    paginator </span>= Paginator(L, 10<span style="color: #000000;">)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> per_page: 每页显示条目数量</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> count:    数据总个数</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> num_pages:总页数</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> page_range:总页数的索引范围，如: (1,10),(1,200)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> page:     page对象</span>
    <span style="color: #0000ff;">try</span><span style="color: #000000;">:
        posts </span>=<span style="color: #000000;"> paginator.page(current_page)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> has_next              是否有下一页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> next_page_number      下一页页码</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> has_previous          是否有上一页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> previous_page_number  上一页页码</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> object_list           分页之后的数据列表</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> number                当前页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> paginator             paginator对象</span>
    <span style="color: #0000ff;">except</span><span style="color: #000000;"> PageNotAnInteger:
        posts </span>= paginator.page(1<span style="color: #000000;">)
    </span><span style="color: #0000ff;">except</span><span style="color: #000000;"> EmptyPage:
        posts </span>=<span style="color: #000000;"> paginator.page(paginator.num_pages)
    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">index.html</span><span style="color: #800000;">'</span>, {<span style="color: #800000;">'</span><span style="color: #800000;">posts</span><span style="color: #800000;">'</span>: posts})</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;8c997c55-c2a3-4266-b3e6-1fd23e880072&#39;)"><img id="code_img_closed_8c997c55-c2a3-4266-b3e6-1fd23e880072" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_8c997c55-c2a3-4266-b3e6-1fd23e880072" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;8c997c55-c2a3-4266-b3e6-1fd23e880072&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_8c997c55-c2a3-4266-b3e6-1fd23e880072" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;ul&gt;<span style="color: #000000;">
    {</span>% <span style="color: #0000ff;">for</span> item <span style="color: #0000ff;">in</span> posts %<span style="color: #000000;">}
        </span>&lt;li&gt;{{ item }}&lt;/li&gt;<span style="color: #000000;">
    {</span>% endfor %<span style="color: #000000;">}
</span>&lt;/ul&gt;

&lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">pagination</span><span style="color: #800000;">"</span>&gt;
      &lt;span <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">step-links</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
        {</span>% <span style="color: #0000ff;">if</span> posts.has_previous %<span style="color: #000000;">}
            </span>&lt;a href=<span style="color: #800000;">"</span><span style="color: #800000;">?p={{ posts.previous_page_number }}</span><span style="color: #800000;">"</span>&gt;Previous&lt;/a&gt;<span style="color: #000000;">
        {</span>% endif %<span style="color: #000000;">}
          </span>&lt;span <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">current</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
            Page {{ posts.number }} of {{ posts.paginator.num_pages }}.
          </span>&lt;/span&gt;<span style="color: #000000;">
          {</span>% <span style="color: #0000ff;">if</span> posts.has_next %<span style="color: #000000;">}
              </span>&lt;a href=<span style="color: #800000;">"</span><span style="color: #800000;">?p={{ posts.next_page_number }}</span><span style="color: #800000;">"</span>&gt;Next&lt;/a&gt;<span style="color: #000000;">
          {</span>% endif %<span style="color: #000000;">}
      </span>&lt;/span&gt;

&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;b5489d64-41e4-487d-8752-5dd6f03ffbd5&#39;)"><img id="code_img_closed_b5489d64-41e4-487d-8752-5dd6f03ffbd5" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_b5489d64-41e4-487d-8752-5dd6f03ffbd5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;b5489d64-41e4-487d-8752-5dd6f03ffbd5&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_b5489d64-41e4-487d-8752-5dd6f03ffbd5" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.shortcuts <span style="color: #0000ff;">import</span><span style="color: #000000;"> render
</span><span style="color: #0000ff;">from</span> django.core.paginator <span style="color: #0000ff;">import</span><span style="color: #000000;"> Paginator, EmptyPage, PageNotAnInteger


</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> CustomPaginator(Paginator):
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span>(self, current_page, max_pager_num, *args, **<span style="color: #000000;">kwargs):
        </span><span style="color: #800000;">"""</span><span style="color: #800000;">
        :param current_page: 当前页
        :param max_pager_num:最多显示的页码个数
        :param args:
        :param kwargs:
        :return:
        </span><span style="color: #800000;">"""</span><span style="color: #000000;">
        self.current_page </span>=<span style="color: #000000;"> int(current_page)
        self.max_pager_num </span>=<span style="color: #000000;"> max_pager_num
        super(CustomPaginator, self).</span><span style="color: #800080;">__init__</span>(*args, **<span style="color: #000000;">kwargs)

    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> page_num_range(self):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 当前页面</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> self.current_page</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 总页数</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> self.num_pages</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> 最多显示的页码个数</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> self.max_pager_num</span>
        <span style="color: #0000ff;">print</span>(1<span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> self.num_pages &lt;<span style="color: #000000;"> self.max_pager_num:
            </span><span style="color: #0000ff;">return</span> range(1, self.num_pages + 1<span style="color: #000000;">)
        </span><span style="color: #0000ff;">print</span>(2<span style="color: #000000;">)
        part </span>= int(self.max_pager_num / 2<span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> self.current_page - part &lt; 1<span style="color: #000000;">:
            </span><span style="color: #0000ff;">return</span> range(1, self.max_pager_num + 1<span style="color: #000000;">)
        </span><span style="color: #0000ff;">print</span>(3<span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> self.current_page + part &gt;<span style="color: #000000;"> self.num_pages:
            </span><span style="color: #0000ff;">return</span> range(self.num_pages + 1 - self.max_pager_num, self.num_pages + 1<span style="color: #000000;">)
        </span><span style="color: #0000ff;">print</span>(4<span style="color: #000000;">)
        </span><span style="color: #0000ff;">return</span> range(self.current_page - part, self.current_page + part + 1<span style="color: #000000;">)


L </span>=<span style="color: #000000;"> []
</span><span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(999<span style="color: #000000;">):
    L.append(i)

</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
    current_page </span>= request.GET.get(<span style="color: #800000;">'</span><span style="color: #800000;">p</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    paginator </span>= CustomPaginator(current_page, 11, L, 10<span style="color: #000000;">)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> per_page: 每页显示条目数量</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> count:    数据总个数</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> num_pages:总页数</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> page_range:总页数的索引范围，如: (1,10),(1,200)</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> page:     page对象</span>
    <span style="color: #0000ff;">try</span><span style="color: #000000;">:
        posts </span>=<span style="color: #000000;"> paginator.page(current_page)
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> has_next              是否有下一页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> next_page_number      下一页页码</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> has_previous          是否有上一页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> previous_page_number  上一页页码</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> object_list           分页之后的数据列表</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> number                当前页</span>
        <span style="color: #008000;">#</span><span style="color: #008000;"> paginator             paginator对象</span>
    <span style="color: #0000ff;">except</span><span style="color: #000000;"> PageNotAnInteger:
        posts </span>= paginator.page(1<span style="color: #000000;">)
    </span><span style="color: #0000ff;">except</span><span style="color: #000000;"> EmptyPage:
        posts </span>=<span style="color: #000000;"> paginator.page(paginator.num_pages)

    </span><span style="color: #0000ff;">return</span> render(request, <span style="color: #800000;">'</span><span style="color: #800000;">index.html</span><span style="color: #800000;">'</span>, {<span style="color: #800000;">'</span><span style="color: #800000;">posts</span><span style="color: #800000;">'</span>: posts})</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;60069575-d92d-4879-9740-cbd4b32908be&#39;)"><img id="code_img_closed_60069575-d92d-4879-9740-cbd4b32908be" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_60069575-d92d-4879-9740-cbd4b32908be" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;60069575-d92d-4879-9740-cbd4b32908be&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_60069575-d92d-4879-9740-cbd4b32908be" class="cnblogs_code_hide">
<pre>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang=<span style="color: #800000;">"</span><span style="color: #800000;">en</span><span style="color: #800000;">"</span>&gt;
    &lt;meta charset=<span style="color: #800000;">"</span><span style="color: #800000;">UTF-8</span><span style="color: #800000;">"</span>&gt;
    &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;ul&gt;<span style="color: #000000;">
    {</span>% <span style="color: #0000ff;">for</span> item <span style="color: #0000ff;">in</span> posts %<span style="color: #000000;">}
        </span>&lt;li&gt;{{ item }}&lt;/li&gt;<span style="color: #000000;">
    {</span>% endfor %<span style="color: #000000;">}
</span>&lt;/ul&gt;

&lt;div <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">pagination</span><span style="color: #800000;">"</span>&gt;
&lt;span <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">step-links</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
{</span>% <span style="color: #0000ff;">if</span> posts.has_previous %<span style="color: #000000;">}
    </span>&lt;a href=<span style="color: #800000;">"</span><span style="color: #800000;">?p={{ posts.previous_page_number }}</span><span style="color: #800000;">"</span>&gt;Previous&lt;/a&gt;<span style="color: #000000;">
{</span>% endif %<span style="color: #000000;">}

    {</span>% <span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> posts.paginator.page_num_range %<span style="color: #000000;">}
        </span>&lt;a href=<span style="color: #800000;">"</span><span style="color: #800000;">?p={{ i }}</span><span style="color: #800000;">"</span>&gt;{{ i }}&lt;/a&gt;<span style="color: #000000;">
    {</span>% endfor %<span style="color: #000000;">}

    {</span>% <span style="color: #0000ff;">if</span> posts.has_next %<span style="color: #000000;">}
        </span>&lt;a href=<span style="color: #800000;">"</span><span style="color: #800000;">?p={{ posts.next_page_number }}</span><span style="color: #800000;">"</span>&gt;Next&lt;/a&gt;<span style="color: #000000;">
    {</span>% endif %<span style="color: #000000;">}
</span>&lt;/span&gt;

&lt;span <span style="color: #0000ff;">class</span>=<span style="color: #800000;">"</span><span style="color: #800000;">current</span><span style="color: #800000;">"</span>&gt;<span style="color: #000000;">
Page {{ posts.number }} of {{ posts.paginator.num_pages }}.
</span>&lt;/span&gt;

&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4>2. 自定义分页</h4>
<p>分页功能在每个网站都是必要的，对于分页来说，其实就是根据用户的输入计算出应该在数据库表中的起始位置。</p>
<p>1、设定每页显示数据条数</p>
<p>2、用户输入页码（第一页、第二页...）</p>
<p>3、根据设定的每页显示条数和当前页码，计算出需要取数据表的起始位置</p>
<p>4、在数据表中根据起始位置取值，页面上输出数据</p>
<hr>
<p>需求又来了，需要在页面上显示分页的页面。如：［上一页］［1］［2］［3］［4］［5］［下一页］</p>
<p>1、设定每页显示数据条数</p>
<p>2、用户输入页码（第一页、第二页...）</p>
<p>3、设定显示多少页号</p>
<p>4、获取当前数据总条数</p>
<p>5、根据设定显示多少页号和数据总条数计算出，总页数</p>
<p>6、根据设定的每页显示条数和当前页码，计算出需要取数据表的起始位置</p>
<p>7、在数据表中根据起始位置取值，页面上输出数据</p>
<p>8、输出分页html，如：［上一页］［1］［2］［3］［4］［5］［下一页］</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;01bbab3c-b86b-472c-9a58-59d593ba3b0e&#39;)"><img id="code_img_closed_01bbab3c-b86b-472c-9a58-59d593ba3b0e" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_01bbab3c-b86b-472c-9a58-59d593ba3b0e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;01bbab3c-b86b-472c-9a58-59d593ba3b0e&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_01bbab3c-b86b-472c-9a58-59d593ba3b0e" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;">!/usr/bin/env python</span><span style="color: #008000;">
#</span><span style="color: #008000;"> _*_coding:utf-8_*_</span>
<span style="color: #0000ff;">from</span> django.utils.safestring <span style="color: #0000ff;">import</span><span style="color: #000000;"> mark_safe
 
</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> PageInfo(object):
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__init__</span>(self,current,totalItem,peritems=5<span style="color: #000000;">):
        self.</span><span style="color: #800080;">__current</span>=<span style="color: #000000;">current
        self.</span><span style="color: #800080;">__peritems</span>=<span style="color: #000000;">peritems
        self.</span><span style="color: #800080;">__totalItem</span>=<span style="color: #000000;">totalItem
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> From(self):
        </span><span style="color: #0000ff;">return</span> (self.<span style="color: #800080;">__current</span>-1)*self.<span style="color: #800080;">__peritems</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> To(self):
        </span><span style="color: #0000ff;">return</span> self.<span style="color: #800080;">__current</span>*self.<span style="color: #800080;">__peritems</span>
    <span style="color: #0000ff;">def</span> TotalPage(self):  <span style="color: #008000;">#</span><span style="color: #008000;">总页数</span>
        result=divmod(self.<span style="color: #800080;">__totalItem</span>,self.<span style="color: #800080;">__peritems</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">if</span> result[1]==<span style="color: #000000;">0:
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> result[0]
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            </span><span style="color: #0000ff;">return</span> result[0]+1
 
<span style="color: #0000ff;">def</span> Custompager(baseurl,currentPage,totalpage):  <span style="color: #008000;">#</span><span style="color: #008000;">基础页，当前页，总页数</span>
    perPager=11
    <span style="color: #008000;">#</span><span style="color: #008000;">总页数&lt;11</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">0 -- totalpage</span>
    <span style="color: #008000;">#</span><span style="color: #008000;">总页数&gt;11</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">当前页大于5 currentPage-5 -- currentPage+5</span>
            <span style="color: #008000;">#</span><span style="color: #008000;">currentPage+5是否超过总页数,超过总页数，end就是总页数</span>
        <span style="color: #008000;">#</span><span style="color: #008000;">当前页小于5 0 -- 11</span>
    begin=<span style="color: #000000;">0
    end</span>=<span style="color: #000000;">0
    </span><span style="color: #0000ff;">if</span> totalpage &lt;= 11<span style="color: #000000;">:
        begin</span>=<span style="color: #000000;">0
        end</span>=<span style="color: #000000;">totalpage
    </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
        </span><span style="color: #0000ff;">if</span> currentPage&gt;5<span style="color: #000000;">:
            begin</span>=currentPage-5<span style="color: #000000;">
            end</span>=currentPage+5
            <span style="color: #0000ff;">if</span> end &gt;<span style="color: #000000;"> totalpage:
                end</span>=<span style="color: #000000;">totalpage
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            begin</span>=<span style="color: #000000;">0
            end</span>=11<span style="color: #000000;">
    pager_list</span>=<span style="color: #000000;">[]
    </span><span style="color: #0000ff;">if</span> currentPage&lt;=1<span style="color: #000000;">:
        first</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href=''&gt;首页&lt;/a&gt;</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">else</span><span style="color: #000000;">:
        first</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d'&gt;首页&lt;/a&gt;</span><span style="color: #800000;">"</span> % (baseurl,1<span style="color: #000000;">)
    pager_list.append(first)
 
    </span><span style="color: #0000ff;">if</span> currentPage&lt;=1<span style="color: #000000;">:
        prev</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href=''&gt;上一页&lt;/a&gt;</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">else</span><span style="color: #000000;">:
        prev</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d'&gt;上一页&lt;/a&gt;</span><span style="color: #800000;">"</span> % (baseurl,currentPage-1<span style="color: #000000;">)
    pager_list.append(prev)
 
    </span><span style="color: #0000ff;">for</span> i <span style="color: #0000ff;">in</span> range(begin+1,end+1<span style="color: #000000;">):
        </span><span style="color: #0000ff;">if</span> i ==<span style="color: #000000;"> currentPage:
            temp</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d' class='selected'&gt;%d&lt;/a&gt;</span><span style="color: #800000;">"</span> %<span style="color: #000000;"> (baseurl,i,i)
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
            temp</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d'&gt;%d&lt;/a&gt;</span><span style="color: #800000;">"</span> %<span style="color: #000000;"> (baseurl,i,i)
        pager_list.append(temp)
    </span><span style="color: #0000ff;">if</span> currentPage&gt;=<span style="color: #000000;">totalpage:
        next</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='#'&gt;下一页&lt;/a&gt;</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">else</span><span style="color: #000000;">:
        next</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d'&gt;下一页&lt;/a&gt;</span><span style="color: #800000;">"</span> % (baseurl,currentPage+1<span style="color: #000000;">)
    pager_list.append(next)
    </span><span style="color: #0000ff;">if</span> currentPage&gt;=<span style="color: #000000;">totalpage:
        last</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href=''&gt;末页&lt;/a&gt;</span><span style="color: #800000;">"</span>
    <span style="color: #0000ff;">else</span><span style="color: #000000;">:
        last</span>=<span style="color: #800000;">"</span><span style="color: #800000;">&lt;a href='%s%d'&gt;末页&lt;/a&gt;</span><span style="color: #800000;">"</span> %<span style="color: #000000;"> (baseurl,totalpage)
    pager_list.append(last)
    result</span>=<span style="color: #800000;">''</span><span style="color: #000000;">.join(pager_list)
    </span><span style="color: #0000ff;">return</span> mark_safe(result)   <span style="color: #008000;">#</span><span style="color: #008000;">把字符串转成html语言</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>总结，分页时需要做三件事：</p>
<ul>
<li>创建处理分页数据的类</li>
<li>根据分页数据获取数据</li>
<li>输出分页HTML，即：［上一页］［1］［2］［3］［4］［5］［下一页］</li>
</ul>
<h2>十二、 Cookie</h2>
<h4>1. 获取Cookie：</h4>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_341933" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python plain">request.COOKIES[</code><code class="python string">'key'</code><code class="python plain">]</code></div>
<div class="line number2 index1 alt1"><code class="python plain">request.get_signed_cookie(key, default</code><code class="python keyword">=</code><code class="python plain">RAISE_ERROR, salt</code><code class="python keyword">=</code><code class="python plain">'', max_age</code><code class="python keyword">=</code><code class="python color1">None</code><code class="python plain">)</code></div>
<div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">参数：</code></div>
<div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">default: 默认值</code></div>
<div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">salt: 加密盐</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">max_age: 后台控制过期时间</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h4>2. 设置Cookie：</h4>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_446085" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python plain">rep&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">HttpResponse(...) 或 rep ＝ render(request, ...)</code></div>
<div class="line number2 index1 alt1">&nbsp;</div>
<div class="line number3 index2 alt2"><code class="python plain">rep.set_cookie(key,value,...)</code></div>
<div class="line number4 index3 alt1"><code class="python plain">rep.set_signed_cookie(key,value,salt</code><code class="python keyword">=</code><code class="python string">'加密盐'</code><code class="python plain">,...)</code></div>
<div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">参数：</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">key,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 键</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">value</code><code class="python keyword">=</code><code class="python plain">'',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 值</code></div>
<div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">max_age</code><code class="python keyword">=</code><code class="python color1">None</code><code class="python plain">,&nbsp;&nbsp;&nbsp;&nbsp; 超时时间</code></div>
<div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">expires</code><code class="python keyword">=</code><code class="python color1">None</code><code class="python plain">,&nbsp;&nbsp;&nbsp;&nbsp; 超时时间(IE requires expires, so&nbsp;</code><code class="python functions">set</code>&nbsp;<code class="python plain">it&nbsp;</code><code class="python keyword">if</code>&nbsp;<code class="python plain">hasn't been already.)</code></div>
<div class="line number10 index9 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">path</code><code class="python keyword">=</code><code class="python string">'/'</code><code class="python plain">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cookie生效的路径，</code><code class="python keyword">/</code>&nbsp;<code class="python plain">表示根路径，特殊的：跟路径的cookie可以被任何url的页面访问</code></div>
<div class="line number11 index10 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">domain</code><code class="python keyword">=</code><code class="python color1">None</code><code class="python plain">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cookie生效的域名</code></div>
<div class="line number12 index11 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">secure</code><code class="python keyword">=</code><code class="python color1">False</code><code class="python plain">,&nbsp;&nbsp;&nbsp;&nbsp; https传输</code></div>
<div class="line number13 index12 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">httponly</code><code class="python keyword">=</code><code class="python color1">False</code>&nbsp;&nbsp;&nbsp;&nbsp;<code class="python plain">只能http协议传输，无法被JavaScript获取（不是绝对，底层抓包可以获取到也可以被覆盖）</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>由于cookie保存在客户端的电脑上，所以，JavaScript和jquery也可以操作cookie。</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_689789" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python plain">&lt;script src</code><code class="python keyword">=</code><code class="python string">'/static/js/jquery.cookie.js'</code><code class="python plain">&gt;&lt;</code><code class="python keyword">/</code><code class="python plain">script&gt;</code></div>
<div class="line number2 index1 alt1"><code class="python plain">$.cookie(</code><code class="python string">"list_pager_num"</code><code class="python plain">,&nbsp;</code><code class="python value">30</code><code class="python plain">,{ path:&nbsp;</code><code class="python string">'/'</code>&nbsp;<code class="python plain">});</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h3>&nbsp;</h3>
<h2>十三、 Session</h2>
<p>Django中默认支持Session，其内部提供了5种类型的Session供开发者使用：</p>
<ul>
<li>数据库（默认）</li>
<li>缓存</li>
<li>文件</li>
<li>缓存+数据库</li>
<li>加密cookie</li>
</ul>
<h4 id="autoid-12-0-0">1、数据库Session</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;5fdcbaa6-0f2c-451e-b8a3-0e54a905cb02&#39;)"><img id="code_img_closed_5fdcbaa6-0f2c-451e-b8a3-0e54a905cb02" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_5fdcbaa6-0f2c-451e-b8a3-0e54a905cb02" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;5fdcbaa6-0f2c-451e-b8a3-0e54a905cb02&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_5fdcbaa6-0f2c-451e-b8a3-0e54a905cb02" class="cnblogs_code_hide">
<pre><span style="color: #000000;">Django默认支持Session，并且默认是将Session数据存储在数据库中，即：django_session 表中。
 
a. 配置 settings.py
 
    SESSION_ENGINE </span>= <span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.sessions.backends.db</span><span style="color: #800000;">'</span>   <span style="color: #008000;">#</span><span style="color: #008000;"> 引擎（默认）</span>
<span style="color: #000000;">     
    SESSION_COOKIE_NAME ＝ </span><span style="color: #800000;">"</span><span style="color: #800000;">sessionid</span><span style="color: #800000;">"</span>                       <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串（默认）</span>
    SESSION_COOKIE_PATH ＝ <span style="color: #800000;">"</span><span style="color: #800000;">/</span><span style="color: #800000;">"</span>                               <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie保存的路径（默认）</span>
    SESSION_COOKIE_DOMAIN = None                             <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie保存的域名（默认）</span>
    SESSION_COOKIE_SECURE = False                            <span style="color: #008000;">#</span><span style="color: #008000;"> 是否Https传输cookie（默认）</span>
    SESSION_COOKIE_HTTPONLY = True                           <span style="color: #008000;">#</span><span style="color: #008000;"> 是否Session的cookie只支持http传输（默认）</span>
    SESSION_COOKIE_AGE = 1209600                             <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie失效日期（2周）（默认）</span>
    SESSION_EXPIRE_AT_BROWSER_CLOSE = False                  <span style="color: #008000;">#</span><span style="color: #008000;"> 是否关闭浏览器使得Session过期（默认）</span>
    SESSION_SAVE_EVERY_REQUEST = False                       <span style="color: #008000;">#</span><span style="color: #008000;"> 是否每次请求都保存Session，默认修改之后才保存（默认）</span>
<span style="color: #000000;"> 
 
 
b. 使用
 
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> index(request):
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 获取、设置、删除Session中数据</span>
        request.session[<span style="color: #800000;">'</span><span style="color: #800000;">k1</span><span style="color: #800000;">'</span><span style="color: #000000;">]
        request.session.get(</span><span style="color: #800000;">'</span><span style="color: #800000;">k1</span><span style="color: #800000;">'</span><span style="color: #000000;">,None)
        request.session[</span><span style="color: #800000;">'</span><span style="color: #800000;">k1</span><span style="color: #800000;">'</span>] = 123<span style="color: #000000;">
        request.session.setdefault(</span><span style="color: #800000;">'</span><span style="color: #800000;">k1</span><span style="color: #800000;">'</span>,123) <span style="color: #008000;">#</span><span style="color: #008000;"> 存在则不设置</span>
        <span style="color: #0000ff;">del</span> request.session[<span style="color: #800000;">'</span><span style="color: #800000;">k1</span><span style="color: #800000;">'</span><span style="color: #000000;">]
 
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 所有 键、值、键值对</span>
<span style="color: #000000;">        request.session.keys()
        request.session.values()
        request.session.items()
        request.session.iterkeys()
        request.session.itervalues()
        request.session.iteritems()
 
 
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 用户session的随机字符串</span>
<span style="color: #000000;">        request.session.session_key
 
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 将所有Session失效日期小于当前日期的数据删除</span>
<span style="color: #000000;">        request.session.clear_expired()
 
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 检查 用户session的随机字符串 在数据库中是否</span>
        request.session.exists(<span style="color: #800000;">"</span><span style="color: #800000;">session_key</span><span style="color: #800000;">"</span><span style="color: #000000;">)
 
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 删除当前用户的所有Session数据</span>
        request.session.delete(<span style="color: #800000;">"</span><span style="color: #800000;">session_key</span><span style="color: #800000;">"</span><span style="color: #000000;">)
 
        ...</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4 id="autoid-12-0-0">2、缓存Session</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;23e725fd-f1c0-4b2b-9fdc-193ada4c7010&#39;)"><img id="code_img_closed_23e725fd-f1c0-4b2b-9fdc-193ada4c7010" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_23e725fd-f1c0-4b2b-9fdc-193ada4c7010" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;23e725fd-f1c0-4b2b-9fdc-193ada4c7010&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_23e725fd-f1c0-4b2b-9fdc-193ada4c7010" class="cnblogs_code_hide">
<pre><span style="color: #000000;">a. 配置 settings.py
 
    SESSION_ENGINE </span>= <span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.sessions.backends.cache</span><span style="color: #800000;">'</span>  <span style="color: #008000;">#</span><span style="color: #008000;"> 引擎</span>
    SESSION_CACHE_ALIAS = <span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span>                            <span style="color: #008000;">#</span><span style="color: #008000;"> 使用的缓存别名（默认内存缓存，也可以是memcache），此处别名依赖缓存的设置</span>
<span style="color: #000000;"> 
 
    SESSION_COOKIE_NAME ＝ </span><span style="color: #800000;">"</span><span style="color: #800000;">sessionid</span><span style="color: #800000;">"</span>                        <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串</span>
    SESSION_COOKIE_PATH ＝ <span style="color: #800000;">"</span><span style="color: #800000;">/</span><span style="color: #800000;">"</span>                                <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie保存的路径</span>
    SESSION_COOKIE_DOMAIN = None                              <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie保存的域名</span>
    SESSION_COOKIE_SECURE = False                             <span style="color: #008000;">#</span><span style="color: #008000;"> 是否Https传输cookie</span>
    SESSION_COOKIE_HTTPONLY = True                            <span style="color: #008000;">#</span><span style="color: #008000;"> 是否Session的cookie只支持http传输</span>
    SESSION_COOKIE_AGE = 1209600                              <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie失效日期（2周）</span>
    SESSION_EXPIRE_AT_BROWSER_CLOSE = False                   <span style="color: #008000;">#</span><span style="color: #008000;"> 是否关闭浏览器使得Session过期</span>
    SESSION_SAVE_EVERY_REQUEST = False                        <span style="color: #008000;">#</span><span style="color: #008000;"> 是否每次请求都保存Session，默认修改之后才保存</span>
<span style="color: #000000;"> 
 
 
b. 使用
 
    同上</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4 id="autoid-12-0-0">3、文件Session</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;b08484b3-3da1-4f74-9efa-024119d5cda9&#39;)"><img id="code_img_closed_b08484b3-3da1-4f74-9efa-024119d5cda9" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_b08484b3-3da1-4f74-9efa-024119d5cda9" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;b08484b3-3da1-4f74-9efa-024119d5cda9&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_b08484b3-3da1-4f74-9efa-024119d5cda9" class="cnblogs_code_hide">
<pre><span style="color: #000000;">a. 配置 settings.py
 
    SESSION_ENGINE </span>= <span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.sessions.backends.file</span><span style="color: #800000;">'</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> 引擎</span>
    SESSION_FILE_PATH = None                                    <span style="color: #008000;">#</span><span style="color: #008000;"> 缓存文件路径，如果为None，则使用tempfile模块获取一个临时地址tempfile.gettempdir()                                                            # 如：/var/folders/d3/j9tj0gz93dg06bmwxmhh6_xm0000gn/T</span>
<span style="color: #000000;"> 
 
    SESSION_COOKIE_NAME ＝ </span><span style="color: #800000;">"</span><span style="color: #800000;">sessionid</span><span style="color: #800000;">"</span>                          <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串</span>
    SESSION_COOKIE_PATH ＝ <span style="color: #800000;">"</span><span style="color: #800000;">/</span><span style="color: #800000;">"</span>                                  <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie保存的路径</span>
    SESSION_COOKIE_DOMAIN = None                                <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie保存的域名</span>
    SESSION_COOKIE_SECURE = False                               <span style="color: #008000;">#</span><span style="color: #008000;"> 是否Https传输cookie</span>
    SESSION_COOKIE_HTTPONLY = True                              <span style="color: #008000;">#</span><span style="color: #008000;"> 是否Session的cookie只支持http传输</span>
    SESSION_COOKIE_AGE = 1209600                                <span style="color: #008000;">#</span><span style="color: #008000;"> Session的cookie失效日期（2周）</span>
    SESSION_EXPIRE_AT_BROWSER_CLOSE = False                     <span style="color: #008000;">#</span><span style="color: #008000;"> 是否关闭浏览器使得Session过期</span>
    SESSION_SAVE_EVERY_REQUEST = False                          <span style="color: #008000;">#</span><span style="color: #008000;"> 是否每次请求都保存Session，默认修改之后才保存</span>
<span style="color: #000000;"> 
b. 使用
 
    同上</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4 id="autoid-12-0-0">4、缓存+数据库Session</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;32203e2e-99b8-414f-bdcd-ca3813de9a35&#39;)"><img id="code_img_closed_32203e2e-99b8-414f-bdcd-ca3813de9a35" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_32203e2e-99b8-414f-bdcd-ca3813de9a35" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;32203e2e-99b8-414f-bdcd-ca3813de9a35&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_32203e2e-99b8-414f-bdcd-ca3813de9a35" class="cnblogs_code_hide">
<pre><span style="color: #000000;">数据库用于做持久化，缓存用于提高效率
 
a. 配置 settings.py
 
    SESSION_ENGINE </span>= <span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.sessions.backends.cached_db</span><span style="color: #800000;">'</span>        <span style="color: #008000;">#</span><span style="color: #008000;"> 引擎</span>
<span style="color: #000000;"> 
b. 使用
 
    同上</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h4 id="autoid-12-0-0">5、加密cookie Session</h4>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;a0cd41db-4a45-4d89-93c5-67c8588ea8de&#39;)"><img id="code_img_closed_a0cd41db-4a45-4d89-93c5-67c8588ea8de" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_a0cd41db-4a45-4d89-93c5-67c8588ea8de" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;a0cd41db-4a45-4d89-93c5-67c8588ea8de&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_a0cd41db-4a45-4d89-93c5-67c8588ea8de" class="cnblogs_code_hide">
<pre><span style="color: #000000;">a. 配置 settings.py
     
    SESSION_ENGINE </span>= <span style="color: #800000;">'</span><span style="color: #800000;">django.contrib.sessions.backends.signed_cookies</span><span style="color: #800000;">'</span>   <span style="color: #008000;">#</span><span style="color: #008000;"> 引擎</span>
<span style="color: #000000;"> 
b. 使用
 
    同上</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>跟数据库的操作一样，在Django中不同缓存方式的使用方法是一致的，想要改变缓存的类型只需要改变上述相应配置即可。</p>
<p>更多参考：<a href="https://docs.djangoproject.com/en/1.9/topics/http/sessions/" target="_blank">猛击这里</a>&nbsp;和&nbsp;<a href="https://docs.djangoproject.com/en/1.9/ref/settings/#settings-sessions" target="_blank">猛击这里</a></p>
<p><strong>扩展：Session用户验证(装饰器）</strong></p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_45429" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">def</code>&nbsp;<code class="python plain">login(func):</code></div>
<div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">def</code>&nbsp;<code class="python plain">wrap(request,&nbsp;</code><code class="python keyword">*</code><code class="python plain">args,&nbsp;</code><code class="python keyword">*</code><code class="python keyword">*</code><code class="python plain">kwargs):</code></div>
<div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># 如果未登陆，跳转到指定页面</code></div>
<div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code>&nbsp;<code class="python plain">request.path&nbsp;</code><code class="python keyword">=</code><code class="python keyword">=</code>&nbsp;<code class="python string">'/test/'</code><code class="python plain">:</code></div>
<div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code>&nbsp;<code class="python plain">redirect(</code><code class="python string">'http://www.baidu.com'</code><code class="python plain">)</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code>&nbsp;<code class="python plain">func(request,&nbsp;</code><code class="python keyword">*</code><code class="python plain">args,&nbsp;</code><code class="python keyword">*</code><code class="python keyword">*</code><code class="python plain">kwargs)</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code>&nbsp;<code class="python plain">wrap</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>　　</p>
<h2>十四、 缓存</h2>
<p>由于Django是动态网站，所有每次请求均会去数据进行相应的操作，当程序访问量大时，耗时必然会更加明显，最简单解决方式是使用：缓存，缓存将一个某个views的返回值保存至内存或者memcache中，5分钟内再有人来访问时，则不再去执行view中的操作，而是直接从内存或者Redis中之前缓存的内容拿到，并返回。</p>
<p>Django中提供了6种缓存方式：</p>
<ul>
<li>开发调试</li>
<li>内存</li>
<li>文件</li>
<li>数据库</li>
<li>Memcache缓存（python-memcached模块）</li>
<li>Memcache缓存（pylibmc模块）</li>
</ul>
<p>和数据库类似，缓存的具体操作都是一样的，使用不同的方式只需要将配置改掉即可</p>
<p><strong>1、配置</strong></p>
<p>a、开发调试</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;00f68d88-6375-4bc5-97fc-3680178c3ab9&#39;)"><img id="code_img_closed_00f68d88-6375-4bc5-97fc-3680178c3ab9" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_00f68d88-6375-4bc5-97fc-3680178c3ab9" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;00f68d88-6375-4bc5-97fc-3680178c3ab9&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_00f68d88-6375-4bc5-97fc-3680178c3ab9" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 此为开始调试用，实际内部不做任何操作</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 配置：</span>
        CACHES =<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.dummy.DummyCache</span><span style="color: #800000;">'</span>,     <span style="color: #008000;">#</span><span style="color: #008000;"> 引擎</span>
                <span style="color: #800000;">'</span><span style="color: #800000;">TIMEOUT</span><span style="color: #800000;">'</span>: 300,                                               <span style="color: #008000;">#</span><span style="color: #008000;"> 缓存超时时间（默认300，None表示永不过期，0表示立即过期）</span>
                <span style="color: #800000;">'</span><span style="color: #800000;">OPTIONS</span><span style="color: #800000;">'</span><span style="color: #000000;">:{
                    </span><span style="color: #800000;">'</span><span style="color: #800000;">MAX_ENTRIES</span><span style="color: #800000;">'</span>: 300,                                       <span style="color: #008000;">#</span><span style="color: #008000;"> 最大缓存个数（默认300）</span>
                    <span style="color: #800000;">'</span><span style="color: #800000;">CULL_FREQUENCY</span><span style="color: #800000;">'</span>: 3,                                      <span style="color: #008000;">#</span><span style="color: #008000;"> 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span>
<span style="color: #000000;">                },
                </span><span style="color: #800000;">'</span><span style="color: #800000;">KEY_PREFIX</span><span style="color: #800000;">'</span>: <span style="color: #800000;">''</span>,                                             <span style="color: #008000;">#</span><span style="color: #008000;"> 缓存key的前缀（默认空）</span>
                <span style="color: #800000;">'</span><span style="color: #800000;">VERSION</span><span style="color: #800000;">'</span>: 1,                                                 <span style="color: #008000;">#</span><span style="color: #008000;"> 缓存key的版本（默认1）</span>
                <span style="color: #800000;">'</span><span style="color: #800000;">KEY_FUNCTION</span><span style="color: #800000;">'</span> 函数名                                          <span style="color: #008000;">#</span><span style="color: #008000;"> 生成key的函数（默认函数会生成为：【前缀:版本:key】）</span>
<span style="color: #000000;">            }
        }


    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 自定义key</span>
    <span style="color: #0000ff;">def</span><span style="color: #000000;"> default_key_func(key, key_prefix, version):
        </span><span style="color: #800000;">"""</span><span style="color: #800000;">
        Default function to generate keys.

        Constructs the key used by all other methods. By default it prepends
        the `key_prefix'. KEY_FUNCTION can be used to specify an alternate
        function with custom key making behavior.
        </span><span style="color: #800000;">"""</span>
        <span style="color: #0000ff;">return</span> <span style="color: #800000;">'</span><span style="color: #800000;">%s:%s:%s</span><span style="color: #800000;">'</span> %<span style="color: #000000;"> (key_prefix, version, key)

    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> get_key_func(key_func):
        </span><span style="color: #800000;">"""</span><span style="color: #800000;">
        Function to decide which key function to use.

        Defaults to ``default_key_func``.
        </span><span style="color: #800000;">"""</span>
        <span style="color: #0000ff;">if</span> key_func <span style="color: #0000ff;">is</span> <span style="color: #0000ff;">not</span><span style="color: #000000;"> None:
            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> callable(key_func):
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> key_func
            </span><span style="color: #0000ff;">else</span><span style="color: #000000;">:
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> import_string(key_func)
        </span><span style="color: #0000ff;">return</span> default_key_func</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>b、内存</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;e6e2f919-1847-4bf4-940e-213c139ca985&#39;)"><img id="code_img_closed_e6e2f919-1847-4bf4-940e-213c139ca985" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_e6e2f919-1847-4bf4-940e-213c139ca985" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;e6e2f919-1847-4bf4-940e-213c139ca985&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_e6e2f919-1847-4bf4-940e-213c139ca985" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 此缓存将内容保存至内存的变量中</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 配置：</span>
        CACHES =<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.locmem.LocMemCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">unique-snowflake</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            }
        }

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 注：其他配置同开发调试版本</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>c、文件</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;bf2098e1-8d06-4e99-ba7b-8e57c88201ed&#39;)"><img id="code_img_closed_bf2098e1-8d06-4e99-ba7b-8e57c88201ed" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_bf2098e1-8d06-4e99-ba7b-8e57c88201ed" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;bf2098e1-8d06-4e99-ba7b-8e57c88201ed&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_bf2098e1-8d06-4e99-ba7b-8e57c88201ed" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 此缓存将内容保存至文件</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 配置：</span>
<span style="color: #000000;">
        CACHES </span>=<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.filebased.FileBasedCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">/var/tmp/django_cache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            }
        }
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 注：其他配置同开发调试版本</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>d、数据库</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;27e598f4-b0d3-49da-aee5-15c9cc572543&#39;)"><img id="code_img_closed_27e598f4-b0d3-49da-aee5-15c9cc572543" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_27e598f4-b0d3-49da-aee5-15c9cc572543" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;27e598f4-b0d3-49da-aee5-15c9cc572543&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_27e598f4-b0d3-49da-aee5-15c9cc572543" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 此缓存将内容保存至数据库</span>

    <span style="color: #008000;">#</span><span style="color: #008000;"> 配置：</span>
        CACHES =<span style="color: #000000;"> {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
                </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.db.DatabaseCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">my_cache_table</span><span style="color: #800000;">'</span>, <span style="color: #008000;">#</span><span style="color: #008000;"> 数据库表</span>
<span style="color: #000000;">            }
        }

    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 注：执行创建表命令 python manage.py createcachetable</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>e、Memcache缓存（python-memcached模块）</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;616aa4f6-67c9-47fa-a469-c248ef071a48&#39;)"><img id="code_img_closed_616aa4f6-67c9-47fa-a469-c248ef071a48" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_616aa4f6-67c9-47fa-a469-c248ef071a48" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;616aa4f6-67c9-47fa-a469-c248ef071a48&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_616aa4f6-67c9-47fa-a469-c248ef071a48" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 此缓存使用python-memcached模块连接memcache</span>
<span style="color: #000000;">
    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.MemcachedCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">127.0.0.1:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        }
    }

    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.MemcachedCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">unix:/tmp/memcached.sock</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        }
    }   

    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.MemcachedCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span><span style="color: #000000;">: [
                </span><span style="color: #800000;">'</span><span style="color: #800000;">172.19.26.240:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">172.19.26.242:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            ]
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>f、Memcache缓存（pylibmc模块）</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;1ba3748b-c58d-4bc4-b347-f9235d6a4ce1&#39;)"><img id="code_img_closed_1ba3748b-c58d-4bc4-b347-f9235d6a4ce1" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_1ba3748b-c58d-4bc4-b347-f9235d6a4ce1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;1ba3748b-c58d-4bc4-b347-f9235d6a4ce1&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_1ba3748b-c58d-4bc4-b347-f9235d6a4ce1" class="cnblogs_code_hide">
<pre><span style="color: #008000;">#</span><span style="color: #008000;"> 此缓存使用pylibmc模块连接memcache</span>
<span style="color: #000000;">    
    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.PyLibMCCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">127.0.0.1:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        }
    }

    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.PyLibMCCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">/tmp/memcached.sock</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        }
    }   

    CACHES </span>=<span style="color: #000000;"> {
        </span><span style="color: #800000;">'</span><span style="color: #800000;">default</span><span style="color: #800000;">'</span><span style="color: #000000;">: {
            </span><span style="color: #800000;">'</span><span style="color: #800000;">BACKEND</span><span style="color: #800000;">'</span>: <span style="color: #800000;">'</span><span style="color: #800000;">django.core.cache.backends.memcached.PyLibMCCache</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            </span><span style="color: #800000;">'</span><span style="color: #800000;">LOCATION</span><span style="color: #800000;">'</span><span style="color: #000000;">: [
                </span><span style="color: #800000;">'</span><span style="color: #800000;">172.19.26.240:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
                </span><span style="color: #800000;">'</span><span style="color: #800000;">172.19.26.242:11211</span><span style="color: #800000;">'</span><span style="color: #000000;">,
            ]
        }
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p><strong>2、应用</strong></p>
<p>a. 全站使用</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;3f027e80-0c59-408f-a5ee-42013e7f34d9&#39;)"><img id="code_img_closed_3f027e80-0c59-408f-a5ee-42013e7f34d9" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_3f027e80-0c59-408f-a5ee-42013e7f34d9" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;3f027e80-0c59-408f-a5ee-42013e7f34d9&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_3f027e80-0c59-408f-a5ee-42013e7f34d9" class="cnblogs_code_hide">
<pre><span style="color: #000000;">使用中间件，经过一系列的认证等操作，如果内容在缓存中存在，则使用FetchFromCacheMiddleware获取内容并返回给用户，当返回给用户之前，判断缓存中是否已经存在，如果不存在则UpdateCacheMiddleware会将缓存保存至缓存，从而实现全站缓存

    MIDDLEWARE </span>=<span style="color: #000000;"> [
        </span><span style="color: #800000;">'</span><span style="color: #800000;">django.middleware.cache.UpdateCacheMiddleware</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 其他中间件...</span>
        <span style="color: #800000;">'</span><span style="color: #800000;">django.middleware.cache.FetchFromCacheMiddleware</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    ]

    CACHE_MIDDLEWARE_ALIAS </span>= <span style="color: #800000;">""</span><span style="color: #000000;">
    CACHE_MIDDLEWARE_SECONDS </span>= <span style="color: #800000;">""</span><span style="color: #000000;">
    CACHE_MIDDLEWARE_KEY_PREFIX </span>= <span style="color: #800000;">""</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>b.&nbsp;单独视图缓存</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;62f08349-6b3f-49f1-9244-4fad9865d9c4&#39;)"><img id="code_img_closed_62f08349-6b3f-49f1-9244-4fad9865d9c4" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_62f08349-6b3f-49f1-9244-4fad9865d9c4" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;62f08349-6b3f-49f1-9244-4fad9865d9c4&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_62f08349-6b3f-49f1-9244-4fad9865d9c4" class="cnblogs_code_hide">
<pre><span style="color: #000000;">方式一：
        </span><span style="color: #0000ff;">from</span> django.views.decorators.cache <span style="color: #0000ff;">import</span><span style="color: #000000;"> cache_page

        @cache_page(</span>60 * 15<span style="color: #000000;">)
        </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> my_view(request):
            ...

    方式二：
        </span><span style="color: #0000ff;">from</span> django.views.decorators.cache <span style="color: #0000ff;">import</span><span style="color: #000000;"> cache_page

        urlpatterns </span>=<span style="color: #000000;"> [
            url(r</span><span style="color: #800000;">'</span><span style="color: #800000;">^foo/([0-9]{1,2})/$</span><span style="color: #800000;">'</span>, cache_page(60 * 15<span style="color: #000000;">)(my_view)),
        ]</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>c、局部视图使用</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;1c63cc37-0091-4870-98b5-3e447978cbdd&#39;)"><img id="code_img_closed_1c63cc37-0091-4870-98b5-3e447978cbdd" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_1c63cc37-0091-4870-98b5-3e447978cbdd" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;1c63cc37-0091-4870-98b5-3e447978cbdd&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_1c63cc37-0091-4870-98b5-3e447978cbdd" class="cnblogs_code_hide">
<pre><span style="color: #000000;">a. 引入TemplateTag

        {</span>% load cache %<span style="color: #000000;">}

    b. 使用缓存

        {</span>% cache 5000 缓存key %<span style="color: #000000;">}
            缓存内容
        {</span>% endcache %}</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>注：如果出现多个url匹配同一个view函数的情况，缓存机制会根据每一个不同的url做单独的缓存</p>
<p>更多：<a href="https://docs.djangoproject.com/en/1.9/topics/cache/" target="_blank">猛击这里</a></p>
<h3>十五、 序列化</h3>
<p>关于Django中的序列化主要应用在将数据库中检索的数据返回给客户端用户，特别的Ajax请求一般返回的为Json格式。</p>
<h4>1. serializers</h4>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_859851" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">django.core&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">serializers</code></div>
<div class="line number2 index1 alt1">&nbsp;</div>
<div class="line number3 index2 alt2"><code class="python plain">ret&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">models.BookType.objects.</code><code class="python functions">all</code><code class="python plain">()</code></div>
<div class="line number4 index3 alt1">&nbsp;</div>
<div class="line number5 index4 alt2"><code class="python plain">data&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">serializers.serialize(</code><code class="python string">"json"</code><code class="python plain">, ret)</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h4>2. json.dumps</h4>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_568010" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">import</code>&nbsp;<code class="python plain">json</code></div>
<div class="line number2 index1 alt1">&nbsp;</div>
<div class="line number3 index2 alt2"><code class="python comments">#ret = models.BookType.objects.all().values('caption')</code></div>
<div class="line number4 index3 alt1"><code class="python plain">ret&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">models.BookType.objects.</code><code class="python functions">all</code><code class="python plain">().values_list(</code><code class="python string">'caption'</code><code class="python plain">)</code></div>
<div class="line number5 index4 alt2">&nbsp;</div>
<div class="line number6 index5 alt1"><code class="python plain">ret</code><code class="python keyword">=</code><code class="python functions">list</code><code class="python plain">(ret)</code></div>
<div class="line number7 index6 alt2">&nbsp;</div>
<div class="line number8 index7 alt1"><code class="python plain">result&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">json.dumps(ret)</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>由于json.dumps时无法处理datetime日期，所以可以通过自定义处理器来做扩展，如：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;e7da0ddb-96a8-4577-a790-0a330ebbaf77&#39;)"><img id="code_img_closed_e7da0ddb-96a8-4577-a790-0a330ebbaf77" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_e7da0ddb-96a8-4577-a790-0a330ebbaf77" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;e7da0ddb-96a8-4577-a790-0a330ebbaf77&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_e7da0ddb-96a8-4577-a790-0a330ebbaf77" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">import</span><span style="color: #000000;"> json 
</span><span style="color: #0000ff;">from</span> datetime <span style="color: #0000ff;">import</span><span style="color: #000000;"> date 
</span><span style="color: #0000ff;">from</span> datetime <span style="color: #0000ff;">import</span><span style="color: #000000;"> datetime 
   
</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> JsonCustomEncoder(json.JSONEncoder): 
    
    </span><span style="color: #0000ff;">def</span><span style="color: #000000;"> default(self, field): 
     
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> isinstance(field, datetime): 
            </span><span style="color: #0000ff;">return</span> o.strftime(<span style="color: #800000;">'</span><span style="color: #800000;">%Y-%m-%d %H:%M:%S</span><span style="color: #800000;">'</span><span style="color: #000000;">) 
        </span><span style="color: #0000ff;">elif</span><span style="color: #000000;"> isinstance(field, date): 
            </span><span style="color: #0000ff;">return</span> o.strftime(<span style="color: #800000;">'</span><span style="color: #800000;">%Y-%m-%d</span><span style="color: #800000;">'</span><span style="color: #000000;">) 
        </span><span style="color: #0000ff;">else</span><span style="color: #000000;">: 
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> json.JSONEncoder.default(self, field) 
   
   
</span><span style="color: #008000;">#</span><span style="color: #008000;"> ds = json.dumps(d, cls=JsonCustomEncoder) </span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h2>十六、 信号</h2>
<p>Django中提供了“信号调度”，用于在框架执行操作时解耦。通俗来讲，就是一些动作发生的时候，信号允许特定的发送者去提醒一些接受者。</p>
<p><strong>1、Django内置信号</strong></p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_666404" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python plain">Model signals</code></div>
<div class="line number2 index1 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pre_init&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># django的modal执行其构造方法前，自动触发</code></div>
<div class="line number3 index2 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">post_init&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># django的modal执行其构造方法后，自动触发</code></div>
<div class="line number4 index3 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pre_save&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># django的modal对象保存前，自动触发</code></div>
<div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">post_save&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># django的modal对象保存后，自动触发</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pre_delete&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># django的modal对象删除前，自动触发</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">post_delete&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># django的modal对象删除后，自动触发</code></div>
<div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">m2m_changed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># django的modal中使用m2m字段操作第三张表（add,remove,clear）前后，自动触发</code></div>
<div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">class_prepared&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># 程序启动时，检测已注册的app中modal类，对于每一个类，自动触发</code></div>
<div class="line number10 index9 alt1"><code class="python plain">Management signals</code></div>
<div class="line number11 index10 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pre_migrate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># 执行migrate命令前，自动触发</code></div>
<div class="line number12 index11 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">post_migrate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># 执行migrate命令后，自动触发</code></div>
<div class="line number13 index12 alt2"><code class="python plain">Request</code><code class="python keyword">/</code><code class="python plain">response signals</code></div>
<div class="line number14 index13 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">request_started&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># 请求到来前，自动触发</code></div>
<div class="line number15 index14 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">request_finished&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># 请求结束后，自动触发</code></div>
<div class="line number16 index15 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">got_request_exception&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># 请求异常后，自动触发</code></div>
<div class="line number17 index16 alt2"><code class="python plain">Test signals</code></div>
<div class="line number18 index17 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">setting_changed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># 使用test测试修改配置文件时，自动触发</code></div>
<div class="line number19 index18 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">template_rendered&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># 使用test测试渲染模板时，自动触发</code></div>
<div class="line number20 index19 alt1"><code class="python plain">Database Wrappers</code></div>
<div class="line number21 index20 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">connection_created&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python comments"># 创建数据库连接时，自动触发</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>对于Django内置的信号，仅需注册指定信号，当程序执行相应操作时，自动触发注册函数：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;01fe0219-0d05-46ef-8806-d405820c2900&#39;)"><img id="code_img_closed_01fe0219-0d05-46ef-8806-d405820c2900" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_01fe0219-0d05-46ef-8806-d405820c2900" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;01fe0219-0d05-46ef-8806-d405820c2900&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_01fe0219-0d05-46ef-8806-d405820c2900" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.core.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> request_finished
    </span><span style="color: #0000ff;">from</span> django.core.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> request_started
    </span><span style="color: #0000ff;">from</span> django.core.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> got_request_exception

    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> class_prepared
    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> pre_init, post_init
    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> pre_save, post_save
    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> pre_delete, post_delete
    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> m2m_changed
    </span><span style="color: #0000ff;">from</span> django.db.models.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> pre_migrate, post_migrate

    </span><span style="color: #0000ff;">from</span> django.test.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> setting_changed
    </span><span style="color: #0000ff;">from</span> django.test.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> template_rendered

    </span><span style="color: #0000ff;">from</span> django.db.backends.signals <span style="color: #0000ff;">import</span><span style="color: #000000;"> connection_created


    </span><span style="color: #0000ff;">def</span> callback(sender, **<span style="color: #000000;">kwargs):
        </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">"</span><span style="color: #800000;">xxoo_callback</span><span style="color: #800000;">"</span><span style="color: #000000;">)
        </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(sender,kwargs)

    xxoo.connect(callback)
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> xxoo指上述导入的内容</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h3 id="autoid-16-0-0"><strong>2、自定义信号</strong></h3>
<p>a. 定义并注册信号</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_574627" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python comments"># 自定制信号</code></div>
<div class="line number2 index1 alt1"><code class="python keyword">import</code>&nbsp;<code class="python plain">django.dispatch</code></div>
<div class="line number3 index2 alt2"><code class="python plain">pizza_done&nbsp;</code><code class="python keyword">=</code>&nbsp;<code class="python plain">django.dispatch.Signal(providing_args</code><code class="python keyword">=</code><code class="python plain">[</code><code class="python string">"toppings"</code><code class="python plain">,&nbsp;</code><code class="python string">"size"</code><code class="python plain">])</code></div>
<div class="line number4 index3 alt1">&nbsp;</div>
<div class="line number5 index4 alt2"><code class="python keyword">def</code>&nbsp;<code class="python plain">callback(sender,&nbsp;</code><code class="python keyword">*</code><code class="python keyword">*</code><code class="python plain">kwargs):</code></div>
<div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">(</code><code class="python string">"self-define"</code><code class="python plain">)</code></div>
<div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">(sender, kwargs)</code></div>
<div class="line number8 index7 alt1">&nbsp;</div>
<div class="line number9 index8 alt2"><code class="python plain">pizza_done.connect(callback)</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>　　</p>
<p>b. 触发信号</p>
<div class="cnblogs_Highlighter sh-gutter">
<div>
<div id="highlighter_366648" class="syntaxhighlighter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python keyword">from</code>&nbsp;<code class="python plain">路径&nbsp;</code><code class="python keyword">import</code>&nbsp;<code class="python plain">pizza_done</code></div>
<div class="line number2 index1 alt1"><code class="python spaces">&nbsp;</code>&nbsp;</div>
<div class="line number3 index2 alt2"><code class="python plain">pizza_done.send(sender</code><code class="python keyword">=</code><code class="python string">'seven'</code><code class="python plain">,toppings</code><code class="python keyword">=</code><code class="python value">123</code><code class="python plain">, size</code><code class="python keyword">=</code><code class="python value">456</code><code class="python plain">)</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>　　</p>
<p>由于内置信号的触发者已经集成到Django中，所以其会自动调用，而对于自定义信号则需要开发者在任意位置触发。</p>
<p>更多：<a href="https://docs.djangoproject.com/en/dev/topics/signals/" target="_blank">猛击这里</a></p>
<p>&nbsp;</p>
<h2 id="autoid-16-0-0">十七、admin</h2>
<p>django amdin是django提供的一个后台管理页面，改管理页面提供完善的html和css，使得你在通过Model创建完数据库表之后，就可以对数据进行增删改查，而使用django admin 则需要以下步骤：</p>
<ul>
<li>创建后台管理员</li>
<li>配置url</li>
<li>注册和配置django admin后台管理页面</li>
</ul>
<p>注：不建议新手经常使用admin，会形成依赖，核心的是model模块的操作！</p>
<h3 id="autoid-17-0-0">1、创建后台管理员</h3>
<div class="cnblogs_Highlighter">
<div>
<div id="highlighter_451575" class="syntaxhighlighter nogutter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python plain">python manage.py createsuperuser</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h3 id="autoid-17-0-0">2、配置后台管理url（默认已配）</h3>
<div class="cnblogs_Highlighter">
<div>
<div id="highlighter_27571" class="syntaxhighlighter nogutter  python">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="python plain">url(r</code><code class="python string">'^admin/'</code><code class="python plain">, include(admin.site.urls))</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h3 id="autoid-17-0-0">3、注册和配置django admin 后台管理页面</h3>
<h5 id="autoid-17-0-0">a、在admin中执行如下配置</h5>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;a9531005-0834-4d10-9ab6-0ca1eb3a29bb&#39;)"><img id="code_img_closed_a9531005-0834-4d10-9ab6-0ca1eb3a29bb" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_a9531005-0834-4d10-9ab6-0ca1eb3a29bb" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;a9531005-0834-4d10-9ab6-0ca1eb3a29bb&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_a9531005-0834-4d10-9ab6-0ca1eb3a29bb" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.contrib <span style="color: #0000ff;">import</span><span style="color: #000000;"> admin
  
</span><span style="color: #0000ff;">from</span> app01 <span style="color: #0000ff;">import</span><span style="color: #000000;">  models
  
admin.site.register(models.UserType)
admin.site.register(models.UserInfo)
admin.site.register(models.UserGroup)
admin.site.register(models.Asset)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h5 id="autoid-17-0-0">b、设置数据表名称</h5>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;f0132005-537e-4ee0-a09f-291f921acbb8&#39;)"><img id="code_img_closed_f0132005-537e-4ee0-a09f-291f921acbb8" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_f0132005-537e-4ee0-a09f-291f921acbb8" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;f0132005-537e-4ee0-a09f-291f921acbb8&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_f0132005-537e-4ee0-a09f-291f921acbb8" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserType(models.Model):
    name </span>= models.CharField(max_length=50<span style="color: #000000;">)
  
    </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> Meta:
        verbose_name </span>= <span style="color: #800000;">'</span><span style="color: #800000;">用户类型</span><span style="color: #800000;">'</span><span style="color: #000000;">
        verbose_name_plural </span>= <span style="color: #800000;">'</span><span style="color: #800000;">用户类型</span><span style="color: #800000;">'</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h5 id="autoid-17-0-0">c、打开表之后，设定默认显示，需要在model中作如下配置</h5>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;df24208f-e814-4e0e-aab3-9cb12bec1f7b&#39;)"><img id="code_img_closed_df24208f-e814-4e0e-aab3-9cb12bec1f7b" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_df24208f-e814-4e0e-aab3-9cb12bec1f7b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;df24208f-e814-4e0e-aab3-9cb12bec1f7b&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_df24208f-e814-4e0e-aab3-9cb12bec1f7b" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserType(models.Model):
    name </span>= models.CharField(max_length=50<span style="color: #000000;">)
  
    </span><span style="color: #0000ff;">def</span> <span style="color: #800080;">__unicode__</span>(self):  <span style="color: #008000;">#</span><span style="color: #008000;"> python3 is __str__(self)</span>
        <span style="color: #0000ff;">return</span> self.name</pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h5 id="autoid-17-0-0">d、为数据表添加搜索功能</h5>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;0df2cc02-77d7-439a-9b7a-7bff5a994ea7&#39;)"><img id="code_img_closed_0df2cc02-77d7-439a-9b7a-7bff5a994ea7" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_0df2cc02-77d7-439a-9b7a-7bff5a994ea7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;0df2cc02-77d7-439a-9b7a-7bff5a994ea7&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_0df2cc02-77d7-439a-9b7a-7bff5a994ea7" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.contrib <span style="color: #0000ff;">import</span><span style="color: #000000;"> admin
  
</span><span style="color: #0000ff;">from</span> app01 <span style="color: #0000ff;">import</span><span style="color: #000000;">  models
  
</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfoAdmin(admin.ModelAdmin):
    list_display </span>= (<span style="color: #800000;">'</span><span style="color: #800000;">username</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">password</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    search_fields </span>= (<span style="color: #800000;">'</span><span style="color: #800000;">username</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span><span style="color: #000000;">)
  
admin.site.register(models.UserType)
admin.site.register(models.UserInfo,UserInfoAdmin)
admin.site.register(models.UserGroup)
admin.site.register(models.Asset)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<h5 id="autoid-17-0-0">e、添加快速过滤</h5>
<div class="cnblogs_code" onclick="cnblogs_code_show(&#39;83e95e59-7328-40b5-a8db-4be40a28db6a&#39;)"><img id="code_img_closed_83e95e59-7328-40b5-a8db-4be40a28db6a" class="code_img_closed" src="./Django框架全面讲解_files/ContractedBlock.gif" alt=""><img id="code_img_opened_83e95e59-7328-40b5-a8db-4be40a28db6a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide(&#39;83e95e59-7328-40b5-a8db-4be40a28db6a&#39;,event)" src="./Django框架全面讲解_files/ExpandedBlockStart.gif" alt="">
<div id="cnblogs_code_open_83e95e59-7328-40b5-a8db-4be40a28db6a" class="cnblogs_code_hide">
<pre><span style="color: #0000ff;">from</span> django.contrib <span style="color: #0000ff;">import</span><span style="color: #000000;"> admin
  
</span><span style="color: #0000ff;">from</span> app01 <span style="color: #0000ff;">import</span><span style="color: #000000;">  models
  
</span><span style="color: #0000ff;">class</span><span style="color: #000000;"> UserInfoAdmin(admin.ModelAdmin):
    list_display </span>= (<span style="color: #800000;">'</span><span style="color: #800000;">username</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">password</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    search_fields </span>= (<span style="color: #800000;">'</span><span style="color: #800000;">username</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span><span style="color: #000000;">)
    list_filter </span>= (<span style="color: #800000;">'</span><span style="color: #800000;">username</span><span style="color: #800000;">'</span>, <span style="color: #800000;">'</span><span style="color: #800000;">email</span><span style="color: #800000;">'</span><span style="color: #000000;">)
      
  
  
admin.site.register(models.UserType)
admin.site.register(models.UserInfo,UserInfoAdmin)
admin.site.register(models.UserGroup)
admin.site.register(models.Asset)</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
</div>
<div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block"><div id="BlogPostCategory">
    分类: 
            <a href="https://www.cnblogs.com/jokezl/category/1264318.html" target="_blank">python基础</a></div>


    <div id="blog_post_info">
<div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(10180406,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
        <a id="green_channel_follow" onclick="follow(&#39;a9b414f8-15da-4d5b-4487-08d5f422f4b6&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./Django框架全面讲解_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./Django框架全面讲解_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/jokezl/" target="_blank"><img src="./Django框架全面讲解_files/20191019172545.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/jokezl/">漫天飞雪世情难却</a><br>
            <a href="https://home.cnblogs.com/u/jokezl/followees/">关注 - 4</a><br>
            <a href="https://home.cnblogs.com/u/jokezl/followers/">粉丝 - 3</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow(&#39;a9b414f8-15da-4d5b-4487-08d5f422f4b6&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(10180406,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">0</span>
    </div>
    <div class="buryit" onclick="votePost(10180406,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>

<script type="text/javascript">
    currentDiggType = 0;
</script></div>
    <div class="clear"></div>
    <div id="post_next_prev">

    <a href="https://www.cnblogs.com/jokezl/p/10179291.html" class="p_n_p_prefix">« </a> 上一篇：    <a href="https://www.cnblogs.com/jokezl/p/10179291.html" title="发布于 2018-12-26 15:17">数据库优化</a>
    <br>
    <a href="https://www.cnblogs.com/jokezl/p/10181217.html" class="p_n_p_prefix">» </a> 下一篇：    <a href="https://www.cnblogs.com/jokezl/p/10181217.html" title="发布于 2018-12-26 19:33">MySQL数据库优化总结</a>

</div>
</div>
        </div>
	
        <div class="postfoot">
            posted on 
<span id="post-date">2018-12-26 17:24</span>&nbsp;
<a href="https://www.cnblogs.com/jokezl/">漫天飞雪世情难却</a>&nbsp;
阅读(<span id="post_view_count">2691</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=10180406" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(10180406);return false;">收藏</a>
        </div>
    </div>
</div>

<script src="./Django框架全面讲解_files/highlight.min.js.下载"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 447764, cb_blogApp = 'jokezl', cb_blogUserGuid = 'a9b414f8-15da-4d5b-4487-08d5f422f4b6';
    var cb_entryId = 10180406, cb_entryCreatedDate = '2018-12-26 17:24', cb_postType = 1; 
    loadViewCount(cb_entryId);
    loadSideColumnAd();
</script><a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<script>
    var commentManager = new blogCommentManager();
    commentManager.renderComments(0);
</script>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="https://www.cnblogs.com/jokezl/p/10180406.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/jokezl/p/10180406.html#top">返回顶部</a></div>
    <div id="comment_form_container" style="visibility: visible;"><div class="login_tips">
    注册用户登录后才能发表评论，请 
    <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a>
     或 
    <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，
    <a href="https://www.cnblogs.com/">访问</a> 网站首页。
</div></div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"><a href="http://www.ucancode.com/index.htm" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-ucancode&#39;)">【推荐】超50万行VC++源码: 大型组态工控、电力仿真CAD与GIS源码库</a><br><a href="https://developer.aliyun.com/article/717197?utm_content=g_1000088944" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-阿里云开发者社区&#39;)">【推荐】开放下载！《长安十二时辰》爆款背后的优酷技术秘籍首次公开</a><br></div>
    <div id="opt_under_post"></div>
    <script async="" src="./Django框架全面讲解_files/gpt.js.下载"></script>
    <script>
        var mobileVisit = screen.width < 500;
        window.googletag = window.googletag || { cmd: [] };
        googletag.cmd.push(function () {
            googletag.defineSlot('/1090369/C1', [300, 250], 'div-gpt-ad-1592365906576-0').addService(googletag.pubads());
            if (!mobileVisit) {
                googletag.defineSlot('/1090369/C2', [468, 60], 'div-gpt-ad-1592366332455-0').addService(googletag.pubads());
            }
            googletag.pubads().enableSingleRequest();
            googletag.enableServices();
        });
    </script>
    <div id="cnblogs_c1" class="c_ad_block">
        <div id="div-gpt-ad-1592365906576-0" style="width: 300px; height: 250px;" data-google-query-id="CKu_gPq4leoCFRDDlgodya4OyQ">
            
        <div id="google_ads_iframe_/1090369/C1_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/1090369/C1_0" title="3rd party ad content" name="google_ads_iframe_/1090369/C1_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" style="border: 0px; vertical-align: bottom;" data-google-container-id="1" data-load-complete="true" src="./Django框架全面讲解_files/saved_resource.html"></iframe></div></div>
    </div>
    <div id="under_post_news"><div class="recomm-block"><b>相关博文：</b><br>·  <a title="Django全面讲解（2/2）" href="https://www.cnblogs.com/limengjie0104/p/9180602.html" target="_blank" onclick="clickRecomItmem(9180602)">Django全面讲解（2/2）</a><br>·  <a title="Django框架全面讲解" href="https://www.cnblogs.com/LiCheng-/p/6920900.html" target="_blank" onclick="clickRecomItmem(6920900)">Django框架全面讲解</a><br>·  <a title="Python全栈开发之21、django" href="https://www.cnblogs.com/Wxtrkbc/p/5798228.html" target="_blank" onclick="clickRecomItmem(5798228)">Python全栈开发之21、django</a><br>·  <a title="Django之Model操作" href="https://www.cnblogs.com/kimyeee/p/7241754.html" target="_blank" onclick="clickRecomItmem(7241754)">Django之Model操作</a><br>·  <a title="Django【进阶篇 】" href="https://www.cnblogs.com/zero-white/p/8730082.html" target="_blank" onclick="clickRecomItmem(8730082)">Django【进阶篇 】</a><br>»  <a target="_blank" href="https://recomm.cnblogs.com/blogpost/10180406">更多推荐...</a></div></div>
    <div id="cnblogs_c2" class="c_ad_block" style="display: none;">
        <div id="div-gpt-ad-1592366332455-0" style="width: 468px; height: 60px;" data-google-query-id="CMax__m4leoCFRDDlgodya4OyQ">
            <script>
                if (!mobileVisit) {
                    if (canShowAdsense()) {
                        googletag.cmd.push(function () { googletag.display('div-gpt-ad-1592366332455-0'); });
                    } else {
                        $('#cnblogs_c2').hide();
                    }
                }
            </script>
        <div id="google_ads_iframe_/1090369/C2_0__container__" style="border: 0pt none; width: 468px; height: 60px;"></div></div>
    </div>
    <div id="under_post_kb">
<div class="itnews c_ad_block">
    <b>最新 IT 新闻</b>:
    <br>
 ·              <a href="https://news.cnblogs.com/n/665682/" target="_blank">腾讯股价创历史新高，马化腾中国首富之位稳了？</a>
            <br>
 ·              <a href="https://news.cnblogs.com/n/665681/" target="_blank">拜腾汽车被曝工厂欠费停水断电 近千名员工维权讨薪</a>
            <br>
 ·              <a href="https://news.cnblogs.com/n/665680/" target="_blank">月产能达20万片 国家存储器基地项目二期在武汉开工</a>
            <br>
 ·              <a href="https://news.cnblogs.com/n/665679/" target="_blank">任天堂或退出手机游戏市场 将专注于Switch</a>
            <br>
 ·              <a href="https://news.cnblogs.com/n/665678/" target="_blank">基石、运气和号角 海尔张瑞敏的工业互联网之战</a>
            <br>
    » <a href="https://news.cnblogs.com/" title="IT 新闻" target="_blank">更多新闻...</a>
</div></div>
    <div id="HistoryToday" class="c_ad_block"></div>
    <script type="text/javascript">
        fixPostBody();
        deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);        deliverAdT2();
        deliverAdC1();
        deliverAdC2();
        loadNewsAndKb();
        loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div>

</td></tr>
</tbody></table>
<p id="footer">
	Copyright @
	2020 漫天飞雪世情难却
<br><span id="poweredby">Powered by .NET Core on Kubernetes</span>
<br>
	Powered by:
	<a href="http://scottwater.com/blog" target="_blank">.Text</a> and 
	<a href="http://asp.net/" target="_blank">ASP.NET</a>
	<br>
	Theme by: <a href="http://www.dotnetmonster.com/" target="_blank">.NET Monster</a>
</p>




    


</body></html>